<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PRAHA FU≈†KY ‚Äî soci√°ln√≠ chat</title>

<!-- –ì–æ—Ç–∏—á–µ—Å–∫–∏–π —à—Ä–∏—Ñ—Ç + Inter -->
<link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --max-w:1020px;
  --accent:#2ecc71;
  --accent-2:#39ff91;
  --glass: rgba(255,255,255,.94);
  --muted:#64748b;
  --header-h:64px;        /* –µ—â—ë –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
  --avatar:42px;
  --chat-scale:1.15;      /* –ª–µ–Ω—Ç–∞ –∫—Ä—É–ø–Ω–µ–µ */
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Arial,sans-serif;background:#071126;color:#0b1220}
body{
  background:url('https://i.ibb.co/27hgtZfY/Prague.jpg') center/cover fixed no-repeat;
  overflow-x:hidden;
}

/* ====== Header ====== */
header{position:sticky;top:0;z-index:70;padding:6px 8px 2px;backdrop-filter:blur(3px)}
.brand{display:flex;align-items:center;justify-content:center;gap:10px;min-height:var(--header-h);position:relative}

/* –ª–µ–≤—ã–π –∞–≤–∞—Ç–∞—Ä (–ø—Ä–æ—Ñ–∏–ª—å), —Å–ø—Ä–∞–≤–∞ —à–µ—Å—Ç–µ—Ä—ë–Ω–∫–∞ –∏ –∫–æ–ª–æ–∫–æ–ª */
#profileBtn{position:absolute;left:8px;top:8px;width:48px;height:48px;border-radius:50%;border:2px solid #fff;background:#eee center/cover no-repeat;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,.35)}
#gearBtn{position:absolute;right:64px;top:8px;width:48px;height:48px;border-radius:50%;border:2px solid rgba(255,255,255,.92);background:rgba(0,0,0,.28);display:none;align-items:center;justify-content:center;color:#fff;box-shadow:0 6px 18px rgba(0,0,0,.35);cursor:pointer}
#bellBtn{position:absolute;right:8px;top:8px;width:48px;height:48px;border-radius:50%;border:2px solid rgba(255,255,255,.92);background:rgba(0,0,0,.28);display:flex;align-items:center;justify-content:center;color:#fff;box-shadow:0 6px 18px rgba(0,0,0,.35);cursor:pointer}
#bellBadge{position:absolute;top:-6px;right:-6px;background:#ff3366;color:#fff;border-radius:12px;padding:2px 6px;font-size:12px;font-weight:800;display:none;box-shadow:0 0 10px rgba(255,51,102,.9)}

h1#logotype{
  margin:0;
  font-family:'UnifrakturCook',Inter,serif;
  font-size:36px;letter-spacing:1px;text-transform:uppercase;font-weight:700;
  color:transparent;
  background:linear-gradient(90deg,#e31010,#15c115,#e31010);
  background-size:200% auto; -webkit-background-clip:text; background-clip:text;
  animation:rg 3.6s linear infinite;
  text-shadow:0 2px 0 rgba(0,0,0,.55),0 10px 22px rgba(0,0,0,.55);
}
@keyframes rg{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
/* —Ç–æ–Ω–∫–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ–¥ –ª–æ–≥–æ—Ç–∏–ø–æ–º ‚Äî —É–±—Ä–∞–Ω–∞ –∏–∑ DOM, –ø–µ—Ä–µ–Ω–æ—Å–∏–º –µ—ë –≤ üîî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ */

/* ====== –≤–µ—Ä—Ö–Ω–∏–µ –∫–Ω–æ–ø–∫–∏-–≤–∫–ª–∞–¥–∫–∏ ====== */
.topBar{position:sticky;top:var(--header-h);z-index:66;backdrop-filter:blur(2px)}
.neon-wrap{max-width:var(--max-w);margin:4px auto;padding:4px}
.tabs{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
.tab-btn{border:none;border-radius:14px;padding:8px 14px;font-weight:800;letter-spacing:.2px;cursor:pointer;color:#021f13;background:#cfffdf;box-shadow:0 0 12px rgba(57,255,145,.45), inset 0 -3px 0 rgba(0,0,0,.08);transition:.15s transform ease,.15s box-shadow ease}
.tab-btn:hover{transform:translateY(-1px);box-shadow:0 0 16px rgba(57,255,145,.85), inset 0 -3px 0 rgba(0,0,0,.08)}
.tab-btn.active{outline:2px solid var(--accent-2);box-shadow:0 0 18px rgba(57,255,145,.95), inset 0 -3px 0 rgba(0,0,0,.08)}

/* online badge */
#onlineNeon{max-width:var(--max-w);margin:6px auto 0;text-align:center;color:#baffd1;font-weight:800;text-shadow:0 0 8px rgba(57,255,145,.9);background:rgba(0,0,0,.35);border:1px solid rgba(57,255,145,.35);border-radius:10px;padding:6px}

/* ====== layout ====== */
.container{max-width:var(--max-w);margin:0 auto;padding:8px}
.tab{display:none}
.tab.active{display:block}

/* ====== Chat ====== */
.chat-area{height:calc(100vh - 310px);overflow:auto;padding:6px;background:transparent}
.messages{display:flex;flex-direction:column;gap:10px;padding-bottom:180px;transform:scale(var(--chat-scale));transform-origin:bottom left}
.msg{display:flex;gap:8px;align-items:flex-start;max-width:78%;word-break:break-word;position:relative}
.msg.self{margin-left:auto;flex-direction:row-reverse}
.avatar{width:var(--avatar);height:var(--avatar);border-radius:50%;object-fit:cover;flex:0 0 var(--avatar);box-shadow:0 3px 10px rgba(0,0,0,.35);cursor:pointer;background:#eee}
.bubble{background:var(--glass);padding:10px 12px;border-radius:14px;box-shadow:0 6px 30px rgba(2,6,23,.18);color:#0b1220;position:relative}
.msg.self .bubble{background:#E9FFF0}
.meta{font-size:12px;color:var(--muted);margin-bottom:6px}
.text{white-space:pre-wrap;font-weight:600}
.chat-img{max-width:320px;border-radius:10px;margin-top:6px;display:block}

/* –∫–æ–Ω—Ç–µ–∫—Å—Ç-–º–µ–Ω—é —É —Å–æ–æ–±—â–µ–Ω–∏—è (–ª–æ–Ω–≥—Ç–∞–ø/‚ãØ) */
.msg-menu{position:absolute;background:#fff;border-radius:10px;padding:6px;box-shadow:0 8px 30px rgba(0,0,0,.25);z-index:300;display:none}
.msg-menu button{display:block;width:100%;text-align:left;border:none;background:transparent;padding:8px 10px;cursor:pointer;border-radius:8px}
.msg-menu button:hover{background:#f3f4f6}

/* ====== input ====== */
.chat-input{position:fixed;left:0;right:0;bottom:0;padding:8px;background:linear-gradient(180deg,rgba(255,255,255,.96),rgba(255,255,255,.99));border-top:1px solid rgba(0,0,0,.06);z-index:80;display:flex;gap:8px;align-items:center;max-width:var(--max-w);margin:0 auto}
.camera{display:inline-flex;align-items:center;justify-content:center;cursor:pointer;width:48px;height:48px;border-radius:50%;background:#fff;border:1px solid #e6e6e6}
.chat-input input[type="text"]{flex:1;padding:12px 14px;border-radius:24px;border:1px solid #d0d7de;font-size:16px;outline:none}
.send{background:var(--accent);color:#fff;border:none;padding:10px 16px;border-radius:20px;font-weight:800;cursor:pointer;box-shadow:0 8px 20px rgba(46,204,113,.18)}

/* ====== –ø—Ä–æ—Å—Ç—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ —Å–ø–∏—Å–∫–∏ ====== */
.card{background:#fff;border-radius:12px;padding:10px;box-shadow:0 2px 8px rgba(0,0,0,.08);margin:8px 0}
.flex{display:flex;gap:8px;align-items:center}

/* ====== –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ ====== */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:95}
.modal.show{display:flex}
.panel{background:#fff;border-radius:14px;padding:14px;width:92%;max-width:760px;position:relative;box-shadow:0 18px 80px rgba(2,6,23,.4)}
.close{position:absolute;right:8px;top:6px;background:transparent;border:none;font-size:18px;cursor:pointer}

/* ====== —Ç–æ—Å—Ç—ã ====== */
.toast-wrap{position:fixed;left:50%;transform:translateX(-50%);bottom:86px;z-index:120;display:flex;flex-direction:column;gap:8px}
.toast{background:#111;color:#fff;padding:10px 12px;border-radius:12px;box-shadow:0 8px 26px rgba(0,0,0,.35);opacity:.95}

/* ====== admin bar (—Å–≤–µ—Ä—Ö—É –Ω–∞–¥ –ª–µ–Ω—Ç–æ–π ‚Äî –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –∫—Ä–µ—Å—Ç–∏–∫–æ–º) ====== */
#adminBar{position:sticky;top:0;z-index:67;display:none;max-width:var(--max-w);margin:6px auto;padding:8px;border-radius:10px;background:rgba(0,0,0,.35);border:1px solid rgba(57,255,145,.35);color:#dfffe8}
#adminBar .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.admin-chip{display:inline-flex;align-items:center;gap:6px;padding:6px 8px;border-radius:10px;background:#fff;color:#111;box-shadow:0 2px 8px rgba(0,0,0,.15)}
.admin-chip input[type="range"]{width:120px}
#adminHide{margin-left:auto;background:#ffe1e1;border:none;border-radius:8px;padding:6px 8px;cursor:pointer}

/* DM —Å–ø–∏—Å–æ–∫ (–≤–∫–ª–∞–¥–∫–∞ "Osobn√≠") */
.dm-item{display:flex;gap:10px;align-items:center;background:#fff;border-radius:12px;padding:10px;margin:8px 0;box-shadow:0 2px 8px rgba(0,0,0,.08)}
.dm-item .mini{width:44px;height:44px;border-radius:10px;object-fit:cover;background:#eee}
.dm-item .open{margin-left:auto}

/* –∫–∞—Ä—Ç–∞ (Leaflet) */
#map{width:100%;height:60vh;border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,.3);background:#eaf7ff}

/* –º–æ–±–∏–ª—å–Ω—ã–µ */
@media (max-width:640px){
  .chat-area{height:calc(100vh - 352px)}
  .chat-img{max-width:220px}
}
</style>
</head>
<body>

<header>
  <div class="brand">
    <button id="profileBtn" title="Profil" aria-label="Profil"></button>
    <h1 id="logotype">PRAHA FU≈†KY</h1>
    <button id="gearBtn" title="Admin">‚öôÔ∏è</button>
    <button id="bellBtn" title="Upozornƒõn√≠">üîî<span id="bellBadge">0</span></button>
  </div>
</header>

<div class="topBar">
  <div class="neon-wrap">
    <nav class="tabs" role="tablist" aria-label="Vklady">
      <button class="tab-btn active" data-t="chatTab">üí¨ Chat</button>
      <button class="tab-btn" data-t="rentTab">üè† Chat Pron√°jem</button>
      <button class="tab-btn" data-t="mapTab">üó∫Ô∏è Mapa</button>
      <button class="tab-btn" data-t="friendsTab">üë• P≈ô√°tel√©</button>
      <button class="tab-btn" data-t="helpTab">üÜò Pomoc</button>
      <button class="tab-btn" data-t="dmTab">‚úâÔ∏è Osobn√≠</button>
    </nav>
    <div id="onlineNeon">Online (p≈ôibl.): 0</div>
  </div>
</div>

<main class="container">
  <!-- –∞–¥–º–∏–Ω-–ø–ª–∞—à–∫–∞ (–º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å –∫—Ä–µ—Å—Ç–∏–∫–æ–º) -->
  <div id="adminBar">
    <div class="row">
      <div style="font-weight:800">Spr√°va bot≈Ø</div>
      <button id="startAll" class="tab-btn">‚ñ∂Ô∏è Spustit v≈°e</button>
      <button id="stopAll" class="tab-btn" style="background:#ffe1e1">‚èπ Zastavit v≈°e</button>
      <button id="postOnceAll" class="tab-btn" style="background:#fff3cd">‚ö°Ô∏è Jednou</button>
      <button id="adminHide">‚úñ</button>
    </div>
    <div id="botsRow" class="row" style="margin-top:8px"></div>
  </div>

  <!-- Chat -->
  <section id="chatTab" class="tab active" aria-label="Chat">
    <div class="chat-area" id="chatArea" aria-live="polite">
      <div id="messages" class="messages" role="log"></div>
    </div>
  </section>

  <!-- Chat Pron√°jem -->
  <section id="rentTab" class="tab" aria-label="Chat Pron√°jem">
    <div class="chat-area" id="rentArea">
      <div id="rentMessages" class="messages" role="log"></div>
    </div>
  </section>

  <!-- Map -->
  <section id="mapTab" class="tab" aria-label="Mapa">
    <div class="flex" style="margin-bottom:10px">
      <input id="mapSearch" placeholder="Hledat (nap≈ô. dobrovoln√≠ci, l√©k√°rna)..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #ddd">
      <button id="centerBtn" class="tab-btn" style="padding:6px 10px">Centrovat</button>
    </div>
    <div id="map"></div>
  </section>

  <!-- Friends -->
  <section id="friendsTab" class="tab" aria-label="P≈ô√°tel√©">
    <h2 style="color:#fff;margin:6px 0">P≈ô√°tel√© a ≈æ√°dosti</h2>
    <div class="flex" style="gap:16px;align-items:flex-start">
      <div style="flex:1">
        <h3>≈Ω√°dosti</h3>
        <div id="friendRequests" class="card"></div>
      </div>
      <div style="flex:1">
        <h3>Moji p≈ô√°tel√© (<span id="friendsOnlineCount">0</span> online)</h3>
        <div id="friendsList"></div>
      </div>
    </div>
  </section>

  <!-- Help -->
  <section id="helpTab" class="tab" aria-label="Pomoc">
    <h2 style="color:#fff">Nouzov√° pomoc v Praze</h2>
    <div class="flex" style="flex-wrap:wrap">
      <div class="card" style="flex:1 1 280px">
        <img src="https://i.ibb.co/TqWJ9VTM/palata-vchehii-jpg.webp" alt="Nemocnice" style="width:100%;height:160px;object-fit:cover;border-radius:8px">
        <h3>Nemocnice Motol</h3><p>V √övalu 84</p>
      </div>
      <div class="card" style="flex:1 1 280px">
        <img src="https://i.ibb.co/0gWD5wW/images-5.jpg" alt="Pr√°vn√≠ci" style="width:100%;height:160px;object-fit:cover;border-radius:8px">
        <h3>Pr√°vn√≠ pomoc</h3><p>Dokumenty a konzultace</p>
      </div>
      <div class="card" style="flex:1 1 280px">
        <img src="https://i.ibb.co/R49shL6k/images-6.jpg" alt="Obchody" style="width:100%;height:160px;object-fit:cover;border-radius:8px">
        <h3>Ukrajinsk√© obchody</h3><p>Potraviny a zbo≈æ√≠</p>
      </div>
    </div>
  </section>

  <!-- Direct Messages overview -->
  <section id="dmTab" class="tab" aria-label="Osobn√≠">
    <h2 style="color:#fff;margin:6px 0">Moje dialogy</h2>
    <div id="dmList"></div>
  </section>
</main>

<!-- –æ–±—â–∏–π input (–¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ chat/rent) -->
<input id="fileInput" type="file" accept="image/*" style="display:none">
<div class="chat-input">
  <label for="fileInput" class="camera" id="cameraLabel" title="P≈ôidat foto">üì∑</label>
  <input id="messageInput" type="text" placeholder="Napi≈°te zpr√°vu..." />
  <button id="sendButton" class="send">Odeslat</button>
</div>

<!-- –º–æ–¥–∞–ª: auth -->
<div id="authModal" class="modal" aria-hidden="true">
  <div class="panel" role="dialog" aria-modal="true">
    <button class="close" id="authClose">‚úñ</button>
    <h3>P≈ôihl√°≈°en√≠ / Registrace</h3>
    <div class="flex" style="gap:16px;flex-wrap:wrap">
      <form id="registerForm" class="card" style="flex:1 1 300px" onsubmit="return false;">
        <h4>Registrace</h4>
        <input id="nickInput" placeholder="P≈ôezd√≠vka" style="width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ddd">
        <input id="emailInput" type="email" placeholder="Email" style="width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ddd">
        <input id="passwordInput" type="password" placeholder="Heslo (min 6)" style="width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ddd">
        <div class="flex">
          <button id="registerSubmit" class="tab-btn" type="button">Registrovat</button>
          <button id="loginShow" class="tab-btn" type="button" style="background:#e5e7eb">P≈ôihl√°sit</button>
        </div>
        <div id="regError" style="color:#b91c1c;margin-top:6px"></div>
      </form>

      <form id="loginForm" class="card" style="flex:1 1 300px;display:none" onsubmit="return false;">
        <h4>P≈ôihl√°≈°en√≠</h4>
        <input id="loginEmail" type="email" placeholder="Email" style="width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ddd">
        <input id="loginPassword" type="password" placeholder="Heslo" style="width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ddd">
        <div class="flex">
          <button id="loginSubmit" class="tab-btn" type="button">P≈ôihl√°sit</button>
          <button id="backToRegister" class="tab-btn" type="button" style="background:#e5e7eb">Zpƒõt</button>
        </div>
        <div id="loginError" style="color:#b91c1c;margin-top:6px"></div>
      </form>
    </div>
  </div>
</div>

<!-- –º–æ–¥–∞–ª: –ø—Ä–æ—Ñ–∏–ª—å -->
<div id="profileModal" class="modal" aria-hidden="true">
  <div class="panel" role="dialog" aria-modal="true">
    <button class="close" id="profileClose">‚úñ</button>
    <div id="profileContent"></div>
  </div>
</div>

<!-- –º–æ–¥–∞–ª: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<div id="bellModal" class="modal" aria-hidden="true">
  <div class="panel" role="dialog" aria-modal="true">
    <button class="close" id="bellClose">‚úñ</button>
    <h3>Upozornƒõn√≠</h3>
    <div id="notifList"></div>
  </div>
</div>

<!-- –º–æ–¥–∞–ª: admin -->
<div id="adminModal" class="modal" aria-hidden="true">
  <div class="panel" role="dialog" aria-modal="true">
    <button class="close" id="adminClose">‚úñ</button>
    <h3>Admin panel</h3>
    <p style="margin-top:0">Spravujte boty a u≈æivatele. Rychlost = n√°sobitel (0.5√ó ‚Ä¶ 3√ó). Stav se ukl√°d√° lok√°lnƒõ (per device).</p>
    <div id="adminBots" class="card"></div>
    <div class="card">
      <h4>U≈æivatel√©</h4>
      <div id="usersList"></div>
    </div>
    <div class="flex">
      <button id="clearChat" class="tab-btn" style="background:#ffe1e1">üßπ Vyƒçistit Chat</button>
      <button id="clearRent" class="tab-btn" style="background:#ffe1e1">üßπ Vyƒçistit Pron√°jem</button>
      <button id="sendDonateInfo" class="tab-btn" style="background:#fff3cd">üí≥ Don√°t-informace</button>
    </div>
  </div>
</div>

<!-- –∫–æ–Ω—Ç–µ–∫—Å—Ç-–º–µ–Ω—é –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π -->
<div id="msgMenu" class="msg-menu" role="menu">
  <button data-act="like">üëç L√≠b√≠</button>
  <button data-act="warn">‚ö†Ô∏è Pozor (podvod)</button>
  <button data-act="dislike">üëé Nel√≠b√≠</button>
  <button data-act="spam">üö´ Spam</button>
  <button data-act="reply">‚Ü©Ô∏è Odpovƒõdƒõt</button>
  <button data-act="pm">‚úâÔ∏è Napsat do osobn√≠</button>
  <button data-act="del">üóëÔ∏è Smazat</button>
</div>

<!-- —Ç–æ—Å—Ç—ã -->
<div id="toasts" class="toast-wrap"></div>

<!-- ===========================
   –ß–ê–°–¢–¨ 2/4 ‚Äî Firebase, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, presence, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, —É—Ç–∏–ª–∏—Ç—ã
   –í–°–¢–ê–í–¨–¢–ï –≠–¢–£ –ß–ê–°–¢–¨ –°–†–ê–ó–£ –ü–û–°–õ–ï –ß–ê–°–¢–ò 1 (–ü–ï–†–ï–î –ß–ê–°–¢–¨–Æ 3)
   =========================== -->
<script type="module">
/* ---------- Firebase v9 (modular) ---------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import {
  getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword,
  updateProfile, sendEmailVerification, onAuthStateChanged, signOut
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import {
  getDatabase, ref as dbRef, push as dbPush, onChildAdded, onChildChanged,
  query, orderByChild, limitToLast, get as dbGet, set as dbSet, remove as dbRemove,
  update as dbUpdate, onValue
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

/* ----- –ö–æ–Ω—Ñ–∏–≥ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ ----- */
const firebaseConfig = {
  apiKey: "AIzaSyDw_bVibsVyZegH7OJyZ_yRjI3uLhroVBk",
  authDomain: "praga-4baee.firebaseapp.com",
  databaseURL: "https://praga-4baee-default-rtdb.firebaseio.com",
  projectId: "praga-4baee",
  storageBucket: "praga-4baee.firebasestorage.app",
  messagingSenderId: "336023952536",
  appId: "1:336023952536:web:f7437feaa25b6eadcd04ed",
  measurementId: "G-BGDJD6R12N"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

/* ---------- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã, —ç–ª–µ–º–µ–Ω—Ç—ã ---------- */
const DEFAULT_AVATAR = "https://i.ibb.co/Fqq6sH5q/istockphoto-1495088043-612x612.jpg";
const ADMIN_EMAIL = "urciknikolaj642@gmail.com";
const MSG_LIMIT = 500; // –±–æ–ª—å—à–µ –∏—Å—Ç–æ—Ä–∏–∏
let isAdmin = false;
let currentUser = null;

const tabBtns = document.querySelectorAll(".tab-btn");
const tabs = document.querySelectorAll(".tab");
const messagesEl = document.getElementById("messages");
const rentMessagesEl = document.getElementById("rentMessages");
const messageInput = document.getElementById("messageInput");
const sendButton = document.getElementById("sendButton");
const fileInput = document.getElementById("fileInput");
const chatArea = document.getElementById("chatArea");
const rentArea = document.getElementById("rentArea");
const onlineNeon = document.getElementById("onlineNeon");

const profileBtn = document.getElementById("profileBtn");
const profileModal = document.getElementById("profileModal");
const profileContent = document.getElementById("profileContent");
const profileClose = document.getElementById("profileClose");

const authModal = document.getElementById("authModal");
const authClose = document.getElementById("authClose");
const registerForm = document.getElementById("registerForm");
const loginForm = document.getElementById("loginForm");
const nickInput = document.getElementById("nickInput");
const emailInput = document.getElementById("emailInput");
const passwordInput = document.getElementById("passwordInput");
const registerSubmit = document.getElementById("registerSubmit");
const loginShow = document.getElementById("loginShow");
const loginSubmit = document.getElementById("loginSubmit");
const backToRegister = document.getElementById("backToRegister");
const loginEmail = document.getElementById("loginEmail");
const loginPassword = document.getElementById("loginPassword");
const regError = document.getElementById("regError");
const loginError = document.getElementById("loginError");

const bellBtn = document.getElementById("bellBtn");
const bellBadge = document.getElementById("bellBadge");
const bellModal = document.getElementById("bellModal");
const bellClose = document.getElementById("bellClose");
const notifList = document.getElementById("notifList");

const dmList = document.getElementById("dmList");
const friendsList = document.getElementById("friendsList");
const friendRequests = document.getElementById("friendRequests");
const friendsOnlineCountEl = document.getElementById("friendsOnlineCount");

const gearBtn = document.getElementById("gearBtn");
const adminBar = document.getElementById("adminBar");
const adminHide = document.getElementById("adminHide");
const adminModal = document.getElementById("adminModal");
const adminClose = document.getElementById("adminClose");
const adminBots = document.getElementById("adminBots");
const botsRow = document.getElementById("botsRow");
const startAllBtn = document.getElementById("startAll");
const stopAllBtn = document.getElementById("stopAll");
const postOnceAllBtn = document.getElementById("postOnceAll");
const clearChatBtn = document.getElementById("clearChat");
const clearRentBtn = document.getElementById("clearRent");
const sendDonateInfoBtn = document.getElementById("sendDonateInfo");
const usersList = document.getElementById("usersList");

const msgMenu = document.getElementById("msgMenu");
const toasts = document.getElementById("toasts");

/* ---------- –í–∫–ª–∞–¥–∫–∏ –∏ —Ö–æ—Ç–∫–µ–∏ ---------- */
function setTab(id){
  tabBtns.forEach(b=> b.classList.toggle('active', b.dataset.t===id));
  tabs.forEach(t=> t.style.display = (t.id===id) ? 'block' : 'none');
  if (id==='chatTab' || id==='rentTab') messageInput.focus();
  adminBar.style.display = (id==='chatTab' && isAdmin)?'block':'none';
}
tabBtns.forEach(b=> b.addEventListener('click',()=> setTab(b.dataset.t)));
document.addEventListener('keydown',e=>{
  const k=e.key.toLowerCase();
  if(k==='c')setTab('chatTab');
  if(k==='r')setTab('rentTab');
  if(k==='m')setTab('mapTab');
  if(k==='f')setTab('friendsTab');
  if(k==='h')setTab('helpTab');
  if(k==='d')setTab('dmTab');
});
adminHide.addEventListener('click',()=> adminBar.style.display='none');

/* ---------- –¢–æ—Å—Ç—ã ---------- */
function toast(t){ const d=document.createElement('div'); d.className='toast'; d.textContent=t; toasts.appendChild(d); setTimeout(()=>d.remove(),2400); }

/* ---------- –ù–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (üîî) ---------- */
function notify(title,text){
  const row = document.createElement('div');
  row.className='card';
  row.textContent = `${title}: ${text}`;
  notifList.prepend(row);
  let n=Number(bellBadge.dataset.n||'0')+1;
  bellBadge.dataset.n=String(n); bellBadge.textContent=n; bellBadge.style.display=n>0?'inline-block':'none';
}
bellBtn.addEventListener('click',()=>{ bellModal.classList.add('show'); bellBadge.dataset.n='0'; bellBadge.style.display='none'; });
bellClose.addEventListener('click',()=> bellModal.classList.remove('show'));

/* ---------- Auth –º–æ–¥–∞–ª–∫–∞ ---------- */
function showAuth(){ authModal.classList.add('show'); regError.textContent=''; loginError.textContent=''; }
function hideAuth(){ authModal.classList.remove('show'); }
authClose.addEventListener('click',hideAuth);
loginShow.addEventListener('click',()=>{ registerForm.style.display='none'; loginForm.style.display='block'; });
backToRegister.addEventListener('click',()=>{ registerForm.style.display='block'; loginForm.style.display='none'; });

registerSubmit.addEventListener('click', async ()=>{
  regError.textContent='';
  const nick=nickInput.value.trim(), email=emailInput.value.trim(), pass=passwordInput.value.trim();
  if(!nick||!email||!pass){ regError.textContent='Vypl≈àte v≈°echna pole'; return; }
  if(pass.length<6){ regError.textContent='Heslo min 6 znak≈Ø'; return; }
  try{
    const cred = await createUserWithEmailAndPassword(auth,email,pass);
    await updateProfile(cred.user,{ displayName:nick, photoURL: DEFAULT_AVATAR });
    await dbSet(dbRef(db,`users/${cred.user.uid}`),{ nick, email, avatar: DEFAULT_AVATAR, createdAt: Date.now(), banned:false, premium:false });
    await sendEmailVerification(cred.user);
    localStorage.setItem("regTime_"+cred.user.uid, String(Date.now()));
    try{ await dbSet(dbRef(db,`presence/${cred.user.uid}`),{ ts:Date.now(), nick }); }catch(e){}
    notify('Info','Stisknƒõte ‚ÄûOdeslat‚Äú ‚Äî objev√≠ se registrace. 6 hodin p≈ô√≠stupu bez potvrzen√≠ emailu.');
    hideAuth();
  }catch(err){ regError.textContent = err?.message || String(err); }
});

loginSubmit.addEventListener('click', async ()=>{
  loginError.textContent='';
  const email=loginEmail.value.trim(), pass=loginPassword.value.trim();
  if(!email||!pass){ loginError.textContent='Vypl≈àte email i heslo'; return; }
  try{ await signInWithEmailAndPassword(auth,email,pass); hideAuth(); }
  catch(err){ loginError.textContent = err?.message || String(err); }
});

/* ---------- –°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ---------- */
onAuthStateChanged(auth, async user=>{
  currentUser=user;
  if(user){
    isAdmin = (user.email===ADMIN_EMAIL) || (await getUserRole(user.uid)==='admin');
    gearBtn.style.display = isAdmin ? 'flex' : 'none';
    adminBar.style.display = (isAdmin && document.getElementById('chatTab').style.display!=='none')?'block':'none';
    profileBtn.style.backgroundImage = `url(${user.photoURL||DEFAULT_AVATAR})`;
    try{ await dbSet(dbRef(db,`presence/${user.uid}`),{ ts:Date.now(), nick:user.displayName||user.email}); }catch(e){}
    subscribeNotifications(user.uid);
    loadDMList();
    refreshFriendsBlocks();
    initAdminUI();
    // –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∏–Ω—Ñ–æ-–ø–ª–∞—à–∫—É –≤ üîî –µ–¥–∏–Ω–æ–∂–¥—ã
    if(!localStorage.getItem('firstInfoPushed')){
      await dbPush(dbRef(db,`notifications/${user.uid}`),{ ts:Date.now(), type:'info', text:'Jste nov√Ω? Stisknƒõte ‚ÄûOdeslat‚Äú ‚Äî objev√≠ se registrace. 6 hodin p≈ô√≠stupu bez potvrzen√≠ emailu.' });
      localStorage.setItem('firstInfoPushed','1');
    }
  }else{
    isAdmin=false; gearBtn.style.display='none'; adminBar.style.display='none';
    profileBtn.style.backgroundImage = `url(${DEFAULT_AVATAR})`;
    dmList.innerHTML = `<div class="card"><i>P≈ôihlaste se pro zobrazen√≠ osobn√≠ch zpr√°v</i></div>`;
  }
  updateOnlineCount();
});

/* role helper */
async function getUserRole(uid){
  try{ const snap=await dbGet(dbRef(db,`users/${uid}/role`)); return snap.exists()?snap.val():null; }catch(e){ return null; }
}

/* ---------- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 6 —á–∞—Å–æ–≤ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ---------- */
async function canSendMessage(){
  const u=auth.currentUser; if(!u) return false;
  if(u.emailVerified) return true;
  const key="regTime_"+u.uid, local=localStorage.getItem(key), six=6*60*60*1000;
  if(local && Date.now()-Number(local)<six) return true;
  try{
    const snap = await dbGet(dbRef(db,`users/${u.uid}/createdAt`));
    if(snap.exists()){ const created=Number(snap.val()); if(Date.now()-created<six){ localStorage.setItem(key,String(created)); return true; } }
  }catch(e){}
  return true; // —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–µ—Å—Ç–∞—Ö; –≤–∫–ª—é—á–∏—Ç—å —Å—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏
}

/* ---------- –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ presence √ó10 ---------- */
function updateOnlineCount(){
  onValue(dbRef(db,"presence"), (snap)=>{
    const val=snap.val()||{};
    const real=Object.keys(val).length;
    const shown=real*10; // –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
    onlineNeon.textContent = `Online (p≈ôibl.): ${shown}`;
  });
}
window.addEventListener('beforeunload', async ()=>{
  try{ if(auth.currentUser) await dbRemove(dbRef(db,`presence/${auth.currentUser.uid}`)); }catch(e){}
});

/* ---------- –£—Ç–∏–ª–∏—Ç—ã ---------- */
function timeStr(ts){ return new Date(ts).toLocaleString(); }
function isNearBottom(area){ return (area.scrollHeight - area.scrollTop - area.clientHeight) < 160; }
function scrollToBottom(area){ area.scrollTop = area.scrollHeight; }
function convoId(a,b){ return a<b? `${a}_${b}` : `${b}_${a}`; }
function activeChatPath(){ return (document.getElementById('rentTab').style.display==='block')? 'rentMessages':'messages'; }

/* —Ä–µ—Å–∞–π–∑ —Ñ–æ—Ç–æ (–±–µ–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞) */
function resizeImageFile(file, maxWidth=900, quality=.8){
  return new Promise((resolve,reject)=>{
    const img=new Image(); const r=new FileReader();
    r.onload=e=>{ img.onload=()=>{ const s=Math.min(1,maxWidth/img.width); const w=Math.round(img.width*s), h=Math.round(img.height*s);
      const c=document.createElement('canvas'); c.width=w; c.height=h; const x=c.getContext('2d'); x.drawImage(img,0,0,w,h);
      resolve(c.toDataURL('image/jpeg',quality)); }; img.onerror=reject; img.src=e.target.result; };
    r.onerror=reject; r.readAsDataURL(file);
  });
}

/* ---------- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ---------- */
function subscribeNotifications(uid){
  onChildAdded(dbRef(db,`notifications/${uid}`),(snap)=>{
    const v=snap.val()||{};
    notify(v.type||'Info', v.text||'');
  });
}

/* ---------- –ü—Ä–æ—Ñ–∏–ª—å ---------- */
profileBtn.addEventListener('click',()=>{ if(!auth.currentUser){ showAuth(); return; } openProfile(auth.currentUser.uid,true); });
profileClose.addEventListener('click',()=> profileModal.classList.remove('show'));

async function openProfile(uid,self=false){
  profileContent.innerHTML='<p>Naƒç√≠t√°n√≠‚Ä¶</p>'; profileModal.classList.add('show');
  try{
    const s=await dbGet(dbRef(db,`users/${uid}`));
    const u=s.exists()?s.val():{nick:'U≈æivatel',avatar:DEFAULT_AVATAR,email:''};
    const isSelf = auth.currentUser && auth.currentUser.uid===uid;
    profileContent.innerHTML = `
      <div class="flex">
        <img src="${u.avatar||DEFAULT_AVATAR}" style="width:84px;height:84px;border-radius:12px;object-fit:cover;background:#eee">
        <div>
          <h3 style="margin:0 0 4px">${u.nick||'U≈æivatel'}</h3>
          <div style="color:#333">${u.email||''}</div>
        </div>
      </div>
      <div class="flex" style="flex-wrap:wrap;margin-top:8px">
        ${isSelf?`
          <button id="editAvatar" class="tab-btn">Zmƒõnit avatar (URL / soubor)</button>
          <button id="myDMs" class="tab-btn">Moje osobn√≠</button>
          <a class="tab-btn" href="mailto:urciknikolaj642@gmail.com?subject=Reklama%20Praha%20Fu≈°ky">Koupit reklamu</a>
          <button id="signOut" class="tab-btn" style="background:#ffe1e1">Odhl√°sit</button>
        `:`
          <button id="pmBtn" class="tab-btn">Napsat osobnƒõ</button>
          <button id="addFriendBtn" class="tab-btn">P≈ôidat do p≈ô√°tel</button>
          <button id="reportBtn" class="tab-btn" style="background:#ffe7c4">Nahl√°sit</button>
        `}
      </div>
      <div id="profileMsg" style="margin-top:8px;color:#b91c1c"></div>
    `;
    if(isSelf){
      document.getElementById('editAvatar').addEventListener('click', async ()=>{
        // –≤—ã–±–æ—Ä: URL –∏–ª–∏ —Ñ–∞–π–ª
        const mode = confirm('OK = vlo≈æit URL, Cancel = vybrat soubor');
        if(mode){
          const url = prompt('Vlo≈æte URL obr√°zku:'); if(!url) return;
          try{ await dbSet(dbRef(db,`users/${uid}/avatar`),url); await updateProfile(auth.currentUser,{photoURL:url}); profileBtn.style.backgroundImage=`url(${url})`; profileContent.querySelector('img').src=url; toast('Avatar zmƒõnƒõn'); }catch(e){ toast('Chyba avataru'); }
        }else{
          const inp=document.createElement('input'); inp.type='file'; inp.accept='image/*'; inp.onchange= async ()=>{ const f=inp.files[0]; if(!f) return; const data=await resizeImageFile(f,420,.82);
            try{ await dbSet(dbRef(db,`users/${uid}/avatar`),data); await updateProfile(auth.currentUser,{photoURL:data}); profileBtn.style.backgroundImage=`url(${data})`; profileContent.querySelector('img').src=data; toast('Avatar zmƒõnƒõn'); }catch(e){ toast('Chyba avataru'); }
          }; inp.click();
        }
      });
      document.getElementById('myDMs').addEventListener('click',()=>{ profileModal.classList.remove('show'); setTab('dmTab'); });
      document.getElementById('signOut').addEventListener('click', async ()=>{ try{ await dbRemove(dbRef(db,`presence/${auth.currentUser.uid}`)); }catch(e){} await signOut(auth); profileModal.classList.remove('show'); });
    }else{
      document.getElementById('pmBtn').addEventListener('click',()=>{ profileModal.classList.remove('show'); openPrivateChat(uid); });
      document.getElementById('addFriendBtn').addEventListener('click',()=> sendFriendRequest(uid));
      document.getElementById('reportBtn').addEventListener('click',()=> notify('Report','Dƒõkujeme, provƒõ≈ô√≠me.'));
    }
  }catch(e){ profileContent.innerHTML='<p>Chyba naƒçten√≠ profilu</p>'; }
}

<!-- ===========================
   –ß–ê–°–¢–¨ 3/4 ‚Äî –ß–∞—Ç—ã (–æ–±—â–∏–π –∏ –∞—Ä–µ–Ω–¥–∞), –õ–°, –î—Ä—É–∑—å—è, –ë–æ—Ç—ã, –ê–¥–º–∏–Ω, –∫–∞—Ä—Ç–∞
   –í–°–¢–ê–í–¨–¢–ï –≠–¢–£ –ß–ê–°–¢–¨ –°–†–ê–ó–£ –ü–û–°–õ–ï –ß–ê–°–¢–ò 2
   =========================== -->
<script type="module">
/* ====== –†–µ–Ω–¥–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π ====== */
function renderMessage(m,container){
  if(!m||!m.ts) return;
  const wrap=document.createElement('div');
  wrap.className='msg'+((currentUser && m.uid===currentUser.uid)?' self':'');
  wrap.dataset.id = m.id||'';
  wrap.dataset.uid = m.uid||'';
  // –∞–≤–∞—Ç–∞—Ä
  const ava=document.createElement('img'); ava.className='avatar'; ava.src=m.avatar||DEFAULT_AVATAR; ava.alt=m.nick||'avatar'; ava.addEventListener('click',()=> openProfile(m.uid));
  // –ø—É–∑—ã—Ä—å
  const bubble=document.createElement('div'); bubble.className='bubble';
  const meta=document.createElement('div'); meta.className='meta'; meta.textContent=`${m.nick||'U≈æivatel'} ¬∑ ${timeStr(m.ts)}${m.recipientUid?' ¬∑ osobn√≠':''}`;
  bubble.appendChild(meta);
  if(m.text){ const t=document.createElement('div'); t.className='text'; t.textContent=m.text; bubble.appendChild(t); }
  if(m.image){ const im=document.createElement('img'); im.src=m.image; im.className='chat-img'; im.alt='Foto'; bubble.appendChild(im); }
  wrap.appendChild(ava); wrap.appendChild(bubble);
  container.appendChild(wrap);
  const area = container.closest('.chat-area'); if(area && isNearBottom(area)) scrollToBottom(area);

  // –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é (–ª–æ–Ω–≥—Ç–∞–ø / –ø—Ä–∞–≤—ã–π –∫–ª–∏–∫)
  function openMenu(e){ e.preventDefault(); showMsgMenu(e.clientX||e.touches?.[0].clientX, (e.clientY||e.touches?.[0].clientY)+6, m, wrap); }
  bubble.addEventListener('contextmenu',openMenu);
  let pressTimer=null;
  bubble.addEventListener('touchstart',e=>{ pressTimer=setTimeout(()=>openMenu(e),450); },{passive:true});
  ['touchend','touchmove','touchcancel'].forEach(ev=> bubble.addEventListener(ev,()=> clearTimeout(pressTimer),{passive:true}));
}

/* ====== –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –æ–±—â–∏–π –∏ –∞—Ä–µ–Ω–¥–∞ —á–∞—Ç ====== */
let initialMain=false, initialRent=false;
const mainQ=query(dbRef(db,'messages'),orderByChild('ts'),limitToLast(MSG_LIMIT));
onChildAdded(mainQ, snap=>{ const m=snap.val(); m.id=snap.key; renderMessage(m,messagesEl); if(!initialMain){ clearTimeout(window._a); window._a=setTimeout(()=>{ scrollToBottom(chatArea); initialMain=true; },80); }});
const rentQ=query(dbRef(db,'rentMessages'),orderByChild('ts'),limitToLast(MSG_LIMIT));
onChildAdded(rentQ, snap=>{ const m=snap.val(); m.id=snap.key; renderMessage(m,rentMessagesEl); if(!initialRent){ clearTimeout(window._b); window._b=setTimeout(()=>{ scrollToBottom(rentArea); initialRent=true; },80); }});

/* ====== –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π ====== */
sendButton.addEventListener('click', async ()=>{
  if(!auth.currentUser){ showAuth(); return; }
  // –±–∞–Ω? 
  const banSnap = await dbGet(dbRef(db,`users/${auth.currentUser.uid}/banned`)); if(banSnap.exists()&&banSnap.val()===true){ toast('√öƒçet je zablokov√°n'); return; }
  if(!await canSendMessage()){ notify('Pot≈ôeba potvrdit email','Vyu≈æijte 6h p≈ô√≠stup po registraci nebo potvrƒète email.'); return; }

  const text=messageInput.value.trim(); const f=fileInput.files[0]; if(!text && !f) return;

  let imageData=null;
  if(f){ try{ imageData = await resizeImageFile(f,900,.8); }catch(e){ toast('Chyba obr√°zku'); return; } }

  const msg={ uid:auth.currentUser.uid, nick:auth.currentUser.displayName||auth.currentUser.email||'U≈æivatel', avatar:auth.currentUser.photoURL||DEFAULT_AVATAR, text:text||null, image:imageData||null, ts:Date.now(), recipientUid:null };
  try{ await dbPush(dbRef(db,activeChatPath()),msg); messageInput.value=''; fileInput.value=''; toast('√öspƒõ≈°nƒõ odesl√°no'); }
  catch(e){ toast('Chyba odesl√°n√≠'); }
});
messageInput.addEventListener('keydown',e=>{ if(e.key==='Enter'&&!e.shiftKey){ e.preventDefault(); sendButton.click(); }});
document.querySelector('.camera').addEventListener('click',e=>{ if(!auth.currentUser){ e.preventDefault(); showAuth(); } });

/* ====== –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –Ω–∞–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º ====== */
function showMsgMenu(x,y,msg,wrap){
  msgMenu.style.left=x+'px'; msgMenu.style.top=y+'px'; msgMenu.style.display='block';
  const hide=()=>{ msgMenu.style.display='none'; document.removeEventListener('click',hide); }; setTimeout(()=> document.addEventListener('click',hide,{once:true}),0);
  msgMenu.querySelectorAll('button').forEach(btn=>{
    btn.onclick = async ()=>{
      const act=btn.dataset.act;
      try{
        if(act==='reply'){
          const r=prompt('Va≈°e odpovƒõƒè:'); if(r){
            await dbPush(dbRef(db,activeChatPath()),{ uid:auth.currentUser.uid, nick:auth.currentUser.displayName||auth.currentUser.email, avatar:auth.currentUser.photoURL||DEFAULT_AVATAR, text:'‚Ü©Ô∏è Odpovƒõƒè: '+r, ts:Date.now(), recipientUid: msg.uid });
            toast('Odesl√°no');
          }
        }else if(act==='pm'){ openPrivateChat(msg.uid); }
        else if(act==='del'){
          if(isAdmin || (currentUser && msg.uid===currentUser.uid)){
            const path = wrap.closest('#rentMessages')?'rentMessages':'messages';
            await dbRemove(dbRef(db,`${path}/${msg.id}`)); wrap.remove(); toast('Smaz√°no');
          }else toast('Maz√°n√≠ povoleno jen autorovi nebo adminovi');
        }else{
          if(msg.id){
            await dbSet(dbRef(db,`messageReactions/${msg.id}/${auth.currentUser.uid}`),{ act, ts:Date.now() });
            await dbPush(dbRef(db,`notifications/${msg.uid}`),{ ts:Date.now(), type:'reaction', text:`${act} na va≈°i zpr√°vu`, from:auth.currentUser.uid });
            toast('Ulo≈æeno');
          }
        }
      }catch(e){ toast('Chyba akce'); }
    };
  });
}

/* ====== Osobn√≠ zpr√°vy (DM) ====== */
async function openPrivateChat(otherUid){
  if(!auth.currentUser){ showAuth(); return; }
  const me=auth.currentUser.uid, cid=convoId(me,otherUid);

  // –æ–∫–Ω–æ
  const panel=document.createElement('div'); panel.className='modal show';
  panel.innerHTML=`<div class="panel"><button class="close">‚úñ</button>
    <h3>Dialog</h3>
    <div id="dmThread" style="max-height:55vh;overflow:auto;border:1px solid #eee;border-radius:8px;padding:8px;background:#fafafa;margin-bottom:8px"></div>
    <div class="flex"><input id="dmText" placeholder="Napi≈°te zpr√°vu..." style="flex:1;padding:10px;border-radius:8px;border:1px solid #ddd"><input id="dmFile" type="file" accept="image/*" style="display:none"><label for="dmFile" class="tab-btn">üì∑</label><button id="dmSend" class="tab-btn">Odeslat</button></div>
  </div>`;
  document.body.appendChild(panel);
  panel.querySelector('.close').addEventListener('click',()=> panel.remove());
  const thread=panel.querySelector('#dmThread');

  // –ø–æ–¥–ø–∏—Å–∫–∞
  const q=query(dbRef(db,`privateMessages/${cid}/items`),orderByChild('ts'),limitToLast(400));
  onChildAdded(q, snap=>{
    const m=snap.val(); const row=document.createElement('div'); row.style.margin='8px 0'; row.style.textAlign=m.from===me?'right':'left';
    const who = (m.from===me? (auth.currentUser.displayName||'J√°') : (m.nick||'U≈æivatel'));
    const ava = `<img src="${m.avatar||DEFAULT_AVATAR}" style="width:26px;height:26px;border-radius:6px;vertical-align:middle;margin:${m.from===me?'0 0 0 6px':'0 6px 0 0'}">`;
    const img = m.image? `<div><img src="${m.image}" style="max-width:220px;border-radius:8px"></div>` : '';
    row.innerHTML = (m.from===me?`${m.text||''}${img} <small>¬∑ ${who} ¬∑ ${new Date(m.ts).toLocaleTimeString()}</small> ${ava}`
                               :`${ava} <small>${who} ¬∑ ${new Date(m.ts).toLocaleTimeString()}</small><div>${m.text||''}</div>${img}`);
    thread.appendChild(row); thread.scrollTop=thread.scrollHeight;
  });

  async function sendDM(){
    const t = panel.querySelector('#dmText').value.trim();
    const f = panel.querySelector('#dmFile').files[0];
    if(!t && !f) return;
    let img=null; if(f) img=await resizeImageFile(f,900,.8);
    const pm = { from:me, to:otherUid, text:t||null, image:img||null, ts:Date.now(), nick:auth.currentUser.displayName||'U≈æivatel', avatar:auth.currentUser.photoURL||DEFAULT_AVATAR };
    await dbPush(dbRef(db,`privateMessages/${cid}/items`), pm);
    // inbox meta (–æ–±–æ–∏–º)
    await dbSet(dbRef(db,`inboxMeta/${me}/${otherUid}`),{ uid:otherUid, last: t|| (img?'[foto]':''), ts:pm.ts });
    await dbSet(dbRef(db,`inboxMeta/${otherUid}/${me}`),{ uid:me, last: t|| (img?'[foto]':''), ts:pm.ts });
    await dbPush(dbRef(db,`notifications/${otherUid}`),{ ts:Date.now(), type:'dm', text:`Nov√° osobn√≠ zpr√°va od ${auth.currentUser.displayName||'U≈æivatel'}`, from:me });
    panel.querySelector('#dmText').value=''; panel.querySelector('#dmFile').value=''; toast('Odesl√°no');
  }
  panel.querySelector('#dmSend').addEventListener('click',sendDM);
  panel.querySelector('#dmText').addEventListener('keydown',e=>{ if(e.key==='Enter'&&!e.shiftKey){ e.preventDefault(); sendDM(); }});
}

async function loadDMList(){
  const u=auth.currentUser; if(!u){ dmList.innerHTML='<div class="card"><i>P≈ôihlaste se‚Ä¶</i></div>'; return; }
  dmList.innerHTML='';
  const snap=await dbGet(dbRef(db,`inboxMeta/${u.uid}`));
  if(!snap.exists()){ dmList.innerHTML='<div class="card"><i>Zat√≠m ≈æ√°dn√© dialogy</i></div>'; return; }
  const meta=snap.val();
  const entries = Object.values(meta).sort((a,b)=> b.ts-a.ts);
  for(const m of entries){
    // –ø–æ–¥—Ç—è–Ω—É—Ç—å –Ω–∏–∫ –∏ –∞–≤–∞—Ç–∞—Ä —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
    const ps = await dbGet(dbRef(db,`users/${m.uid}`));
    const pu = ps.exists()?ps.val():{nick:'U≈æivatel',avatar:DEFAULT_AVATAR};
    const item=document.createElement('div'); item.className='dm-item';
    item.innerHTML=`<img class="mini" src="${pu.avatar||DEFAULT_AVATAR}"><div><div style="font-weight:800">${pu.nick||'U≈æivatel'}</div><div style="font-size:12px;color:#64748b">${m.last||''}</div></div><button class="open tab-btn">Otev≈ô√≠t</button>`;
    item.querySelector('.open').addEventListener('click',()=> openPrivateChat(m.uid));
    dmList.appendChild(item);
  }
}

/* ====== P≈ô√°tel√© ====== */
async function sendFriendRequest(toUid){
  if(!auth.currentUser){ showAuth(); return; }
  const from=auth.currentUser.uid; if(from===toUid) return;
  try{
    await dbSet(dbRef(db,`friendRequests/${toUid}/${from}`),{ from, ts:Date.now() });
    await dbSet(dbRef(db,`friends/${from}/${toUid}`),{ status:'requested', ts:Date.now(), fromUid:from });
    await dbPush(dbRef(db,`notifications/${toUid}`),{ ts:Date.now(), type:'friend', text:`≈Ω√°dost o p≈ô√°telstv√≠ od ${auth.currentUser.displayName||'U≈æivatel'}`, from });
    toast('≈Ω√°dost odesl√°na');
  }catch(e){ toast('Chyba ≈æ√°dosti'); }
}
function friendCard(u, online, uid){
  const d=document.createElement('div'); d.className='dm-item';
  d.innerHTML=`<img class="mini" src="${u.avatar||DEFAULT_AVATAR}"><div><div style="font-weight:800">${u.nick||'U≈æivatel'}</div><div style="font-size:12px;color:${online?'#10b981':'#64748b'}">${online?'online':'offline'}</div></div><div class="flex" style="margin-left:auto"><button class="tab-btn pm">‚úâÔ∏è</button><button class="tab-btn open">üëÄ</button></div>`;
  d.querySelector('.pm').addEventListener('click',()=> openPrivateChat(uid));
  d.querySelector('.open').addEventListener('click',()=> openProfile(uid));
  return d;
}
async function refreshFriendsBlocks(){
  const u=auth.currentUser; if(!u){ friendsList.innerHTML=''; friendRequests.innerHTML=''; friendsOnlineCountEl.textContent='0'; return; }
  // requests
  const reqSnap=await dbGet(dbRef(db,`friendRequests/${u.uid}`)); friendRequests.innerHTML='';
  if(reqSnap.exists()){
    const reqs=reqSnap.val();
    for(const fromUid of Object.keys(reqs)){
      const uSnap=await dbGet(dbRef(db,`users/${fromUid}`)); const ud=uSnap.exists()?uSnap.val():{nick:'U≈æivatel',avatar:DEFAULT_AVATAR};
      const item=document.createElement('div'); item.className='dm-item';
      item.innerHTML=`<img class="mini" src="${ud.avatar||DEFAULT_AVATAR}"><div><div style="font-weight:800">${ud.nick||'U≈æivatel'}</div><div style="font-size:12px;color:#64748b">≈æ√°dost o p≈ô√°telstv√≠</div></div><div class="flex" style="margin-left:auto"><button class="tab-btn ok">‚úÖ</button><button class="tab-btn no" style="background:#ffe1e1">‚úñ</button></div>`;
      item.querySelector('.ok').addEventListener('click',async ()=>{
        await dbSet(dbRef(db,`friends/${u.uid}/${fromUid}`),{ status:'accepted', ts:Date.now() });
        await dbSet(dbRef(db,`friends/${fromUid}/${u.uid}`),{ status:'accepted', ts:Date.now() });
        await dbRemove(dbRef(db,`friendRequests/${u.uid}/${fromUid}`));
        await dbPush(dbRef(db,`notifications/${fromUid}`),{ ts:Date.now(), type:'friend', text:`${auth.currentUser.displayName||'U≈æivatel'} v√°s p≈ôidal(a) do p≈ô√°tel`, from:u.uid });
        refreshFriendsBlocks();
      });
      item.querySelector('.no').addEventListener('click',async ()=>{
        await dbRemove(dbRef(db,`friendRequests/${u.uid}/${fromUid}`));
        await dbRemove(dbRef(db,`friends/${fromUid}/${u.uid}`));
        refreshFriendsBlocks();
      });
      friendRequests.appendChild(item);
    }
  }else friendRequests.innerHTML='<i>≈Ω√°dn√© ≈æ√°dosti</i>';

  // friends
  friendsList.innerHTML=''; let onlineCount=0;
  const frSnap=await dbGet(dbRef(db,`friends/${u.uid}`));
  if(frSnap.exists()){
    const fr=frSnap.val();
    for(const fid of Object.keys(fr)){
      if(fr[fid].status!=='accepted') continue;
      const uSnap=await dbGet(dbRef(db,`users/${fid}`)); const ud=uSnap.exists()?uSnap.val():{nick:'U≈æivatel',avatar:DEFAULT_AVATAR};
      const pSnap=await dbGet(dbRef(db,`presence/${fid}`)); const online=pSnap.exists(); if(online) onlineCount++;
      friendsList.appendChild(friendCard(ud,online,fid));
    }
  }else friendsList.innerHTML='<i>P≈ôidejte p≈ô√°tele p≈ôes profily</i>';
  friendsOnlineCountEl.textContent=String(onlineCount);
}

/* ====== –ë–æ—Ç—ã (—Å —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–º–∏ –Ω–∏–∫–∞–º–∏) ====== */
const HUMAN_NAMES = [
  {nick:'Petr Nov√°k', avatar:'https://i.ibb.co/6gYF4dG/avatar1.png'},
  {nick:'Anna ƒåern√°', avatar:'https://i.ibb.co/z7wR2zv/avatar2.png'},
  {nick:'Marek Dvo≈ô√°k', avatar:'https://i.ibb.co/p1QxQ2n/avatar3.png'},
];
const BOTS_DEF = [
  { id:'bot1', user:HUMAN_NAMES[0], posts:[
    {text:`O2 SIM KARTA\nBez limitu internet i vol√°n√≠\nFunguje po cel√© EU\nMƒõs√≠ƒçnƒõ 699 Kƒç. Cena SIM 299 Kƒç. Tel: 607914467 (Viber/WhatsApp/Telegram)`, image:'https://i.ibb.co/LH4wBMS/IMG-d8e6076e17f19db7fe3add0754738a01-V.jpg'},
    {text:`Prod√°m iPhone 11 Pro Max + 26 obal≈Ø (obaly zdarma). Telefon bez prasklin, v≈°e origin√°l, bez Apple ID. Dotazy do osobn√≠ch.`, image:'https://i.ibb.co/dwcXPqDr/IMG-1954f6b56869b9817a131ae33f3a37b6-V.jpg'},
    {text:`Nab√≠dka`, image:'https://i.ibb.co/G3kDcrYZ/IMG-fa590121e46c5b030c5ddc94d4e8bea9-V.jpg'}
  ], base: 2*60*1000 },
  { id:'bot2', user:HUMAN_NAMES[1], posts:[
    {text:`≈†ablona`, image:'https://i.ibb.co/Z11WVrVC/IMG-b83692bb79a1468af74c81620750e8c0-V.jpg'},
    {text:`Hled√°m modelky na permanentn√≠ make-up pod dohledem certifikovan√© mistrynƒõ ‚ú® Praha ‚Ä¢ 28.07 ve 14:00 ‚Ä¢ cena jen za materi√°l. Podrobnosti do osobn√≠ch.`, image:'https://i.ibb.co/QFWDvGZ8/IMG-6748e7141906901b131b8fd5130a5c01-V.jpg'},
    {text:`Inzer√°t`, image:'https://i.ibb.co/j97RhTny/IMG-593d75b053ea1a28cdfb9fc52f93afad-V.jpg'}
  ], base: 3*60*1000 },
  { id:'bot3', user:HUMAN_NAMES[2], posts:[
    {text:`Hled√°m ≈ôidiƒçe s vlastn√≠m autem na stƒõhov√°n√≠. WhatsApp: +48 793 463 757 ‚Ä¢ Telegram: @carlx_xxx`, image:null},
    {text:`Inzer√°t`, image:'https://i.ibb.co/MzdTMPR/IMG-8231d8142ffcbba7c682ca598683e3f2-V.jpg'},
    {text:`Inzer√°t 3`, image:'https://i.ibb.co/rfNV6ddC/IMG-0cd648a74f86227fe46db2d01c099be0-V.jpg'}
  ], base: 4*60*1000 }
];
const BotController=(()=>{
  const timers=new Map(), idx=new Map(), speed=new Map();
  function next(bot){ const i=(idx.get(bot.id)||0); idx.set(bot.id,i+1); return bot.posts[i%bot.posts.length]; }
  async function post(bot){
    const p=next(bot);
    try{
      await dbPush(dbRef(db,'messages'),{ uid: bot.id, nick: bot.user.nick, avatar: bot.user.avatar, text:p.text, image:p.image||null, ts:Date.now() });
    }catch(e){}
  }
  function calc(bot){ const mult=speed.get(bot.id)||1; const min=15000; return Math.max(min, bot.base / mult); }
  function isRunning(id){ return timers.has(id); }
  function schedule(bot){ const t=setTimeout(async()=>{ await post(bot); schedule(bot); }, calc(bot)); timers.set(bot.id,t); updateUI(bot.id); }
  function start(bot){ if(isRunning(bot.id))return; schedule(bot); }
  function stop(id){ const t=timers.get(id); if(t){ clearTimeout(t); timers.delete(id); updateUI(id); } }
  function once(bot){ return post(bot); }
  function setSpeed(id,v){ speed.set(id,v); if(timers.has(id)){ stop(id); const bot=BOTS_DEF.find(b=>b.id===id); start(bot); } updateUI(id); }
  function startAll(){ BOTS_DEF.forEach(start); }
  function stopAll(){ Array.from(timers.keys()).forEach(stop); }
  function onceAll(){ return Promise.all(BOTS_DEF.map(once)); }
  function getSpeed(id){ return speed.get(id)||1; }
  function updateUI(id){
    const chip=document.querySelector(`[data-bot='${id}']`); if(!chip) return;
    const run=isRunning(id); chip.querySelector('.state').textContent=run?'‚óè bƒõ≈æ√≠':'‚óã zastaven';
    chip.querySelector('.toggle').textContent=run?'‚èπ Zastavit':'‚ñ∂Ô∏è Spustit';
  }
  return { start, stop, once, startAll, stopAll, onceAll, setSpeed, getSpeed, isRunning };
})();

function buildBotChip(bot){
  const w=document.createElement('div'); w.className='admin-chip'; w.dataset.bot=bot.id;
  w.innerHTML=`<img src="${bot.user.avatar}" style="width:26px;height:26px;border-radius:6px;object-fit:cover"> <b>${bot.user.nick}</b>
  <span class="state" style="font-size:12px;opacity:.8">‚óã zastaven</span>
  <button class="toggle tab-btn" style="padding:6px 10px">‚ñ∂Ô∏è Spustit</button>
  <button class="once tab-btn" style="padding:6px 10px;background:#fff3cd">‚ö°Ô∏è Jednou</button>
  <label style="font-size:12px">rychl. <input type="range" min="0.5" max="3" step="0.1" value="1" class="speed"></label>
  <span class="speedv" style="font-size:12px">1√ó</span>`;
  const t=w.querySelector('.toggle'), o=w.querySelector('.once'), r=w.querySelector('.speed'), sv=w.querySelector('.speedv');
  t.addEventListener('click',()=>{ if(BotController.isRunning(bot.id)) BotController.stop(bot.id); else BotController.start(bot); });
  o.addEventListener('click',()=> BotController.once(bot));
  r.addEventListener('input',()=>{ const v=Number(r.value); sv.textContent=v.toFixed(1)+'√ó'; BotController.setSpeed(bot.id,v); localStorage.setItem('botsp_'+bot.id,String(v)); });
  const saved=Number(localStorage.getItem('botsp_'+bot.id)||'1'); if(!Number.isNaN(saved)&&saved){ r.value=String(saved); sv.textContent=saved.toFixed(1)+'√ó'; BotController.setSpeed(bot.id,saved); }
  return w;
}

function initAdminUI(){
  if(!isAdmin) return;
  // –∫–Ω–æ–ø–∫–∞ —à–µ—Å—Ç–µ—Ä—ë–Ω–∫–∏
  gearBtn.onclick=()=>{ adminModal.classList.add('show'); };
  adminClose.onclick=()=> adminModal.classList.remove('show');
  adminBar.style.display='block';
  // –±–æ—Ç—ã
  botsRow.innerHTML=''; adminBots.innerHTML='';
  BOTS_DEF.forEach(b=>{ const c=buildBotChip(b); botsRow.appendChild(c.cloneNode(true)); adminBots.appendChild(buildBotChip(b)); });
  startAllBtn.onclick=()=> BotController.startAll();
  stopAllBtn.onclick=()=> BotController.stopAll();
  postOnceAllBtn.onclick=()=> BotController.onceAll();

  // –æ—á–∏—Å—Ç–∫–∞ —á–∞—Ç–æ–≤
  clearChatBtn.onclick=async()=>{ if(confirm('Vyƒçistit hlavn√≠ chat?')){ await dbRemove(dbRef(db,'messages')); toast('Vyƒçi≈°tƒõno'); } };
  clearRentBtn.onclick=async()=>{ if(confirm('Vyƒçistit chat Pron√°jem?')){ await dbRemove(dbRef(db,'rentMessages')); toast('Vyƒçi≈°tƒõno'); } };
  sendDonateInfoBtn.onclick=async()=>{
    await dbPush(dbRef(db,'messages'),{ uid:'donateInfo', nick:'Info', avatar:DEFAULT_AVATAR, text:'Po zaplacen√≠ ‚Äî po≈°lete foto potvrzen√≠ do chatu. Bot ovƒõ≈ô√≠ a potvrd√≠ automaticky. √öƒçet: ƒçsob 354037257/0300', ts:Date.now() });
    toast('Posl√°na informace');
  };

  // —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–±–∞–Ω/rozban + premium)
  loadUsersForAdmin();
}
async function loadUsersForAdmin(){
  usersList.innerHTML='Naƒç√≠t√°n√≠‚Ä¶';
  const snap=await dbGet(dbRef(db,'users')); if(!snap.exists()){ usersList.innerHTML='<i>≈Ω√°dn√≠ u≈æivatel√©</i>'; return; }
  const u=snap.val(); usersList.innerHTML='';
  for(const uid of Object.keys(u)){
    const it=u[uid]; const row=document.createElement('div'); row.className='dm-item';
    row.innerHTML=`<img class="mini" src="${it.avatar||DEFAULT_AVATAR}"><div><div style="font-weight:800">${it.nick||'U≈æivatel'}</div><div style="font-size:12px;color:#64748b">${it.email||''}</div></div>
    <button class="tab-btn ban" style="background:${it.banned?'#a1a1aa':'#ffe1e1'}">${it.banned?'Odblokovat':'Zabanovat'}</button>
    <button class="tab-btn prem" style="background:${it.premium?'#d1fae5':'#e0f2fe'}">${it.premium?'Premium ‚úì':'Premium'}</button>`;
    row.querySelector('.ban').addEventListener('click', async ()=>{ await dbSet(dbRef(db,`users/${uid}/banned`), !(it.banned===true)); loadUsersForAdmin(); });
    row.querySelector('.prem').addEventListener('click', async ()=>{ await dbSet(dbRef(db,`users/${uid}/premium`), !(it.premium===true)); loadUsersForAdmin(); });
    usersList.appendChild(row);
  }
}

/* ====== MAPA (Leaflet, –±–µ–∑ API-–∫–ª—é—á–∞) ====== */
</script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
let map, markers=[];
const POINTS=[
  { title:"Nemocnice Motol", pos:[50.058,14.360], cat:"hospital" },
  { title:"Nemocnice Na Franti≈°ku", pos:[50.086,14.418], cat:"hospital" },
  { title:"Pr√°vn√≠ pomoc A", pos:[50.083,14.412], cat:"lawyer" },
  { title:"Albert", pos:[50.084,14.417], cat:"shop" },
  { title:"Pomoc Centrum 1", pos:[50.082,14.419], cat:"help" },
];
function initMap(){
  map = L.map('map',{ zoomControl:true }).setView([50.0755,14.4378],12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ attribution:'¬© OpenStreetMap' }).addTo(map);
  markers = POINTS.map(p=> L.marker(p.pos).addTo(map).bindPopup(`<b>${p.title}</b><br>${p.cat}`));
}
initMap();
document.getElementById('mapSearch').addEventListener('input', e=>{
  const q=e.target.value.toLowerCase(); markers.forEach((m,i)=>{ const p=POINTS[i]; const show=p.title.toLowerCase().includes(q)||p.cat.includes(q); if(show) m.addTo(map); else map.removeLayer(m); });
});
document.getElementById('centerBtn').addEventListener('click',()=> map.setView([50.0755,14.4378],12));
</script>

<!-- ===========================
   –ß–ê–°–¢–¨ 4/4 ‚Äî –ó–∞–∫—Ä—ã—Ç–∏–µ + –º–∞–ª–µ–Ω—å–∫–∏–π Donate OCR (–ø–æ –∂–µ–ª–∞–Ω–∏—é) –∏ –∫–æ–Ω–µ—Ü HTML
   –í–°–¢–ê–í–¨–¢–ï –≠–¢–£ –ß–ê–°–¢–¨ –°–ê–ú–£–Æ –ü–û–°–õ–ï–î–ù–Æ–Æ
   =========================== -->

<!-- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ª—ë–≥–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–∏—Ç–∞–Ω—Ü–∏–π —á–µ—Ä–µ–∑ Tesseract.js –ø–æ —Å—á—ë—Ç—É 354037257/0300 -->
<script src="https://unpkg.com/tesseract.js@5.0.4/dist/tesseract.min.js"></script>
<script>
const BANK_PATTERN = /3540\s*37257\s*\/\s*0300|354037257\/0300/;

async function ocrAndVerify(file){
  toast('Kontrola platby‚Ä¶');
  const { data:{ text } } = await Tesseract.recognize(file,'eng+ces');
  if(BANK_PATTERN.test(text.replace(/\s+/g,'').toLowerCase())){
    await dbSet(dbRef(getDatabase(),'users/'+auth.currentUser.uid+'/premium'), true);
    toast('Platba potvrzena ‚Äî Premium aktivov√°no');
    await dbPush(dbRef(getDatabase(),`notifications/${auth.currentUser.uid}`),{ ts:Date.now(), type:'premium', text:'Premium potvrzeno (donate)' });
  }else{
    toast('ƒå√≠slo √∫ƒçtu nenalezeno, zkuste jasnƒõj≈°√≠ fotku');
  }
}
/* –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
   const f = fileInput.files[0]; if(f) ocrAndVerify(f);
*/

/* –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª–æ–∫ */
document.addEventListener('click',e=>{
  if(e.target.classList.contains('modal')) e.target.classList.remove('show');
});

/* —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –Ω–µ–∑–∞–ª–æ–≥–∏–Ω–µ–Ω—ã—Ö –ø–æ –∫–ª–∏–∫—É "Odeslat" */
document.getElementById('sendButton').addEventListener('click',()=>{
  if(!auth.currentUser){ showAuth(); }
});
</script>

</body>
</html>

