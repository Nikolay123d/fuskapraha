<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>PR√ÅCE CZ CHAT</title>
  <link rel="stylesheet" href="./style.css"/>
  <link rel="preload" as="image" href="./img/bg.jpg">
  <script>
    // Apply last wallpaper ASAP (no flicker)
    (function(){
      try{
        var city = localStorage.getItem('city') || 'praha';
        var w = localStorage.getItem('wall_'+city) || localStorage.getItem('wall') || '';
        if(!w) return;
        var st=document.createElement('style');
        st.textContent=":root{--wall:url('"+String(w).replace(/'/g,"%27")+"')}";
        document.head.appendChild(st);
      }catch(e){}
    })();
  </script>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>

<div id="preloader">
  <div class="box">
    <div class="spin"></div>
    <div style="font-weight:800">Naƒç√≠t√°n√≠‚Ä¶</div>
    <div class="hint">P≈ôipravujeme chat a pozad√≠</div>
    <div class="timer" id="preloaderTimer">Automaticky p≈ôejdeme za 10 s</div>
    <button class="btn" id="goSiteBtn" type="button">P≈ôej√≠t na web</button>
  </div>
</div>

<div class="topbar">
  <div class="brand">PR√ÅCE CZ CHAT</div>
  <div class="row" style="margin:0">
    <div class="citysel">
      <select id="citySelect">
        <option value="praha">Praha</option>
        <option value="brno">Brno</option>
        <option value="olomouc">Olomouc</option>
        <option value="ostrava">Ostrava</option>
      </select>
    </div>

    <label class="filebtn" title="Zmƒõnit pozad√≠">
      üì∑
      <input id="wallCamera" type="file" accept="image/*" capture="environment">
    </label>

    <button class="ghost" id="toggleTabs" type="button">Menu</button>
    <button class="ghost" id="btnLogin" type="button">P≈ôihl√°≈°en√≠</button>
    <button class="ghost" id="btnSignout" type="button">Odhl√°sit</button>
  </div>
</div>

<div class="tabs" id="tabs">
  <a class="tab active" href="#" data-view="view-chat">Chat</a>
  <a class="tab" href="#" data-view="view-dm">Osobn√≠ (DM)</a>
  <a class="tab" href="#" data-view="view-friends">P≈ô√°tel√© <span id="friendsBadge"></span></a>
  <a class="tab" href="#" data-view="view-rent">Pron√°jem</a>
  <a class="tab" href="#" data-view="view-map">Mapa</a>
  <a class="tab" href="#" data-view="view-profile">Profil</a>
  <a class="tab adm-only" style="display:none" href="#" data-view="view-admin">Admin</a>
</div>

<div id="views">
  <section class="view active" id="view-chat">
    <div class="feed" id="chatFeed"></div>
    <div class="composer sticky">
      <input id="msgText" placeholder="Napi≈°te zpr√°vu‚Ä¶">
      <label class="filebtn" title="Foto">
        üìé<input id="msgPhoto" type="file" accept="image/*">
      </label>
      <button id="sendBtn" type="button">Odeslat</button>
    </div>
  </section>

  <section class="view" id="view-dm">
    <div class="row">
      <input id="dmTo" placeholder="UID nebo e-mail p≈ô√≠jemce" style="flex:1;min-width:220px">
      <button id="dmOpen" type="button">Otev≈ô√≠t</button>
    </div>
    <div class="feed" id="dmFeed" style="min-height:40vh"></div>
    <div class="composer sticky">
      <input id="dmText" placeholder="Zpr√°va‚Ä¶">
      <label class="filebtn" title="Foto">
        üìé<input id="dmPhoto" type="file" accept="image/*">
      </label>
      <button id="dmSend" type="button">Odeslat</button>
    </div>
  </section>

  <section class="view" id="view-friends">
    <div class="row">
      <input id="friendEmail" placeholder="E-mail u≈æivatele" style="flex:1;min-width:260px">
      <button id="friendAddBtn" type="button">P≈ôidat do p≈ô√°tel</button>
    </div>
    <div class="feed" id="friendsList"></div>
  </section>

  <section class="view" id="view-rent">
    <div class="row">
      <input id="rentTitle" placeholder="N√°zev" style="flex:2;min-width:220px">
      <input id="rentPrice" placeholder="Cena Kƒç" type="number" style="width:140px">
      <select id="rentTTL">
        <option value="0">Bez expirace</option>
        <option value="7">7 dn≈Ø</option>
        <option value="14">14 dn≈Ø</option>
        <option value="30">30 dn≈Ø</option>
      </select>
      <label class="filebtn">üìé<input id="rentPhoto" type="file" accept="image/*"></label>
      <button id="rentAdd" type="button">P≈ôidat</button>
    </div>
    <div class="row">
      <select id="rentStatus">
        <option value="">V≈°e</option>
        <option value="active">Aktivn√≠</option>
        <option value="closed">Uzav≈ôen√©</option>
      </select>
      <select id="rentSort">
        <option value="new">Nejnovƒõj≈°√≠</option>
        <option value="price">Cena</option>
      </select>
      <button id="rentApply" type="button">Pou≈æ√≠t</button>
    </div>
    <div class="feed" id="rentFeed"></div>
  </section>

  <section class="view" id="view-map">
    <div class="map" id="map"></div>
    <div class="muted" style="margin-top:8px">Tip: mod/admin m≈Ø≈æe p≈ôid√°vat body a upravovat je podle pravidel.</div>
  </section>

  <section class="view" id="view-profile">
    <div class="row">
      <img id="myAvatar" class="ava-lg" src="./img/default-avatar.svg" alt="avatar">
      <div>
        <div><b id="myName">U≈æivatel</b></div>
        <div class="muted" id="profileEmail">E-mail: ‚Äî</div>
        <div class="muted">Pozn.: nick se bere z usersPublic a zobrazuje se ve v≈°ech chatech/DM.</div>
      </div>
    </div>
    <div class="row">
      <input id="setNick" placeholder="Nick (edit)" style="flex:1;min-width:220px">
      <input id="setAvatarUrl" placeholder="URL avatara (nebo pou≈æij üì∑)" style="flex:2;min-width:260px">
      <select id="setRole">
        <option value="seeker">Hled√°m pr√°ci</option>
        <option value="employer">Zamƒõstnavatel</option>
      </select>
      <label class="filebtn" title="Avatar z telefonu">üì∑<input id="avatarFile" type="file" accept="image/*"></label>
      <button id="saveProfile" type="button">Ulo≈æit</button>
      <button id="resetPass" type="button">Zapomenut√© heslo</button>
    </div>
  </section>

  <section class="view" id="view-admin">
    <div class="adm-only">
      <div class="row">
        <input id="roleUid" placeholder="UID" style="min-width:260px">
        <input id="banReason" placeholder="D≈Øvod" style="flex:1;min-width:240px">
        <button id="makeMod" type="button">+ MOD</button>
        <button id="removeMod" type="button">- MOD</button>
        <button id="ban30" type="button">Ban 30 min</button>
        <button id="unban" type="button">Unban</button>
      </div>
      <div class="row">
        <button id="clearChat" type="button">Vyƒçistit chat (mƒõsto)</button>
      </div>
    </div>
  </section>
</div>

<div id="cookieBanner" class="toast" style="position:fixed;left:50%;transform:translateX(-50%);bottom:20px;display:none">
  Pou≈æ√≠v√°me cookies pro lep≈°√≠ funkce webu.
  <button class="ghost" id="cookieAccept" type="button">Souhlas√≠m</button>
</div>

<div id="greetOverlay" class="modal" hidden>
  <div class="card">
    <header>
      <b>Vzkaz</b>
      <button class="ghost" id="greetClose" type="button">√ó</button>
    </header>
    <img class="rose" src="./img/rose.svg" alt="Rose">
    <h2 style="margin:10px 0 6px">Jsi ta nejkr√°snƒõj≈°√≠ d√≠vka</h2>
    <div class="muted">Toto je od zakladatele. (Zav≈ôe se za <span id="greetSec">10</span> s)</div>
    <div class="row" style="justify-content:center;margin-top:10px">
      <button class="ghost" id="greetDm" type="button">Napsat zakladateli</button>
      <button class="ghost" id="greetAddFriend" type="button">P≈ôidat do p≈ô√°tel</button>
    </div>
  </div>
</div>

<div id="globalToast" class="toast" style="display:none"></div>

<script src="./app.js"></script>
</body>
</html>
