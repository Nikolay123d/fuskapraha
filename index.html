<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>makame.cz — PRÁCE CZ CHAT</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="./style.css">
  <script>
  // Early bg: remove flicker
  (function(){
    try{
      var city=(localStorage.getItem('city')||'praha').toLowerCase();
      var key='bg_'+city;
      var url=localStorage.getItem(key)||localStorage.getItem('bg_default');
      if(url){
        var st=document.createElement('style');
        st.textContent='body{background-image:url('+JSON.stringify(url)+');background-size:cover;background-position:center;background-attachment:fixed;background-color:#091317}';
        document.head.appendChild(st);
      }
    }catch(e){}
  })();
  </script>
</head>
<body>
<div id="preloader"><div class="loader"></div>Načítám…</div>

<header class="topbar">
  <div class="left">
    <button id="toggleTabs" class="ghost">☰ Menu</button>
    <div class="brand">makame.cz <span class="slogan" data-i18n="brand_slogan">— práce začíná z makame.cz</span></div>
    <label class="citysel">
      <span data-i18n="city">Město:</span>
      <select id="citySelect">
        <option value="praha">Praha</option>
        <option value="brno">Brno</option>
        <option value="ostrava">Ostrava</option>
        <option value="plzen">Plzeň</option>
        <option value="olomouc">Olomouc</option>
      </select>
    </label>
  </div>
  <div class="mid"><span id="onlineCounter">Online ~0</span></div>
  <div class="right">
    <button id="participantsBtn" title="Účastníci" data-view="view-chat">👥</button>
    <button id="friendsBtn" title="Přátelé" data-view="view-friends">👫</button>
    <button id="profileBtn" title="Profil" data-view="view-profile">Profil</button>
  </div>
</header>

<nav class="tabs" id="tabs">
  <button data-view="view-chat" class="tab active" data-i18n="chat">💬 Chat</button>
  <button data-view="view-rent" class="tab" data-i18n="rent">🏠 Pronájem</button>
  <button data-view="view-map" class="tab" data-i18n="map">🗺️ Mapa</button>
  <button data-view="view-dm" class="tab" data-i18n="dm">✉️ Osobní</button>
  <button data-view="view-help" class="tab" data-i18n="help">🆘 Pomoc</button>
  <button data-view="view-announce" class="tab" data-i18n="announce">📢 Oznámení</button>
  <button data-view="view-admin" class="tab adm-only">🛠 <span data-i18n="admin">Admin</span></button>
</nav>

<main id="views">
  <!-- CHAT -->
  <section id="view-chat" class="view active">
    <div id="chatFeed" class="feed"></div>
    <div id="chatToast" class="toast" hidden>✔️ Fotka přidána. Klikněte „Odeslat“.</div>
    <div class="composer sticky">
      <label class="filebtn" title="Foto"><input type="file" id="chatFile" accept="image/*" capture="environment">📷</label>
      <input id="chatInput" placeholder="Napište zprávu… (může být URL na obrázek)">
      <button id="chatSend">Odeslat</button>
      <button id="clearChat" class="adm-only">🧹 Vyčistit</button>
    </div>
  </section>

  <!-- RENT with filters/sort -->
  <section id="view-rent" class="view">
    <div class="row">
      <input id="rentSearch" placeholder="Hledat…">
      <select id="rentCityFilter">
        <option value="">Všechna města</option>
        <option>Praha</option><option>Brno</option><option>Ostrava</option><option>Plzeň</option><option>Olomouc</option>
      </select>
      <select id="rentSort">
        <option value="ts_desc">Nejnovější</option>
        <option value="price_asc">Cena ↑</option>
        <option value="price_desc">Cena ↓</option>
      </select>
      <button id="rentApply">Filtr</button>
    </div>
    <div id="rentFeed" class="feed"></div>
    <div class="composer sticky">
      <label class="filebtn"><input type="file" id="rentFile" accept="image/*" capture="environment">📷</label>
      <input id="rentInput" placeholder="Inzerát… (např. 2+kk, 20 000 Kč, Praha)">
      <button id="rentSend">Odeslat</button>
    </div>
  </section>

  <!-- MAP (POI photo base64) -->
  <section id="view-map" class="view">
    <div class="row">
      <button id="mapCenter">Centrovat</button>
      <label class="filebtn adm-only" title="Pozadí města"><input type="file" id="cityBgFile" accept="image/*" capture="environment">📷</label>
      <input id="cityBgUrl" class="adm-only" placeholder="URL pozadí">
      <button id="saveCityBg" class="adm-only">Uložit</button>
    </div>
    <div id="map" class="map"></div>
    <div class="adm-only row">
      <input id="poiTitle" placeholder="Název">
      <input id="poiType" placeholder="Typ (vol/help/pharm)">
      <input id="poiAvatar" placeholder="URL avataru (volitelně)">
      <input id="poiPhoto" placeholder="URL nebo nechte prázdné (využijte 📷)">
      <label class="filebtn"><input type="file" id="poiFile" accept="image/*" capture="environment">📷</label>
      <input id="poiLat" placeholder="lat (volitelně)">
      <input id="poiLng" placeholder="lng (volitelně)">
      <button id="poiAdd">Přidat bod</button>
    </div>
  </section>

  <!-- DMs -->
  <section id="view-dm" class="view">
    <div class="dm">
      <aside id="dmSidebar"></aside>
      <div class="dmThread">
        <div id="dmHeader"></div>
        <div id="dmMessages"></div>
        <div id="dmToast" class="toast" hidden>✔️ Fotka přidána do OS. Klikněte „Odeslat“.</div>
        <div class="composer sticky">
          <label class="filebtn"><input type="file" id="dmFile" accept="image/*" capture="environment">📷</label>
          <input id="dmInput" placeholder="Zpráva…">
          <button id="dmSend">Odeslat</button>
        </div>
      </div>
    </div>
  </section>

  <!-- FRIENDS -->
  <section id="view-friends" class="view">
    <div class="card">
      <header><b>Přátelé</b></header>
      <div class="row">
        <input id="friendEmail" placeholder="E-mail">
        <button id="friendAddBtn">Přidat</button>
      </div>
      <div id="friendsList"></div>
      <hr>
      <div><b data-i18n="requests">Žádosti o přátelství</b></div>
      <div class="row"><div style="flex:1"><b data-i18n="incoming">Příchozí</b><div id="reqIncoming"></div></div><div style="flex:1"><b data-i18n="outgoing">Odchozí</b><div id="reqOutgoing"></div></div></div>
    </div>
  </section>

  <!-- HELP -->
  <section id="view-help" class="view">
    <div class="adm-only row">
      <input id="helpTitle" placeholder="Nadpis">
      <input id="helpLink" placeholder="Odkaz (https://…)">
      <input id="helpImage" placeholder="URL obrázku">
      <button id="helpPost">Publikovat</button>
    </div>
    <div id="helpGrid" class="cards"></div>
  </section>

  <!-- Announce -->
  <section id="view-announce" class="view">
    <div class="adm-only row">
      <input id="anTitle" placeholder="Téma">
      <input id="anImage" placeholder="URL fotky (volitelně)">
      <textarea id="anText" placeholder="Text"></textarea>
      <button id="anPost">Publikovat</button>
    </div>
    <div id="anGrid" class="cards"></div>
  </section>

  <!-- Admin -->
  <section id="view-admin" class="view">
    <div class="card adm-only">
      <h3 role="heading">Role / Moderace</h3>
      <div class="row">
        <input id="roleUid" placeholder="UID uživatele">
        <button id="makeMod">+ Moderátor</button>
        <button id="removeMod">– Moderátor</button>
        <button id="ban30">⛔ Ban 30 min</button>
        <input id="banReason" placeholder="Důvod">
        <button id="unban">✅ Unban</button>
      </div>
      <h4>Stížnosti</h4>
      <div id="reportsBox"></div>
    </div>

    <div class="card adm-only">
      <h3>Boty</h3>
      <div class="row">
        <input id="botCity" placeholder="Město (praha)">
        <input id="botText" placeholder="Text">
        <input id="botImage" placeholder="URL obrázku (volitelně)">
        <select id="botInterval">
          <option value="2">každé 2 min</option>
          <option value="5">každých 5 min</option>
          <option value="15" selected>každých 15 min</option>
        </select>
        <button id="botStart">Start</button>
        <button id="botStop">Stop</button>
      </div>
    </div>
  </section>
</main>

<!-- Profile modal -->
<section id="view-profile" class="view">
  <div class="card">
    <header><b>Můj profil</b></header>
    <div class="row">
      <label class="filebtn"><input type="file" id="avatarFile" accept="image/*" capture="environment">📷</label>
      <img id="myAvatar" class="ava-lg" src="./img/default-avatar.svg" alt="">
      <div>
        <div><b id="myName">Anonym</b></div>
        <div class="muted">Role: <span id="myRole">seeker</span> · Tarif: <span id="myPlan">free</span></div>
      </div>
    </div>
    <div class="row">
      <input id="setNick" placeholder="Nový nick">
      <input id="setAvatarUrl" placeholder="URL avataru (volitelně)">
      <select id="setRole">
        <option value="seeker">Hledám práci</option>
        <option value="employer">Zaměstnavatel</option>
      </select>
      <button id="saveProfile">Uložit</button>
    </div>
    <div class="row">
      <button id="askNick"><span data-i18n="askNick">Požádat o změnu nicku</span></button>
      <button id="qrPay"><span data-i18n="qrPay">QR platba</span></button>
      <button id="buyPremium"><span data-i18n="buyPremium">Koupit Premium</span></button>
      <button id="resetPass"><span data-i18n="resetPass">Obnovit heslo</span></button>
      <button id="btnSignout"><span data-i18n="signout">Odhlásit</span></button>
    </div>
  </div>
</section>

<!-- Dasha greeting overlay -->
<div id="greetOverlay" class="modal" hidden>
  <div class="card" style="text-align:center">
    <header>
      <b>Для найкрасивішої дівчини 🌹</b>
      <button id="greetClose">✖</button>
    </header>
    <div>
      <img src="./img/rose.svg" alt="rose" style="max-width:220px;margin:10px auto;display:block;border-radius:14px">
      <p>Ти найкраща! Від творця сайту 💚</p>
      <div class="row" style="justify-content:center">
        <button data-view="view-dm">Написати в ЛС</button>
        <button data-view="view-friends">Додати в друзі</button>
      </div>
    </div>
  </div>
</div>

<!-- libs -->
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-database-compat.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- app -->
<script src="./config.js"></script>
<script src="./utils.js"></script>
<script src="./i18n.js"></script>
<script src="./helpers.js"></script>
<script src="./chat.js"></script>
<script src="./dm.js"></script>
<script src="./friends.js"></script>
<script src="./map.js"></script>
<script src="./bots.js"></script>
<script src="./presence.js"></script>
<script src="./diagnostics.js"></script>
<script src="./auth.js"></script>
<script src="./rent.js"></script>
<script src="./app.js"></script>
<script src="./sw-register.js"></script>

</body>
</html>