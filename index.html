<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<title>PRAHA FU≈†KY</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-storage-compat.js"></script>
<style>
:root{
 --wall:url("https://i.ibb.co/pr18RzG3/charles-bridge-prague.jpg");
 --header-h:52px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:sans-serif;background:transparent}
body{overflow:hidden}
#walls{position:fixed;inset:0;background:var(--wall) center/cover no-repeat;z-index:0}
#app{position:relative;z-index:1;height:100%;display:flex;flex-direction:column}
header{height:var(--header-h);display:flex;align-items:center;gap:8px;padding:4px 8px;background:rgba(0,0,0,.55);color:#fff}
header .brand{flex:1;font-weight:bold}
header .ava{width:36px;height:36px;border-radius:50%;object-fit:cover;border:1px solid #333;cursor:pointer}
#tabs{display:flex;gap:4px;overflow-x:auto;padding:4px;background:rgba(0,0,0,.45);color:#fff}
#tabs button{background:#222;color:#fff;border:none;border-radius:6px;padding:6px 10px;cursor:pointer;flex:1}
#tabs button.active{background:#0a84ff}
main{flex:1;position:relative;overflow:hidden}
.view{position:absolute;inset:0;display:none}
.view.active{display:flex}
.view-column{flex:1;display:flex;flex-direction:column}
.feed{flex:1;overflow-y:auto;padding:8px;display:flex;flex-direction:column;gap:8px}
.msg{display:flex;gap:6px;background:rgba(255,255,255,.9);border-radius:10px;padding:6px}
.msg .ava{width:30px;height:30px;border-radius:50%;object-fit:cover}
.msg .meta{font-size:12px;color:#666}
.composer{display:flex;gap:4px;padding:4px;background:rgba(255,255,255,.85)}
.composer input[type=text]{flex:1;padding:6px;border-radius:6px;border:1px solid #ccc}
.composer input[type=file]{display:none}
.composer label{cursor:pointer}
#notif{position:fixed;right:10px;top:10px;background:#ffc;border:1px solid #aa9;padding:8px;border-radius:6px;display:none;z-index:5}
#notif button{float:right;border:none;background:transparent;font-size:16px;cursor:pointer}
#profileModal,#dmModal,#adminModal,#payModal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;justify-content:center;align-items:center;z-index:6}
.modal-card{background:#fff;border-radius:8px;max-width:420px;max-height:90%;overflow:auto;padding:12px}
.modal-card h3{margin-top:0}
.list{display:flex;flex-direction:column;gap:6px}
.friend-row,.dm-row{display:flex;align-items:center;gap:8px;padding:4px;background:#f5f5f5;border-radius:6px}
.friend-row img,.dm-row img{width:32px;height:32px;border-radius:50%;object-fit:cover}
#adminPanel{display:flex;flex-direction:column;gap:8px}
#adminPanel textarea{width:100%;height:60px}
@media(max-width:600px){
 header .brand{font-size:14px}
 #tabs{flex-wrap:wrap}
}
</style>
</head>
<body>
<div id="walls"></div>
<div id="app">
<header>
 <img id="myAva" class="ava" src="https://i.pravatar.cc/64" alt="">
 <div class="brand">PRAHA FU≈†KY</div>
 <select id="citySel">
   <option value="praha">Praha</option><option value="brno">Brno</option>
   <option value="ostrava">Ostrava</option><option value="plzen">Plze≈à</option>
   <option value="olomouc">Olomouc</option><option value="liberec">Liberec</option>
   <option value="usti">√öst√≠ n/L</option><option value="hradec">Hradec</option>
   <option value="pardubice">Pardubice</option><option value="cbudejovice">ƒå. Budƒõj–æ–≤ice</option>
 </select>
</header>
<nav id="tabs">
 <button data-view="chat" class="active">–ß–∞—Ç</button>
 <button data-view="rent">–û—Ä–µ–Ω–¥–∞</button>
 <button data-view="map">–ö–∞—Ä—Ç–∞</button>
 <button data-view="friends">–î—Ä—É–∑—ñ</button>
 <button data-view="dm">–û—Å–æ–±–∏—Å—Ç—ñ</button>
 <button data-view="help">–î–æ–ø–æ–º–æ–≥–∞</button>
 <button data-view="admin" class="adminBtn" style="display:none">–ê–¥–º—ñ–Ω</button>
</nav>
<main>
<section id="view-chat" class="view active">
 <div class="view-column">
  <div id="chatFeed" class="feed"></div>
  <div class="composer">
   <label>üì∑<input id="chatPhoto" type="file" accept="image/*"></label>
   <input id="chatInput" type="text" placeholder="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è‚Ä¶">
   <button id="chatSend">‚û§</button>
  </div>
 </div>
</section>
<section id="view-rent" class="view">
 <div class="view-column">
  <div id="rentFeed" class="feed"></div>
  <div class="composer">
   <label>üì∑<input id="rentPhoto" type="file" accept="image/*"></label>
   <input id="rentInput" type="text" placeholder="–û–≥–æ–ª–æ—à–µ–Ω–Ω—è‚Ä¶">
   <button id="rentSend">‚û§</button>
  </div>
 </div>
</section>
<section id="view-map" class="view"><div id="map" style="flex:1"></div></section>
<section id="view-friends" class="view">
 <div class="view-column">
  <h3>–ó–∞—è–≤–∫–∏</h3><div id="friendReq" class="list"></div>
  <h3>–ú–æ—ó –¥—Ä—É–∑—ñ</h3><div id="friendsList" class="list"></div>
 </div>
</section>
<section id="view-dm" class="view">
 <div class="view-column">
  <aside id="dmSide" class="list" style="overflow-y:auto;height:100px"></aside>
  <div id="dmFeed" class="feed"></div>
  <div class="composer">
    <label>üì∑<input id="dmPhoto" type="file" accept="image/*"></label>
    <input id="dmInput" type="text" placeholder="–û—Å–æ–±–∏—Å—Ç–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è‚Ä¶">
    <button id="dmSend">‚û§</button>
  </div>
 </div>
</section>
<section id="view-help" class="view"><div id="helpGrid" class="feed"></div></section>
<section id="view-admin" class="view">
 <div id="adminPanel">
  <h3>–ö–µ—Ä—É–≤–∞–Ω–Ω—è –±–æ—Ç–∞–º–∏</h3>
  <div id="botList"></div>
  <button id="botAdd">–ù–æ–≤–∏–π –±–æ—Ç</button>
  <h3>–û–±–æ—ó</h3>
  <input id="wallUrlInput" placeholder="URL –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è">
  <button id="wallSave">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
  <button id="wallLocal">–¢—ñ–ª—å–∫–∏ –º–µ–Ω—ñ</button>
 </div>
</section>
</main>
<footer style="text-align:center;padding:6px;background:rgba(0,0,0,.55);color:#fff">
 2025
</footer>
</div>
<div id="notif"><button id="notifClose">‚úñ</button><span id="notifText"></span></div>
<div id="profileModal"><div class="modal-card">
 <h3 id="profName"></h3>
 <img id="profAva" src="" style="width:72px;height:72px;border-radius:50%;object-fit:cover">
 <p id="profInfo"></p>
 <button id="profAddFriend">+ –î–æ–¥–∞—Ç–∏</button>
 <button id="profMsg">–ù–∞–ø–∏—Å–∞—Ç–∏</button>
 <button id="profClose">–ó–∞–∫—Ä–∏—Ç–∏</button>
</div></div>
<div id="dmModal"><div class="modal-card"><h3 id="dmHeader"></h3>
 <div id="dmThread" class="feed" style="height:200px"></div>
 <div class="composer">
  <label>üì∑<input id="dmModalPhoto" type="file" accept="image/*"></label>
  <input id="dmModalInput" type="text" placeholder="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è‚Ä¶">
  <button id="dmModalSend">‚û§</button>
 </div>
 <button id="dmClose">–ó–∞–∫—Ä–∏—Ç–∏</button>
</div></div>
<div id="adminModal"><div class="modal-card"><h3>–ê–¥–º—ñ–Ω</h3><div id="adminContent"></div><button id="adminClose">–ó–∞–∫—Ä–∏—Ç–∏</button></div></div>
<div id="payModal"><div class="modal-card">
 <h3>–û–ø–ª–∞—Ç–∞</h3>
 <p>–ù–∞–¥—ñ—à–ª—ñ—Ç—å —Ñ–æ—Ç–æ —á–µ–∫–∞/–æ–ø–ª–∞—Ç–∏.</p>
 <input id="payFile" type="file" accept="image/*">
 <button id="paySend">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
 <button id="payClose">–ó–∞–∫—Ä–∏—Ç–∏</button>
</div></div>
<audio id="snd" src="notify.mp3" preload="auto"></audio>
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<title>PRAHA FU≈†KY</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-storage-compat.js"></script>
<style>
:root{
 --wall:url("https://i.ibb.co/pr18RzG3/charles-bridge-prague.jpg");
 --header-h:52px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:sans-serif;background:transparent}
body{overflow:hidden}
#walls{position:fixed;inset:0;background:var(--wall) center/cover no-repeat;z-index:0}
#app{position:relative;z-index:1;height:100%;display:flex;flex-direction:column}
header{height:var(--header-h);display:flex;align-items:center;gap:8px;padding:4px 8px;background:rgba(0,0,0,.55);color:#fff}
header .brand{flex:1;font-weight:bold}
header .ava{width:36px;height:36px;border-radius:50%;object-fit:cover;border:1px solid #333;cursor:pointer}
#tabs{display:flex;gap:4px;overflow-x:auto;padding:4px;background:rgba(0,0,0,.45);color:#fff}
#tabs button{background:#222;color:#fff;border:none;border-radius:6px;padding:6px 10px;cursor:pointer;flex:1}
#tabs button.active{background:#0a84ff}
main{flex:1;position:relative;overflow:hidden}
.view{position:absolute;inset:0;display:none}
.view.active{display:flex}
.view-column{flex:1;display:flex;flex-direction:column}
.feed{flex:1;overflow-y:auto;padding:8px;display:flex;flex-direction:column;gap:8px}
.msg{display:flex;gap:6px;background:rgba(255,255,255,.9);border-radius:10px;padding:6px}
.msg .ava{width:30px;height:30px;border-radius:50%;object-fit:cover}
.msg .meta{font-size:12px;color:#666}
.composer{display:flex;gap:4px;padding:4px;background:rgba(255,255,255,.85)}
.composer input[type=text]{flex:1;padding:6px;border-radius:6px;border:1px solid #ccc}
.composer input[type=file]{display:none}
.composer label{cursor:pointer}
#notif{position:fixed;right:10px;top:10px;background:#ffc;border:1px solid #aa9;padding:8px;border-radius:6px;display:none;z-index:5}
#notif button{float:right;border:none;background:transparent;font-size:16px;cursor:pointer}
#profileModal,#dmModal,#adminModal,#payModal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;justify-content:center;align-items:center;z-index:6}
.modal-card{background:#fff;border-radius:8px;max-width:420px;max-height:90%;overflow:auto;padding:12px}
.modal-card h3{margin-top:0}
.list{display:flex;flex-direction:column;gap:6px}
.friend-row,.dm-row{display:flex;align-items:center;gap:8px;padding:4px;background:#f5f5f5;border-radius:6px}
.friend-row img,.dm-row img{width:32px;height:32px;border-radius:50%;object-fit:cover}
#adminPanel{display:flex;flex-direction:column;gap:8px}
#adminPanel textarea{width:100%;height:60px}
@media(max-width:600px){
 header .brand{font-size:14px}
 #tabs{flex-wrap:wrap}
}
</style>
</head>
<body>
<div id="walls"></div>
<div id="app">
<header>
 <img id="myAva" class="ava" src="https://i.pravatar.cc/64" alt="">
 <div class="brand">PRAHA FU≈†KY</div>
 <select id="citySel">
   <option value="praha">Praha</option><option value="brno">Brno</option>
   <option value="ostrava">Ostrava</option><option value="plzen">Plze≈à</option>
   <option value="olomouc">Olomouc</option><option value="liberec">Liberec</option>
   <option value="usti">√öst√≠ n/L</option><option value="hradec">Hradec</option>
   <option value="pardubice">Pardubice</option><option value="cbudejovice">ƒå. Budƒõj–æ–≤ice</option>
 </select>
</header>
<nav id="tabs">
 <button data-view="chat" class="active">–ß–∞—Ç</button>
 <button data-view="rent">–û—Ä–µ–Ω–¥–∞</button>
 <button data-view="map">–ö–∞—Ä—Ç–∞</button>
 <button data-view="friends">–î—Ä—É–∑—ñ</button>
 <button data-view="dm">–û—Å–æ–±–∏—Å—Ç—ñ</button>
 <button data-view="help">–î–æ–ø–æ–º–æ–≥–∞</button>
 <button data-view="admin" class="adminBtn" style="display:none">–ê–¥–º—ñ–Ω</button>
</nav>
<main>
<section id="view-chat" class="view active">
 <div class="view-column">
  <div id="chatFeed" class="feed"></div>
  <div class="composer">
   <label>üì∑<input id="chatPhoto" type="file" accept="image/*"></label>
   <input id="chatInput" type="text" placeholder="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è‚Ä¶">
   <button id="chatSend">‚û§</button>
  </div>
 </div>
</section>
<section id="view-rent" class="view">
 <div class="view-column">
  <div id="rentFeed" class="feed"></div>
  <div class="composer">
   <label>üì∑<input id="rentPhoto" type="file" accept="image/*"></label>
   <input id="rentInput" type="text" placeholder="–û–≥–æ–ª–æ—à–µ–Ω–Ω—è‚Ä¶">
   <button id="rentSend">‚û§</button>
  </div>
 </div>
</section>
<section id="view-map" class="view"><div id="map" style="flex:1"></div></section>
<section id="view-friends" class="view">
 <div class="view-column">
  <h3>–ó–∞—è–≤–∫–∏</h3><div id="friendReq" class="list"></div>
  <h3>–ú–æ—ó –¥—Ä—É–∑—ñ</h3><div id="friendsList" class="list"></div>
 </div>
</section>
<section id="view-dm" class="view">
 <div class="view-column">
  <aside id="dmSide" class="list" style="overflow-y:auto;height:100px"></aside>
  <div id="dmFeed" class="feed"></div>
  <div class="composer">
    <label>üì∑<input id="dmPhoto" type="file" accept="image/*"></label>
    <input id="dmInput" type="text" placeholder="–û—Å–æ–±–∏—Å—Ç–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è‚Ä¶">
    <button id="dmSend">‚û§</button>
  </div>
 </div>
</section>
<section id="view-help" class="view"><div id="helpGrid" class="feed"></div></section>
<section id="view-admin" class="view">
 <div id="adminPanel">
  <h3>–ö–µ—Ä—É–≤–∞–Ω–Ω—è –±–æ—Ç–∞–º–∏</h3>
  <div id="botList"></div>
  <button id="botAdd">–ù–æ–≤–∏–π –±–æ—Ç</button>
  <h3>–û–±–æ—ó</h3>
  <input id="wallUrlInput" placeholder="URL –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è">
  <button id="wallSave">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
  <button id="wallLocal">–¢—ñ–ª—å–∫–∏ –º–µ–Ω—ñ</button>
 </div>
</section>
</main>
<footer style="text-align:center;padding:6px;background:rgba(0,0,0,.55);color:#fff">
 2025
</footer>
</div>
<div id="notif"><button id="notifClose">‚úñ</button><span id="notifText"></span></div>
<div id="profileModal"><div class="modal-card">
 <h3 id="profName"></h3>
 <img id="profAva" src="" style="width:72px;height:72px;border-radius:50%;object-fit:cover">
 <p id="profInfo"></p>
 <button id="profAddFriend">+ –î–æ–¥–∞—Ç–∏</button>
 <button id="profMsg">–ù–∞–ø–∏—Å–∞—Ç–∏</button>
 <button id="profClose">–ó–∞–∫—Ä–∏—Ç–∏</button>
</div></div>
<div id="dmModal"><div class="modal-card"><h3 id="dmHeader"></h3>
 <div id="dmThread" class="feed" style="height:200px"></div>
 <div class="composer">
  <label>üì∑<input id="dmModalPhoto" type="file" accept="image/*"></label>
  <input id="dmModalInput" type="text" placeholder="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è‚Ä¶">
  <button id="dmModalSend">‚û§</button>
 </div>
 <button id="dmClose">–ó–∞–∫—Ä–∏—Ç–∏</button>
</div></div>
<div id="adminModal"><div class="modal-card"><h3>–ê–¥–º—ñ–Ω</h3><div id="adminContent"></div><button id="adminClose">–ó–∞–∫—Ä–∏—Ç–∏</button></div></div>
<div id="payModal"><div class="modal-card">
 <h3>–û–ø–ª–∞—Ç–∞</h3>
 <p>–ù–∞–¥—ñ—à–ª—ñ—Ç—å —Ñ–æ—Ç–æ —á–µ–∫–∞/–æ–ø–ª–∞—Ç–∏.</p>
 <input id="payFile" type="file" accept="image/*">
 <button id="paySend">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
 <button id="payClose">–ó–∞–∫—Ä–∏—Ç–∏</button>
</div></div>
<audio id="snd" src="notify.mp3" preload="auto"></audio>
// profile modal
chatFeed.addEventListener('click',e=>{
 const img=e.target.closest('.msg img.ava');
 if(!img) return;
 const uid=img.dataset.uid; if(!uid) return;
 openProfile(uid);
});
function openProfile(uid){
 db.ref('usersPublic/'+uid).get().then(s=>{
  const v=s.val();if(!v) return;
  document.getElementById('profName').textContent=v.nick||'User';
  document.getElementById('profAva').src=v.ava||'https://i.pravatar.cc/64';
  document.getElementById('profInfo').textContent=v.role||'';
  document.getElementById('profileModal').style.display='flex';
  document.getElementById('profAddFriend').onclick=()=>db.ref('friendRequests/'+uid+'/'+my.uid).set(true);
  document.getElementById('profMsg').onclick=()=>openDM(uid,v.nick);
 });
}
document.getElementById('profClose').onclick=()=>document.getElementById('profileModal').style.display='none';

// DM
function openDM(uid,name){
 document.getElementById('dmHeader').textContent='–õ–∏—Å—Ç—É–≤–∞–Ω–Ω—è –∑ '+name;
 const tId=[my.uid,uid].sort().join('_');
 const feed=document.getElementById('dmThread');feed.innerHTML='';
 db.ref('privateMessages/'+tId).limitToLast(100).on('child_added',snap=>{
  const v=snap.val();const m=document.createElement('div');m.className='msg';
  m.innerHTML=`<img class="ava" src="${v.ava||''}"><div><div class="meta">${v.nick}</div>${v.txt||''}${v.img?'<img src="'+v.img+'" style="max-width:150px;border-radius:6px">':''}</div>`;
  feed.appendChild(m);feed.scrollTop=feed.scrollHeight;
 });
 document.getElementById('dmModal').style.display='flex';
 document.getElementById('dmModalSend').onclick=async()=>{
  const txt=document.getElementById('dmModalInput').value.trim();const file=document.getElementById('dmModalPhoto').files[0];if(!txt&&!file)return;
  let img=null;if(file){const id='dm_'+Date.now();await st.ref('dm/'+my.uid+'/'+id).put(file);img=await st.ref('dm/'+my.uid+'/'+id).getDownloadURL();}
  await db.ref('privateMessages/'+tId).push({uid:my.uid,nick:my.nick,ava:my.ava,txt,img,ts:Date.now()});
  document.getElementById('dmModalInput').value='';document.getElementById('dmModalPhoto').value='';
 };
}
document.getElementById('dmClose').onclick=()=>document.getElementById('dmModal').style.display='none';

// admin wallpaper
function applyWall(url){document.getElementById('walls').style.backgroundImage=`url('${url}')`;localStorage.setItem('wall',url);}
db.ref('settings/theme/wallUrl').on('value',s=>{const u=s.val();if(u)applyWall(u);else{const c=localStorage.getItem('wall');if(c)applyWall(c);}});
document.getElementById('wallSave').onclick=async()=>{const u=document.getElementById('wallUrlInput').value.trim();if(u)await db.ref('settings/theme').set({wallUrl:u});};
document.getElementById('wallLocal').onclick=()=>{const u=document.getElementById('wallUrlInput').value.trim();if(u)applyWall(u);};

// admin bot panel (basic)
const botsRef=db.ref('settings/bots');
botsRef.on('value',s=>{
 const data=s.val()||{};const list=document.getElementById('botList');list.innerHTML='';
 Object.keys(data).forEach(id=>{
  const b=data[id];
  const div=document.createElement('div');div.innerHTML=`<textarea data-id="${id}">${b.text||''}</textarea>`;
  list.appendChild(div);
 });
});
document.getElementById('botAdd').onclick=()=>{const id=Date.now();botsRef.child(id).set({text:'–ù–æ–≤–∏–π –±–æ—Ç',interval:30});};

// limits & payment
let txtCount=0, imgCount=0;
async function checkLimit(){if(txtCount>=200||imgCount>=100){document.getElementById('payModal').style.display='flex';notify('–õ—ñ–º—ñ—Ç –≤–∏—á–µ—Ä–ø–∞–Ω–æ. –û–ø–ª–∞—Ç—ñ—Ç—å.');return true;}return false;}
document.getElementById('chatSend').addEventListener('click',()=>{txtCount++;checkLimit();});
document.getElementById('chatPhoto').addEventListener('change',()=>{imgCount++;checkLimit();});
document.getElementById('paySend').onclick=async()=>{
 const f=document.getElementById('payFile').files[0];if(!f)return;
 const id='pay_'+Date.now();await st.ref('payments/'+my.uid+'/'+id).put(f);
 await db.ref('payments/inbox/'+my.uid+'/'+id).set({uid:my.uid,ts:Date.now()});
 txtCount=0;imgCount=0;document.getElementById('payModal').style.display='none';notify('–ß–µ–∫ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ. –û—á—ñ–∫—É–π—Ç–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è.');
};
document.getElementById('payClose').onclick=()=>document.getElementById('payModal').style.display='none';

</script>
</body>
</html>
