<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ü—Ä–∞–≥–∞ –§—É—à–∫–∏ - —á–∞—Ç —Ç–∞ –∫–∞—Ä—Ç–∞</title>
  <style>
    :root {
      --accent: #4d96ff;
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: url("https://i.ibb.co/27hgtZfY/Prague.jpg") center/cover no-repeat fixed;
      color: white;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    nav.tabs {
      display: flex;
      gap: 10px;
      justify-content: center;
      padding: 10px 12px;
      position: sticky;
      top: 86px;
      z-index: 58;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 12px;
      user-select: none;
    }
    .tab-button {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: #fff;
      padding: 10px 20px;
      font-weight: 800;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .tab-button:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    .tab-button.active {
      box-shadow: inset 0 -4px 0 var(--accent);
      background: var(--accent);
      color: #071126;
    }
    main {
      max-width: 1024px;
      margin: 0 auto;
      padding: 12px 10px 80px;
    }
    .tab-content {
      display: none;
    }
    #chatTab, #helpTab {
      background: rgba(0,0,0,0.6);
      border-radius: 12px;
      padding: 10px;
    }
    #chatTab {
      display: block; /* –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
    }
    .chat-area {
      height: calc(100vh - 280px);
      overflow-y: auto;
      padding: 14px 8px;
      background: transparent;
      border-radius: 8px;
      margin-bottom: 10px;
      box-sizing: border-box;
      scrollbar-width: thin;
      scrollbar-color: var(--accent) transparent;
    }
    .chat-area::-webkit-scrollbar {
      width: 8px;
    }
    .chat-area::-webkit-scrollbar-thumb {
      background-color: var(--accent);
      border-radius: 4px;
    }
    .message-wrap {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      align-items: flex-start;
    }
    .message-wrap.self {
      flex-direction: row-reverse;
    }
    .avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      cursor: pointer;
      flex-shrink: 0;
      background-color: #333;
      background-size: cover;
      background-position: center;
      border: 2px solid var(--accent);
    }
    .message-content {
      max-width: 75%;
      background: rgba(0,0,0,0.3);
      padding: 8px 12px;
      border-radius: 12px;
      word-break: break-word;
    }
    .message-meta {
      font-size: 0.75rem;
      font-weight: 700;
      margin-bottom: 4px;
      color: var(--accent);
    }
    .text {
      white-space: pre-wrap;
    }
    .chat-image {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 6px;
      cursor: pointer;
      user-select: none;
    }
    #messageInput {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      border-radius: 20px;
      border: none;
      box-sizing: border-box;
      outline: none;
      resize: none;
    }
    .input-area {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }
    .camera-btn {
      width: 40px;
      height: 40px;
      background: var(--accent);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      color: white;
      font-weight: 900;
      font-size: 1.3rem;
      user-select: none;
      border: none;
    }
    #sendButton {
      background: var(--accent);
      border: none;
      color: #071126;
      font-weight: 700;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      transition: background 0.3s;
    }
    #sendButton:hover:not(:disabled) {
      background: #336fcc;
    }
    #sendButton:disabled {
      background: rgba(77, 150, 255, 0.5);
      cursor: not-allowed;
    }
    #fileInput {
      display: none;
    }
    #profileBtn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: url("https://i.ibb.co/27hgtZfY/Prague.jpg") center/cover no-repeat;
      border: 2px solid var(--accent);
      cursor: pointer;
      position: fixed;
      top: 12px;
      right: 12px;
      z-index: 100;
    }
    /* –ö–∞—Ä—Ç–∞ */
    #mapTab {
      height: calc(100vh - 190px);
      border-radius: 12px;
      overflow: hidden;
    }
    #map {
      width: 100%;
      height: 100%;
    }
    /* –ü–æ–º–æ—â—å */
    #helpTab {
      color: white;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <button id="profileBtn" title="–ü—Ä–æ—Ñ—ñ–ª—å"></button>

  <nav class="tabs">
    <button class="tab-button active" data-target="chatTab" aria-selected="true" role="tab">–ß–∞—Ç</button>
    <button class="tab-button" data-target="mapTab" role="tab">–ö–∞—Ä—Ç–∞</button>
    <button class="tab-button" data-target="helpTab" role="tab">–î–æ–ø–æ–º–æ–≥–∞</button>
  </nav>

  <main>
    <section id="chatTab" class="tab-content" role="tabpanel" aria-hidden="false">
      <div class="chat-area" aria-live="polite" aria-relevant="additions"></div>
      <div class="input-area">
        <label for="fileInput" class="camera-btn" title="–î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ" aria-label="–î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ">üì∑</label>
        <input type="file" accept="image/*" id="fileInput" />
        <textarea id="messageInput" rows="2" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..."></textarea>
        <button id="sendButton" disabled>–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
      </div>
    </section>

    <section id="mapTab" class="tab-content" role="tabpanel" aria-hidden="true">
      <div id="map" aria-label="–ö–∞—Ä—Ç–∞ –ü—Ä–∞–≥–∏"></div>
    </section>

    <section id="helpTab" class="tab-content" role="tabpanel" aria-hidden="true">
      <h2>–î–æ–ø–æ–º–æ–≥–∞ –≤ –ü—Ä–∞–∑—ñ</h2>
      <p>–¢—É—Ç –º–æ–∂–Ω–∞ —Ä–æ–∑–º—ñ—Å—Ç–∏—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –¥–æ–ø–æ–º–æ–≥—É, –∫–æ–Ω—Ç–∞–∫—Ç–∏ —Ç–∞ –∫–æ—Ä–∏—Å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è.</p>
    </section>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref as dbRef, query, orderByChild, limitToLast, onChildAdded, push as dbPush } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";
    import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

    const firebaseConfig = {
      // –í—Å—Ç–∞–≤—å —Å—é–¥–∞ —Å–≤–æ–π firebase config
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    const DEFAULT_AVATAR = "https://i.ibb.co/27hgtZfY/Prague.jpg"; // –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –∞–≤–∞—Ç–∞—Ä

    const messagesEl = document.querySelector(".chat-area");
    const messageInput = document.getElementById("messageInput");
    const sendButton = document.getElementById("sendButton");
    const fileInput = document.getElementById("fileInput");
    const profileBtn = document.getElementById("profileBtn");

    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ —Ç–µ–∫—Å—Ç–∞
    messageInput.addEventListener("input", () => {
      sendButton.disabled = !messageInput.value.trim() && !fileInput.files.length;
    });
    fileInput.addEventListener("change", () => {
      sendButton.disabled = !messageInput.value.trim() && !fileInput.files.length;
    });

    // –†–µ–Ω–¥–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è (—Ç–≤–æ–π –∫–æ–¥ renderMessage —Ç—É—Ç)
    function timeStr(ts) {
      const d = new Date(ts);
      return d.toLocaleTimeString("uk-UA", { hour: "2-digit", minute: "2-digit" });
    }

    function renderMessage(m) {
      const wrap = document.createElement("div");
      wrap.className = "message-wrap";
      if (auth.currentUser && m.uid === auth.currentUser.uid) wrap.classList.add("self");

      const avatar = document.createElement("div");
      avatar.className = "avatar";
      avatar.style.backgroundImage = `url(${m.avatar || DEFAULT_AVATAR})`;
      avatar.title = m.nick || "–û—Å–æ–±–∏—Å—Ç—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è";
      avatar.alt = m.nick || "avatar";
      avatar.addEventListener("click", () => {
        if (!auth.currentUser) { alert("–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å —É —Å–∏—Å—Ç–µ–º—É."); return; }
        if (m.uid === auth.currentUser.uid) alert("–¶–µ –≤–∏"); else alert("–û—Å–æ–±–∏—Å—Ç—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–ø–æ–∫–∏ —â–æ –ø—Ä–æ—Å—Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—è).");
      });

      const txt = document.createElement("div");
      txt.className = "message-content";

      const meta = document.createElement("div");
      meta.className = "message-meta";
      meta.textContent = `${m.nick || "–ê–Ω–æ–Ω—ñ–º"} ¬∑ ${timeStr(m.ts)}` + (m.recipientUid ? " ¬∑ –æ—Å–æ–±–∏—Å—Ç–µ" : "");
      txt.appendChild(meta);

      if (m.text) {
        const p = document.createElement("div");
        p.className = "text";
        p.innerText = m.text;
        txt.appendChild(p);
      }
      if (m.image) {
        const im = document.createElement("img");
        im.src = m.image;
        im.alt = "–§–æ—Ç–æ";
        im.className = "chat-image";
        txt.appendChild(im);
      }

      wrap.appendChild(avatar);
      wrap.appendChild(txt);
      messagesEl.appendChild(wrap);

      // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –µ—Å–ª–∏ –±–ª–∏–∑–∫–æ –∫ –Ω–∏–∑—É
      const nearBottom = messagesEl.scrollHeight - messagesEl.scrollTop - messagesEl.clientHeight < 200;
      if (nearBottom) messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    const MSG_LIMIT = 150;
    const messagesQuery = query(dbRef(db, "messages"), orderByChild("ts"), limitToLast(MSG_LIMIT));
    onChildAdded(messagesQuery, (snap) => {
      const m = snap.val();
      renderMessage(m);
    }, (err) => {
      console.error("onChildAdded error", err);
    });

    // –§—É–Ω–∫—Ü–∏—è —Ä–µ—Å–∞–π–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ canvas
    function resizeImageFile(file, maxWidth = 900, quality = 0.8) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        const reader = new FileReader();
        reader.onload = (e) => {
          img.onload = () => {
            const scale = Math.min(1, maxWidth / img.width);
            const w = Math.round(img.width * scale);
            const h = Math.round(img.height * scale);
            const canvas = document.createElement('canvas');
            canvas.width = w;
            canvas.height = h;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, w, h);
            const dataUrl = canvas.toDataURL('image/jpeg', quality);
            resolve(dataUrl);
          };
          img.onerror = (err) => reject(err);
          img.src = e.target.result;
        };
        reader.onerror = (err) => reject(err);
        reader.readAsDataURL(file);
      });
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    sendButton.addEventListener("click", async () => {
      if (!auth.currentUser) { alert("–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å —É —Å–∏—Å—Ç–µ–º—É."); return; }

      const text = messageInput.value.trim();
      const file = fileInput.files[0];
      if (!text && !file) return;

      let imageData = null;
      if (file) {
        try {
          imageData = await resizeImageFile(file, 900, 0.8);
        } catch (e) {
          console.error("resize error", e);
          alert("–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ —Ñ–æ—Ç–æ");
          return;
        }
      }

      const msg = {
        uid: auth.currentUser.uid,
        nick: auth.currentUser.displayName || auth.currentUser.email || "–ê–Ω–æ–Ω—ñ–º",
        avatar: auth.currentUser.photoURL || DEFAULT_AVATAR,
        text: text || null,
        image: imageData || null,
        ts: Date.now(),
        recipientUid: null
      };

      try {
        await dbPush(dbRef(db, "messages"), msg);
        messageInput.value = "";
        fileInput.value = "";
        sendButton.disabled = true;
      } catch (err) {
        console.error("dbPush error", err);
        alert("–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è");
      }
    });

    // Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
    messageInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        if (!sendButton.disabled) sendButton.click();
      }
    });

    // –ö–Ω–æ–ø–∫–∞ –∫–∞–º–µ—Ä—ã (–µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)
    document.querySelector('.camera-btn')?.addEventListener("click", (e) => {
      if (!auth.currentUser) {
        e.preventDefault();
        alert("–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å —É —Å–∏—Å—Ç–µ–º—É.");
      }
    });

    // –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è: –≤—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
    profileBtn.style.background = `url(${DEFAULT_AVATAR}) center/cover`;
    profileBtn.addEventListener("click", () => {
      if (!auth.currentUser) { alert("–í–∏ –Ω–µ —É–≤—ñ–π—à–ª–∏."); return; }
      if (confirm("–í–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–π—Ç–∏? OK ‚Äî –≤–∏–π—Ç–∏; Cancel ‚Äî –∑–∞–ª–∏—à–∏—Ç–∏—Å—è.")) {
        signOut(auth).then(() => {
          profileBtn.style.background = `url(${DEFAULT_AVATAR}) center/cover`;
          alert("–í–∏ –≤–∏–π—à–ª–∏");
        });
      }
    });

    // –í–∫–ª–∞–¥–∫–∏
    const tabButtons = document.querySelectorAll(".tab-button");
    const tabContents = document.querySelectorAll(".tab-content");

    function setActiveTab(id) {
      tabButtons.forEach(b => {
        const active = b.dataset.target === id;
        b.classList.toggle("active", active);
        b.setAttribute("aria-selected", active ? "true" : "false");
      });
      tabContents.forEach(c => {
        const active = c.id === id;
        c.style.display = active ? "block" : "none";
        c.setAttribute("aria-hidden", active ? "false" : "true");
      });
      if (id === "mapTab" && typeof google !== "undefined" && window.map) {
        setTimeout(() => {
          google.maps.event.trigger(window.map, "resize");
          window.map.setCenter({ lat: 50.0755, lng: 14.4378 });
        }, 200);
      }
      if (id === "chatTab") messageInput.focus();
    }

    tabButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        setActiveTab(btn.dataset.target);
      });
    });

    // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ–Ω–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –±–µ–ª–æ–≥–æ –º–∏–≥–∞–Ω–∏—è)
    (function preloadBg() {
      const img = new Image();
      img.src = "https://i.ibb.co/27hgtZfY/Prague.jpg";
      img.onload = () => console.log("Background loaded");
      img.onerror = () => console.warn("Background failed to load");
    })();

    /***************
     * Google Maps *
     ***************/
    const POINTS = [
      { title: "Nemocnice Motol", pos: {lat:50.058, lng:14.360}, cat:"hospital" },
      { title: "Nemocnice Na Frantisku", pos: {lat:50.086, lng:14.418}, cat:"hospital" },
      { title: "Klinika Praha", pos: {lat:50.078, lng:14.422}, cat:"hospital" },
      { title: "Pravni pomoc —Ü–µ–Ω—Ç—Ä A", pos: {lat:50.083, lng:14.412}, cat:"lawyer" },
      { title: "Pravni pomoc —Ü–µ–Ω—Ç—Ä B", pos: {lat:50.089, lng:14.430}, cat:"lawyer" },
      { title: "Advokatni kancelar C", pos: {lat:50.071, lng:14.425}, cat:"lawyer" },
      { title: "Albert Supermarket", pos: {lat:50.084, lng:14.417}, cat:"shop" },
      { title: "Billa City", pos: {lat:50.076, lng:14.437}, cat:"shop" },
      { title: "Kaufland Praha", pos: {lat:50.085, lng:14.414}, cat:"shop" },
      { title: "Pomoc Centrum 1", pos: {lat:50.082, lng:14.419}, cat:"help" },
      { title: "Pomoc Centrum 2", pos: {lat:50.088, lng:14.427}, cat:"help" },
      { title: "Shelter Point", pos: {lat:50.074, lng:14.432}, cat:"help" },
      { title: "Clinic D", pos: {lat:50.090, lng:14.418}, cat:"hospital" },
      { title: "Clinic E", pos: {lat:50.079, lng:14.404}, cat:"hospital" },
      { title: "Law Office D", pos: {lat:50.081, lng:14.440}, cat:"lawyer" },
      { title: "Shop D", pos: {lat:50.083, lng:14.445}, cat:"shop" },
      { title: "Shop E", pos: {lat:50.0715, lng:14.421}, cat:"shop" },
      { title: "Help Center 3", pos: {lat:50.086, lng:14.431}, cat:"help" },
      { title: "Help Center 4", pos: {lat:50.072, lng:14.439}, cat:"help" },
      { title: "Medical Aid 8", pos: {lat:50.0875, lng:14.435}, cat:"hospital" },
      { title: "Legal Aid 9", pos: {lat:50.0785, lng:14.410}, cat:"lawyer" },
      { title: "Shop F", pos: {lat:50.080, lng:14.408}, cat:"shop" },
      { title: "Community Aid", pos: {lat:50.0835, lng:14.425}, cat:"help" },
      { title: "Charity Hub", pos: {lat:50.079, lng:14.430}, cat:"help" }
    ];

    let map;
    let markers = [];

    window.initMap = function() {
      const center = { lat: 50.0755, lng: 14.4378 };
      map = new google.maps.Map(document.getElementById("map"), {
        center,
        zoom: 13,
        gestureHandling: "greedy"
      });

      renderMarkers("all");

      // –ö–Ω–æ–ø–∫–∞ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç—ã
      // –ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä —Å id="centerBtn", –ø–æ–¥–∫–ª—é—á–∏ —Å—é–¥–∞:
      // document.getElementById("centerBtn")?.addEventListener("click", () => map.panTo(center));

      // –ü–æ–∏—Å–∫ –Ω–∞ –∫–∞—Ä—Ç–µ (–µ—Å–ª–∏ –±—É–¥–µ—Ç –ø–æ–ª–µ input —Å id="mapSearch")
      // const mapSearch = document.getElementById("mapSearch");
      // mapSearch?.addEventListener("input", (e) => {
      //   const q = e.target.value.trim().toLowerCase();
      //   markers.forEach(mk => {
      //     const show = !q || (mk.title && mk.title.toLowerCase().includes(q));
      //     mk.setVisible(show);
      //   });
      // });
    };

    function createIconFor(cat) {
      const color = (cat === "hospital") ? "#FF6B6B" :
                    (cat === "lawyer") ? "#4D96FF" :
                    (cat === "shop") ? "#FFD166" : "#8AF598";
      const svg = encodeURIComponent(`
        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40">
          <circle cx="20" cy="20" r="14" fill="${color}" stroke="#fff" stroke-width="3"/>
        </svg>`);
      return {
        url: `data:image/svg+xml;utf8,${svg}`,
        scaledSize: new google.maps.Size(40, 40)
      };
    }

    function renderMarkers(filterCat = "all") {
      markers.forEach(m => m.setMap(null));
      markers = [];
      POINTS.forEach(p => {
        if (filterCat === "all" || p.cat === filterCat) {
          const mk = new google.maps.Marker({
            position: p.pos,
            map,
            title: p.title,
            icon: createIconFor(p.cat)
          });
          const inf = new google.maps.InfoWindow({
            content: `<strong>${p.title}</strong><div style="margin-top:6px">${p.cat}</div>`
          });
          mk.addListener("click", () => inf.open(map, mk));
          mk.title = p.title;
          markers.push(mk);
        }
      });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–º–µ–Ω—ã –≤–∫–ª–∞–¥–æ–∫ —Å –≤—ã–∑–æ–≤–æ–º resize –∫–∞—Ä—Ç—ã, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ –≤–∫–ª–∞–¥–∫–∞ –∫–∞—Ä—Ç—ã
    document.querySelectorAll(".tab-button").forEach(btn => {
      btn.addEventListener("click", () => {
        if (btn.dataset.target === "mapTab" && typeof google !== "undefined" && map) {
          google.maps.event.trigger(map, "resize");
          map.setCenter({ lat: 50.0755, lng: 14.4378 });
        }
      });
    });
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFrxVhpb6nHJ6rhiLl5Ho8t0jOb1iEQNc&callback=initMap"></script>
</body>
</html>
