<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MAK√ÅME CZ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css"/>
  <link rel="preload" as="image" href="./img/bg.jpg">
  <script>
    // Apply last wallpaper ASAP (no flicker)
    (function(){
      try{
        var city = localStorage.getItem('city') || 'praha';
        var w = localStorage.getItem('wall_'+city) || localStorage.getItem('wall') || '';
        if(!w) return;
        var st=document.createElement('style');
        st.textContent=":root{--wall:url('"+String(w).replace(/'/g,"%27")+"')}";
        document.head.appendChild(st);
      }catch(e){}
    })();
  </script>


  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>

<div id="preloader">
  <div class="pre-bg"></div>
  <div class="box">
    <img class="logo-img" src="./img/logo.svg" alt="MAK√ÅME CZ"/>
    <div class="title">V√≠tejte v <b>MAK√ÅME CZ</b><br><span class="slogan">Spojujeme pracuj√≠c√≠ a zamƒõstnavatele v srdci ƒåeska</span></div>
    <div class="subtitle" id="preloaderStatus">Naƒç√≠t√°me aplikaci‚Ä¶</div>
    <div class="row">
      <div class="spin"></div>
      <div class="timer" id="preloaderTimer">P≈ôejdeme automaticky za 10 s</div>
    </div>
    <button class="btn primary" id="goSiteBtn" type="button">P≈ôej√≠t na web</button>
  </div>
</div>

<script>
/* Preloader failsafe (works even if app.js crashes) */
(function(){
  var p=document.getElementById('preloader');
  var btn=document.getElementById('goSiteBtn');
  var tEl=document.getElementById('preloaderTimer');
  var sEl=document.getElementById('preloaderStatus');
  var sec=10;
  var steps=[
    'Hled√°me pro v√°s nab√≠dky pr√°ce‚Ä¶',
    'Kontrolujeme chat a nov√© zpr√°vy‚Ä¶',
    'Hled√°me aktivn√≠ zamƒõstnavatele‚Ä¶',
    'Naƒç√≠t√°me profily a p≈ô√°tele‚Ä¶'
  ];
  var i=0;
  function hide(){ if(!p) return; p.classList.add('hidden'); }
  if(btn) btn.addEventListener('click', hide);
  setInterval(function(){
    sec=Math.max(0,sec-1);
    if(tEl) tEl.textContent='P≈ôejdeme automaticky za '+sec+' s';
    if(sec<=0) hide();
    if(sEl){ sEl.textContent=steps[i%steps.length]; i++; }
  }, 1000);
  setTimeout(hide, 11500);
})();
</script>
<div class="topbar">
  <button id="btnDrawer" class="icon-btn icon-hamburger" title="Menu" aria-label="Menu">‚ò∞</button>

  <div class="brand"><img src="./img/logo.svg" class="brand-logo" alt="MAK√ÅME CZ"></div>
  <div class="row" style="margin:0">
    <div class="citysel">
      <select id="citySelect">
        <option value="praha">Praha</option>
        <option value="brno">Brno</option>
        <option value="olomouc">Olomouc</option>
        <option value="ostrava">Ostrava</option>
      </select>
    </div>

    <label class="filebtn admin-only" id="wallCamWrap" title="Zmƒõnit pozad√≠">
      üì∑
      <input id="wallCamera" type="file" accept="image/*">
    </label>

    <button id="btnBell" class="icon-btn" title="Ozn√°men√≠" aria-label="Ozn√°men√≠">
      üîî<span id="bellBadge" class="badge" hidden>0</span>
    </button>
    <button id="btnTopDm" class="icon-btn" title="Osobn√≠ (DM)" aria-label="DM">‚úâÔ∏è</button>
    <button id="btnTopFriends" class="icon-btn" title="P≈ô√°tel√©" aria-label="P≈ô√°tel√©">üë•</button>
    <button id="btnMe" class="icon-btn" title="M≈Øj profil" aria-label="M≈Øj profil">
      <img id="meAvatar" class="avatar" src="./img/default-avatar.svg" alt="me">
    </button>

    <button class="ghost" id="toggleTabs" type="button">Menu</button>
    <button class="ghost" id="btnLogin" type="button" onclick="try{document.getElementById('preloader')?.classList.add('hidden');document.getElementById('modalAuth').hidden=false;}catch(e){}">P≈ôihl√°≈°en√≠</button>
    <button class="ghost" id="btnSignout" type="button">Odhl√°sit</button>
  </div>
</div>

<!-- Mobile drawer -->
<div id="drawerOverlay" class="drawer-overlay" hidden></div>
<aside id="drawer" class="drawer" hidden>
  <div class="drawer-head">
    <div class="drawer-brand">
      <img src="./img/logo.svg" alt="MAK√ÅME CZ"/>
      <span>Menu</span>
    </div>
    <button id="btnDrawerClose" class="icon-btn" aria-label="Zav≈ô√≠t">‚úï</button>
  </div>
  <nav class="drawer-nav">
    <button class="drawer-item" data-go="chat">Chat</button>
    <button class="drawer-item" data-go="dm">Osobn√≠ (DM)</button>
    <button class="drawer-item" data-go="friends">P≈ô√°tel√©</button>
    <button class="drawer-item" data-go="rent">Pron√°jem</button>
    <button class="drawer-item" data-go="map">Mapa</button>
    <button class="drawer-item" data-go="profile">Profil</button>
    <button class="drawer-link adm-only" style="display:none" data-view="view-admin">Admin</button>
  </nav>
</aside>

<div class="tabs" id="tabs">
  <a class="tab active" href="#" data-view="view-chat">Chat</a>
  <a class="tab" href="#" data-view="view-dm">Osobn√≠ (DM)</a>
  <a class="tab" href="#" data-view="view-friends">P≈ô√°tel√© <span id="friendsBadge"></span></a>
  <a class="tab" href="#" data-view="view-rent">Pron√°jem</a>
  <a class="tab" href="#" data-view="view-map">Mapa</a>
  <a class="tab" href="#" data-view="view-profile">Profil</a>
  <a class="tab adm-only" style="display:none" href="#" data-view="view-admin">Admin</a>
</div>

<div id="views">
  <section class="view active" id="view-chat">
    <div class="feed" id="chatFeed"></div>
    <div class="composer sticky">
      <input id="msgText" placeholder="Napi≈°te zpr√°vu‚Ä¶">
      <label class="filebtn" title="Foto">
        üìé<input id="msgPhoto" type="file" accept="image/*">
      </label>
      <button id="sendBtn" type="button">Odeslat</button>
    </div>
  </section>

  <section class="view" id="view-dm">
  <div class="dm">
    <div class="card" style="padding:10px">
      <header>
        <b>Konverzace</b>
        <button class="ghost" id="dmNewBtn" type="button">+ Nov√°</button>
      </header>
      <div id="dmThreads" style="display:flex;flex-direction:column;gap:8px;max-height:60vh;overflow:auto"></div>
      <div class="muted">Tip: kliknƒõte na konverzaci pro otev≈ôen√≠ historie.</div>
    </div>

    <div class="card" style="padding:10px">
      <header style="display:flex;justify-content:space-between;align-items:center">
        <div><b id="dmWithName">Osobn√≠ zpr√°vy</b> <span class="muted" id="dmWithStatus"></span></div>
        <button class="ghost" id="dmClearBtn" type="button">Vyƒçistit</button>
      </header>
      <div class="feed" id="dmFeed" style="min-height:45vh"></div>
      <div id="botPremiumPanel" style="display:none;margin-top:10px">
        <div class="row" style="justify-content:space-between;align-items:center">
          <b>N√°kup privilegia (bot)</b>
          <span class="muted" id="botPremiumStep"></span>
        </div>
        <div id="botPremiumActions" class="row"></div>
        <div class="muted" id="botPremiumHint"></div>
      </div>

      <div class="composer sticky">
        <input id="dmText" placeholder="Zpr√°va‚Ä¶">
        <label class="filebtn" title="Foto">
          üìé<input id="dmPhoto" type="file" accept="image/*">
        </label>
        <button id="dmSend" type="button">Odeslat</button>
      </div>
    </div>
  </div>
</section>

  <section class="view" id="view-friends">
  <div class="row" style="justify-content:space-between;align-items:center">
    <div><b>P≈ô√°tel√©</b> <span class="muted" id="friendsSummary"></span></div>
    <button class="ghost" id="friendAddOpen" type="button">+ P≈ôidat p≈ô√≠tele</button>
  </div>
  <div class="row"><b>≈Ω√°dosti</b> <span id="friendsBadgeInline"></span></div>
  <div class="feed" id="friendsRequests"></div>
  <div class="row"><b>Seznam p≈ô√°tel</b></div>
  <div class="feed" id="friendsList"></div>
</section>

  <section class="view" id="view-rent">
    <div class="row">
      <input id="rentTitle" placeholder="N√°zev" style="flex:2;min-width:220px">
      <input id="rentPrice" placeholder="Cena Kƒç" type="number" style="width:140px">
      <select id="rentTTL">
        <option value="0">Bez expirace</option>
        <option value="7">7 dn≈Ø</option>
        <option value="14">14 dn≈Ø</option>
        <option value="30">30 dn≈Ø</option>
      </select>
      <label class="filebtn">üìé<input id="rentPhoto" type="file" accept="image/*"></label>
      <button id="rentAdd" type="button">P≈ôidat</button>
    </div>
    <div class="row">
      <select id="rentStatus">
        <option value="">V≈°e</option>
        <option value="active">Aktivn√≠</option>
        <option value="closed">Uzav≈ôen√©</option>
      </select>
      <select id="rentSort">
        <option value="new">Nejnovƒõj≈°√≠</option>
        <option value="price">Cena</option>
      </select>
      <button id="rentApply" type="button">Pou≈æ√≠t</button>
    </div>
    <div class="feed" id="rentFeed"></div>
  </section>

  <section class="view" id="view-map">
    <div class="map" id="map"></div>
    <div class="muted" style="margin-top:8px">Tip: mod/admin m≈Ø≈æe p≈ôid√°vat body a upravovat je podle pravidel.</div>
  </section>

  <section class="view" id="view-profile">
  <div class="row">
    <img id="myAvatar" class="ava-lg" src="./img/default-avatar.svg" alt="avatar">
    <div>
      <div><b id="myName">U≈æivatel</b> <span id="myPlan" class="badge premium" style="display:none">PREMIUM</span></div>
      <div class="muted" id="profileEmail">E-mail: ‚Äî</div>
      <div class="muted" id="profileRoleLine">Role: ‚Äî</div>
    </div>
  </div>

  <div class="card" style="margin-top:10px">
    <header><b>Profil</b></header>
    <div class="row">
      <input id="setNick" placeholder="Nick" style="flex:1;min-width:200px">
      <button class="ghost" id="reqNickChange" type="button">Po≈æ√°dat o zmƒõnu nicku</button>
    </div>
    <div class="row">
      <select id="setRole">
        <option value="seeker">Hled√°m pr√°ci</option>
        <option value="employer">Zamƒõstnavatel</option>
      </select>
      <button class="ghost" id="reqRoleChange" type="button">Po≈æ√°dat o zmƒõnu role</button>
    </div>
    <div class="row">
      <input id="setAvatarUrl" placeholder="URL avatara (nebo pou≈æij üì∑)" style="flex:2;min-width:260px">
      <label class="filebtn" title="Avatar z telefonu">üì∑<input id="avatarFile" type="file" accept="image/*"></label>
      <button id="saveProfile" type="button">Ulo≈æit</button>
    </div>
    <div class="row">
      <textarea id="setAbout" placeholder="O mnƒõ (kr√°tce)" style="flex:1;min-height:80px"></textarea>
    </div>
    <div class="row">
      <button class="ghost" id="reqPremium" type="button">Koupit privilegium</button>
      <button id="resetPassTop" type="button">Zapomenut√© heslo</button>
    </div>
    <div class="muted">Nick a role lze nastavit pouze jednou. Dal≈°√≠ zmƒõny jdou p≈ôes ≈æ√°dost adminovi.</div>
  </div>
</section>

  <section class="view" id="view-admin">
  <div class="row"><b>Admin panel</b> <span class="muted">Pouze zakladatel / admin</span></div>

  <div class="adm-only">
    <div class="row">
      <input id="roleUid" placeholder="UID" style="min-width:260px">
      <input id="banReason" placeholder="D≈Øvod" style="flex:1;min-width:240px">
      <button id="makeMod" type="button">+ MOD</button>
      <button id="removeMod" type="button">- MOD</button>
      <button id="ban30" type="button">Ban 30 min</button>
      <button id="unban" type="button">Unban</button>
    </div>
    <div class="row">
      <button id="clearChat" type="button">Vyƒçistit chat (mƒõsto)</button>
    </div>
  </div>

  <div class="cards">
    <div class="card">
      <header><b>≈Ω√°dosti o zmƒõnu profilu</b></header>
      <div class="muted">Schvalov√°n√≠ zmƒõny nicku a role.</div>
      <div class="feed" id="adminProfileRequests" style="min-height:120px"></div>
    </div>
    <div class="card">
      <header><b>Premium ≈æ√°dosti</b></header>
      <div class="muted">Zat√≠m pouze ≈æ√°dosti (platby dopln√≠≈° pozdƒõji).</div>
      <div class="feed" id="adminPremiumRequests" style="min-height:120px"></div>
    </div>
    <div class="card">
      <header><b>Boti</b></header>
      <div class="row">
        <button class="ghost" id="botAdd" type="button">+ P≈ôidat bot</button>
        <button class="ghost" id="botRun" type="button">Spustit</button>
        <button class="ghost" id="botStop" type="button">Zastavit</button>
      </div>
      <div class="feed" id="botList" style="min-height:140px"></div>
      <div class="muted">Pozn.: Boti publikuj√≠, kdy≈æ je otev≈ôen web zakladatele (MVP bez serveru).</div>
    </div>
  </div>
</section>
</div>

<div id="cookieBanner" class="toast" style="position:fixed;left:50%;transform:translateX(-50%);bottom:20px;display:none">
  Pou≈æ√≠v√°me cookies pro lep≈°√≠ funkce webu.
  <button class="ghost" id="cookieAccept" type="button">Souhlas√≠m</button>
</div>

<div id="greetOverlay" class="modal" hidden>
  <div class="card">
    <header>
      <b>Vzkaz</b>
      <button class="ghost" id="greetClose" type="button">√ó</button>
    </header>
    <img class="rose" src="./img/rose.svg" alt="Rose">
    <h2 style="margin:10px 0 6px">Jsi ta nejkr√°snƒõj≈°√≠ d√≠vka</h2>
    <div class="muted">Toto je od zakladatele. (Zav≈ôe se za <span id="greetSec">10</span> s)</div>
    <div class="row" style="justify-content:center;margin-top:10px">
      <button class="ghost" id="greetDm" type="button">Napsat zakladateli</button>
      <button class="ghost" id="greetAddFriend" type="button">P≈ôidat do p≈ô√°tel</button>
    </div>
  </div>
</div>

<div id="globalToast" class="toast" style="display:none"></div>
<!-- Auth Modal -->
<div id="modalAuth" class="modal" hidden>
  <div class="modal-card auth-card">
    <div class="auth-left" aria-hidden="true"></div>
    <div class="auth-right">
      <button class="x" id="authClose" type="button" onclick="try{closeModalAuth();}catch(e){try{document.getElementById('modalAuth').hidden=true;}catch(_){}}">‚úï</button>
      <div class="auth-brand">
        <img src="img/logo.svg" alt="MAK√ÅME CZ">
        <div class="name">MAK√ÅME CZ</div>
        <div class="tag">Spojujeme pracuj√≠c√≠ a zamƒõstnavatele v&nbsp;srdci ƒåeska</div>
      </div>
      <h2 id="authTitle" style="text-align:center">P≈ôihl√°≈°en√≠</h2>
      <div class="auth-form">
        <label class="inp">
          <span>E-mail</span>
          <input id="authEmail" type="email" autocomplete="email" placeholder="nap≈ô. jmeno@email.cz">
        </label>
        <label class="inp">
          <span>Heslo</span>
          <input id="authPass" type="password" autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </label>

        <div id="authNickRow" style="display:none">
          <label class="inp">
            <span>Nick</span>
            <input id="authNick" type="text" maxlength="24" placeholder="Nap≈ô. Nikolay">
          </label>
        </div>

        <div id="authRoleRow" style="display:none">
          <label class="inp">
            <span>Role</span>
            <select id="authRole">
              <option value="">Vyberte‚Ä¶</option>
              <option value="job">Hled√°m pr√°ci</option>
              <option value="employer">Zamƒõstnavatel</option>
            </select>
          </label>
        </div>

        <div class="auth-row">
          <label class="chk"><input id="authRemember" type="checkbox"> <span>Zapamatovat si mƒõ</span></label>
          <button class="link" id="authResendVerify" type="button">Znovu poslat ovƒõ≈ôen√≠</button>
          <div class="hint" style="margin-top:6px;opacity:.9">Pozn√°mka: ovƒõ≈ôovac√≠ e-mail ƒçasto skonƒç√≠ ve slo≈æce <b>Spam</b> nebo <b>Hromadn√©</b>.</div>
        </div>

        <button class="btn primary" id="authLoginBtn" type="button">P≈òIHL√ÅSIT SE</button>
        <button class="btn primary" id="authRegisterBtn" type="button" style="display:none">REGISTROVAT SE</button>

        <div class="sep"><span>Nebo p≈ôihl√°≈°en√≠ p≈ôes</span></div>
        <div class="auth-social">
          <button class="btn ghost" id="authGoogleBtn" type="button">Google</button>
        </div>

        <div class="auth-switch">
          <button class="link" id="authSwitchToRegister" type="button">Nem√°te √∫ƒçet? Registrace</button>
          <button class="link" id="authSwitchToLogin" type="button" style="display:none">U≈æ m√°te √∫ƒçet? P≈ôihl√°≈°en√≠</button>
        </div>

        <button class="link" id="authResetPass" type="button">Zapomnƒõli jste heslo?</button>
      </div>
    </div>
  </div>
</div>

  <!-- Firebase (Compat build so we can use firebase.* API in app.js) -->
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-storage-compat.js"></script>

  <script defer src="./app.js"></script>

  <!-- Profile modal -->
  <div id="profileModal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-backdrop" data-close="profile"></div>
    <div class="modal-card profile-card">
      <button class="icon-btn modal-close" data-close="profile" aria-label="Close">‚úï</button>
      <div class="profile-head">
        <img id="pmAvatar" class="profile-avatar" src="default-avatar.svg" alt="avatar"/>
        <div class="profile-meta">
          <div id="pmNick" class="profile-nick">User</div>
          <div id="pmCity" class="profile-city"></div>
        </div>
      </div>
      <div class="profile-actions">
        <button id="pmAddFriend" class="btn">P≈ôidat</button>
        <button id="pmMessage" class="btn btn-ghost">Napsat</button>
      </div>
      <div id="pmInfo" class="profile-info"></div>
    </div>
  </div>

</body>
</html>