<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Praha Fu≈°ky</title>
  <style>
    :root{
      --bg: #0b0d12; /* –≥–ª—É–±–æ–∫–∏–π —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π */
      --card: #11141b;
      --muted: #6c7486;
      --text: #e8edf8;
      --accent: #6aa3ff;
      --accent-2: #22c55e;
      --danger: #ef4444;
      --warning: #f59e0b;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }
    html,body{height:100%;}
    body{
      margin:0;
      font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 20% 0%, #0f1320, #06070a 70%), var(--bg);
      color: var(--text);
      display:flex;flex-direction:column;
    }
    /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
    header{
      position:sticky;top:0;z-index:20;
      backdrop-filter: blur(10px);
      background: rgba(9,12,18,.65);
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .nav{
      display:flex;align-items:center;gap:12px;
      padding:10px 14px;
      max-width:1200px;margin:0 auto;
    }
    .logo{
      font-family: "UnifrakturMaguntia", "Old English Text MT", Georgia, serif;
      font-size: 28px; letter-spacing: 1px;
      text-shadow: 2px 2px 0 #000, 0 0 18px rgba(106,163,255,.35);
      user-select:none;
    }
    .logo span{ display:inline-block; transform: translateY(1px); }
    .tabs{ margin-left:auto; display:flex; gap:8px; }
    .btn{
      border:1px solid rgba(255,255,255,.08);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      color:var(--text);
      padding:8px 12px;border-radius:12px;cursor:pointer;
      transition:.2s; font-weight:600; font-size:14px;
      box-shadow: var(--shadow);
    }
    .btn:hover{ transform:translateY(-1px); border-color: rgba(255,255,255,.16)}
    .btn.primary{ border-color: rgba(106,163,255,.45); box-shadow:0 8px 20px rgba(106,163,255,.18)}
    .btn.danger{ border-color: rgba(239,68,68,.45);}
    .btn.warning{ border-color: rgba(245,158,11,.45);}
    .btn.success{ border-color: rgba(34,197,94,.45);}

    .avatar{width:36px;height:36px;border-radius:50%;object-fit:cover;border:1px solid rgba(255,255,255,.2);cursor:pointer}
    .avatar-wrap{display:flex;align-items:center;gap:10px}

    .container{max-width:1200px;margin:12px auto;display:grid;grid-template-columns: 280px 1fr;gap:12px;flex:1;width:100%;padding:0 12px 14px}

    /* –õ–µ–≤–æ–µ –º–µ–Ω—é */
    .side{
      position:sticky;top:64px;align-self:start;
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:12px;
    }
    .side h4{margin:8px 6px 10px;color:#cdd6f4}
    .menu{display:flex;flex-direction:column;gap:8px}

    .notice{
      margin:10px 0 12px; padding:10px 12px; border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      background:linear-gradient(180deg, rgba(8,12,20,.8), rgba(8,12,20,.6));
    }

    .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.08)}

    /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å */
    .main{display:flex;flex-direction:column;gap:12px}

    .hero{
      position:relative; overflow:hidden; border-radius:var(--radius);
      border:1px solid rgba(255,255,255,.08);
      box-shadow: var(--shadow);
      padding:14px 14px 12px;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 300"><defs><linearGradient id="g" x1="0" x2="1" y1="0" y2="1"><stop offset="0%" stop-color="%230d1322"/><stop offset="100%" stop-color="%23070a12"/></linearGradient></defs><rect width="800" height="300" fill="url(%23g)"/></svg>') center/cover;
    }
    /* –ü–æ–¥–ª–æ–∂–∫–∞ –ø–æ–¥ —Ç–µ–∫—Å—Ç –¥–ª—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ */
    .hero-overlay{
      position:absolute;inset:0;background: radial-gradient(600px 200px at 10% 10%, rgba(10,14,24,.75), rgba(10,14,24,.35) 55%, rgba(10,14,24,0) 70%);
      pointer-events:none;border-radius:var(--radius);
    }
    .hero-content{position:relative; z-index:2}
    .hero h1{
      font-family: "UnifrakturMaguntia", Georgia, serif;
      margin:0 0 8px; font-size:34px; letter-spacing:.5px;
      text-shadow: 0 2px 0 #000, 0 0 22px rgba(0,0,0,.45);
    }
    .hero .sub{color:#d9e1f5; opacity:.9; max-width:900px}

    /* –í–∫–ª–∞–¥–∫–∏ —á–∞—Ç–æ–≤ */
    .tabs-line{display:flex;gap:8px;margin-top:10px}

    /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
    .card{ border:1px solid rgba(255,255,255,.06); border-radius:var(--radius); box-shadow:var(--shadow); background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); }

    /* –ß–∞—Ç */
    .chat-wrap{display:grid; grid-template-rows: minmax(300px, 65vh) auto; }
    .messages{ padding:10px; overflow:auto; scroll-behavior:smooth; }
    .msg{ display:flex; gap:10px; margin:8px 0; }
    .msg.self .bubble{ background: rgba(106,163,255,.15); border-color: rgba(106,163,255,.35); }
    .bubble{ border:1px solid rgba(255,255,255,.1); background: rgba(255,255,255,.04); padding:8px 10px; border-radius:12px; max-width: 70%;}
    .msg .meta{font-size:12px;color:#9aa3ba;margin-top:4px}
    .msg .name{font-weight:700}
    .msg img.media{max-width:240px;border-radius:10px;border:1px solid rgba(255,255,255,.1)}

    .composer{ display:flex; gap:8px; padding:12px; border-top:1px solid rgba(255,255,255,.06);}
    .composer input, .composer textarea{ flex:1; background:#0f1422; border:1px solid rgba(255,255,255,.08); color:var(--text); padding:10px 12px; border-radius:12px; resize:vertical; max-height:200px }

    .chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px}
    .chip{font-size:12px;border:1px solid rgba(255,255,255,.1);padding:3px 6px;border-radius:999px;color:#cdd6f4}

    /* –ö–æ–Ω—Ç–µ–∫—Å—Ç-–º–µ–Ω—é —Ä–µ–∞–∫—Ü–∏–π */
    .react-menu{ position:fixed; display:none; gap:6px; padding:6px; background:#0f1422; border:1px solid rgba(255,255,255,.12); border-radius:12px; box-shadow:var(--shadow) }
    .react-menu button{ font-size:18px; background:transparent; border:none; cursor:pointer }

    /* –ü—Ä–æ—Ñ–∏–ª—å + –õ–° */
    .modal{ position:fixed; inset:0; display:none; place-items:center; background: rgba(0,0,0,.55); z-index:40 }
    .modal.open{ display:grid }
    .sheet{ width:min(900px, 96vw); background:#0b101c; border:1px solid rgba(255,255,255,.08); border-radius:18px; overflow:hidden; }
    .sheet-head{ display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid rgba(255,255,255,.08) }
    .sheet-body{ padding:12px; display:grid; grid-template-columns: 260px 1fr; gap:12px }
    .sheet-body .section{ background:#0f1422; border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:10px }

    .list{ display:flex; flex-direction:column; gap:6px; max-height:55vh; overflow:auto }
    .list .item{ display:flex; align-items:center; gap:10px; padding:8px; border:1px solid rgba(255,255,255,.06); border-radius:12px; background: rgba(255,255,255,.02); cursor:pointer }
    .status-dot{ width:8px; height:8px; border-radius:50% }

    /* –ê–¥–º–∏–Ω–∫–∞ */
    .admin{ display:none }
    .admin.open{ display:block }
    .admin .grid{ display:grid; grid-template-columns: repeat(3, 1fr); gap:10px }

    /* –ö–∞—Ä—Ç–∞ */
    #map{ width:100%; height:65vh; border-radius:16px }

    /* –ü–æ–º–æ—â—å */
    .help p{ color:#c9d4ee }

    /* –£—Ç–∏–ª–∏—Ç–∏ */
    .hidden{ display:none !important }
    .row{display:flex;gap:8px;align-items:center}
    .grow{flex:1}
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <div class="nav">
      <!-- –ê–≤–∞—Ç–∞—Ä —Å–ª–µ–≤–∞ -->
      <div id="profileTrigger" class="avatar-wrap" title="–ü—Ä–æ—Ñ–∏–ª—å, –¥—Ä—É–∑—å—è, –õ–°">
        <img id="navAvatar" class="avatar" src="https://i.pravatar.cc/80?img=64" alt="avatar"/>
        <div>
          <div style="font-weight:700">–ü—Ä–æ—Ñ–∏–ª—å</div>
          <div id="navOnline" class="pill" style="font-size:11px; opacity:.85">–æ–Ω–ª–∞–π–Ω: <span id="onlineCount">‚Äî</span></div>
        </div>
      </div>
      <div class="logo" style="margin-left:10px">PRAHA&nbsp;<span>FU≈†KY</span></div>

      <div class="tabs">
        <button class="btn" data-view="chatMain">–ß–∞—Ç</button>
        <button class="btn" data-view="chatRent">–ß–∞—Ç –û—Ä–µ–Ω–¥–∞</button>
        <button class="btn" data-view="map">–ö–∞—Ä—Ç–∞</button>
        <button class="btn" data-view="help">–ü–æ–º–æ—â—å</button>
        <button id="adminBtn" class="btn warning hidden" data-view="admin">–ê–¥–º–∏–Ω</button>
      </div>
    </div>
  </header>

  <div class="container">
    <aside class="side">
      <h4>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h4>
      <div class="menu">
        <button class="btn primary" data-view="chatMain">–û—Ç–∫—Ä—ã—Ç—å –æ–±—â–∏–π —á–∞—Ç</button>
        <button class="btn" data-view="chatRent">–ß–∞—Ç –∞—Ä–µ–Ω–¥—ã</button>
        <button class="btn" data-view="map">–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É</button>
        <button class="btn" data-view="help">–ü–æ–º–æ—â—å</button>
        <button id="sideAdminBtn" class="btn warning hidden" data-view="admin">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
      </div>
      <div class="notice">
        <div class="sub">–Ø–∫—â–æ –≤–∏ –≤–ø–µ—Ä—à–µ ‚Äî –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å <b>¬´–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏¬ª</b> ‚Äî –∑'—è–≤–∏—Ç—å—Å—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è. <b>6 –≥–æ–¥–∏–Ω –¥–æ—Å—Ç—É–ø—É –±–µ–∑ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è email.</b></div>
      </div>
      <div class="chips">
        <div class="chip">–ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ —á–∞—Ç–∞</div>
        <div class="chip">–õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</div>
        <div class="chip">–î—Ä—É–∑—å—è –æ–Ω–ª–∞–π–Ω</div>
        <div class="chip">–ë–æ—Ç—ã-–æ–±—ä—è–≤–ª–µ–Ω–∏—è</div>
      </div>
    </aside>

    <main class="main">
      <section class="hero card">
        <div class="hero-overlay"></div>
        <div class="hero-content">
          <h1>PRAHA FU≈†KY</h1>
          <div class="sub">–ú–µ—Å—Ç–æ –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π, –≤–∞–∫–∞–Ω—Å–∏–π, –∞—Ä–µ–Ω–¥—ã –∏ –æ–±—â–µ–Ω–∏—è. –£–≤–∞–∂–∞–π—Ç–µ –¥—Ä—É–≥ –¥—Ä—É–≥–∞. –ü–æ–º–Ω–∏—Ç–µ: –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö.</div>
          <div class="tabs-line" style="margin-top:10px">
            <button class="btn" data-view="chatMain">–ß–∞—Ç</button>
            <button class="btn" data-view="map">–ö–∞—Ä—Ç–∞</button>
            <button class="btn" data-view="help">–ü–æ–º–æ—â—å</button>
          </div>
        </div>
      </section>

      <!-- –ß–ê–¢–´ -->
      <section id="view-chatMain" class="card chat-wrap">
        <div class="messages" id="messages-main"></div>
        <div class="composer">
          <textarea id="input-main" rows="1" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶"></textarea>
          <input id="imageUrl-main" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
          <button class="btn primary" id="send-main">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </section>

      <section id="view-chatRent" class="card chat-wrap hidden">
        <div class="messages" id="messages-rent"></div>
        <div class="composer">
          <textarea id="input-rent" rows="1" placeholder="–ê—Ä–µ–Ω–¥–∞: –Ω–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶"></textarea>
          <input id="imageUrl-rent" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
          <button class="btn primary" id="send-rent">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </section>

      <!-- –ö–ê–†–¢–ê -->
      <section id="view-map" class="card hidden">
        <div id="map"></div>
        <div class="row" style="padding:10px">
          <input id="mapTitle" class="grow" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–æ—á–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –û–±—ä—è–≤–ª–µ–Ω–∏–µ)" />
          <input id="mapImg" class="grow" placeholder="URL –∏–∫–æ–Ω–∫–∏ (–∫–∞—Ä—Ç–∏–Ω–∫–∏ –º–∞—Ä–∫–µ—Ä–∞)" />
          <input id="mapLat" placeholder="Lat" style="width:120px" />
          <input id="mapLng" placeholder="Lng" style="width:120px" />
          <button class="btn" id="addMarker">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É</button>
        </div>
      </section>

      <!-- –ü–û–ú–û–©–¨ -->
      <section id="view-help" class="card help hidden" style="padding:14px">
        <h3>–ü—Ä–∞–≤–∏–ª–∞ –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏</h3>
        <p>1) –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç 6 —á–∞—Å–æ–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email. –î–∞–ª—å—à–µ ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–æ—á—Ç—É –∏–ª–∏ –æ—Ñ–æ—Ä–º–∏—Ç–µ –ø—Ä–µ–º–∏—É–º.</p>
        <p>2) –õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è: –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ –ª–µ–≤–æ–≥–æ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É–≥–ª–∞, –Ω–∞–π–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ù–∞–ø–∏—Å–∞—Ç—å¬ª.</p>
        <p>3) –î—Ä—É–∑—å—è: –∑–∞—è–≤–∫–∏ –∏ —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π ‚Äî –≤ –ø—Ä–æ—Ñ–∏–ª–µ (¬´–î—Ä—É–∑—å—è¬ª). –û–Ω–ª–∞–π–Ω —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –º–∏–Ω—É—Ç—ã.</p>
        <p>4) –†–µ–∞–∫—Ü–∏–∏: —É–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ–±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫ üëç, –ø–æ–º–µ—Ç–∏—Ç—å ¬´–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ –º–æ—à–µ–Ω–Ω–∏–∫¬ª ‚ö†Ô∏è, –¥–∏–∑–ª–∞–π–∫ üëé, —Å–ø–∞–º üö´ –∏ –¥—Ä.</p>
        <p>5) –ö–∞—Ä—Ç–∞: –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Ç–æ—á–∫–∏ —Å –∏–∫–æ–Ω–∫–∞–º–∏ ‚Äî –Ω—É–∂–µ–Ω URL –∫–∞—Ä—Ç–∏–Ω–∫–∏, —Ç–∞–∫ –∫–∞–∫ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ Firebase –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.</p>
        <p>6) –†–µ–∫–ª–∞–º–∞: –ø–∏—à–∏—Ç–µ –Ω–∞ <b><span id="adEmail">urciknikolaj642@gmail.com</span></b>.</p>
      </section>

      <!-- –ê–î–ú–ò–ù–ö–ê -->
      <section id="view-admin" class="card admin hidden" style="padding:12px">
        <h3>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
        <div class="chips" style="margin-bottom:10px">
          <div class="chip">–ü—Ä–æ–¥–ª–∏—Ç—å +30 –¥–Ω–µ–π</div>
          <div class="chip">–ü—Ä–µ–º–∏—É–º –Ω–∞–≤—Å–µ–≥–¥–∞</div>
          <div class="chip">–ë–ª–æ–∫/—Ä–∞–∑–±–ª–æ–∫</div>
          <div class="chip">–û–±–Ω—É–ª–∏—Ç—å –ª–∏–º–∏—Ç—ã</div>
        </div>
        <div class="grid" id="adminUsers"></div>
      </section>
    </main>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –∏ –õ–° -->
  <div id="profileModal" class="modal">
    <div class="sheet">
      <div class="sheet-head">
        <div class="row">
          <img id="profileAvatar" class="avatar" src="https://i.pravatar.cc/80?img=64"/>
          <div>
            <div id="profileName" style="font-weight:800">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</div>
            <div style="font-size:12px;color:#9aa3ba">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä (URL)</div>
          </div>
        </div>
        <div class="row">
          <button class="btn" id="profileMsgsBtn">–õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</button>
          <button class="btn" id="profileFriendsBtn">–î—Ä—É–∑—å—è</button>
          <button class="btn danger" id="logoutBtn">–í—ã–π—Ç–∏</button>
          <button class="btn" id="closeProfile">√ó</button>
        </div>
      </div>
      <div class="sheet-body">
        <div class="section">
          <h4>–ú–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h4>
          <label>–ù–∏–∫</label>
          <input id="nickInput" style="width:100%" placeholder="–í–∞—à –Ω–∏–∫" />
          <div class="chips" style="margin-top:8px">
            <div class="chip">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –±–µ–∑ —Ñ–æ—Ç–æ: <span id="quotaText">‚Äî</span></div>
            <div class="chip">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Å —Ñ–æ—Ç–æ: <span id="quotaPhoto">‚Äî</span></div>
            <div class="chip">–ü—Ä–µ–º–∏—É–º –¥–æ: <span id="premiumUntil">‚Äî</span></div>
          </div>
          <div class="chips" style="margin-top:6px">
            <div class="chip">–°—Ç–∞—Ç—É—Å: <span id="statusText">‚Äî</span></div>
          </div>
          <div class="row" style="margin-top:8px">
            <button class="btn success" id="saveProfile">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
        </div>
        <div class="section">
          <div class="row" style="justify-content:space-between">
            <h4>–î–∏–∞–ª–æ–≥–∏</h4>
            <input id="searchUsers" placeholder="–ü–æ–∏—Å–∫ –ø–æ –ª—é–¥—è–º‚Ä¶" style="max-width:260px" />
          </div>
          <div class="list" id="dialogs"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- –ö–æ–Ω—Ç–µ–∫—Å—Ç –º–µ–Ω—é —Ä–µ–∞–∫—Ü–∏–π -->
  <div id="reactMenu" class="react-menu"></div>

  <!-- Firebase & App Scripts -->
  <script type="module">
    // === Firebase (—Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) ===
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInAnonymously, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { getDatabase, ref, onValue, push, set, update, serverTimestamp, query, limitToLast, orderByChild, equalTo, get, child } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDw_bVibsVyZegH7OJyZ_yRjI3uLhroVBk",
      authDomain: "praga-4baee.firebaseapp.com",
      databaseURL: "https://praga-4baee-default-rtdb.firebaseio.com",
      projectId: "praga-4baee",
      storageBucket: "praga-4baee.firebasestorage.app",
      messagingSenderId: "336023952536",
      appId: "1:336023952536:web:f7437feaa25b6eadcd04ed",
      measurementId: "G-BGDJD6R12N"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    // === –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ===
    let me = null;               // —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (auth)
    let meData = null;           // –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ /users/{uid}
    let activeView = 'chatMain';

    const views = {
      chatMain: document.getElementById('view-chatMain'),
      chatRent: document.getElementById('view-chatRent'),
      map: document.getElementById('view-map'),
      help: document.getElementById('view-help'),
      admin: document.getElementById('view-admin'),
    };

    // === –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º ===
    document.querySelectorAll('[data-view]').forEach(btn=>{
      btn.addEventListener('click', ()=>switchView(btn.dataset.view))
    });
    function switchView(name){
      activeView=name;
      Object.entries(views).forEach(([k,el])=> el.classList.toggle('hidden', k!==name));
      if(name==='map') setTimeout(()=>initMapOnce(), 0);
    }

    // === –ü—Ä–æ—Ñ–∏–ª—å ===
    const profileTrigger = document.getElementById('profileTrigger');
    const profileModal = document.getElementById('profileModal');
    const closeProfile = document.getElementById('closeProfile');
    profileTrigger.addEventListener('click', ()=> profileModal.classList.add('open'));
    closeProfile.addEventListener('click', ()=> profileModal.classList.remove('open'));

    // === –û–Ω–±–æ—Ä–¥–∏–Ω–≥: –∞–Ω–æ–Ω–∏–º–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è + –ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ 6 —á–∞—Å–æ–≤ ===
    onAuthStateChanged(auth, async (user)=>{
      if(!user){
        await signInAnonymously(auth);
        return;
      }
      me = user;
      const uref = ref(db, `users/${user.uid}`);
      const snap = await get(uref);
      const now = Date.now();
      if(!snap.exists()){
        const trialHours = 6;
        await set(uref, {
          uid: user.uid,
          nick: `user_${user.uid.slice(0,6)}`,
          avatar: 'https://i.pravatar.cc/120?u='+user.uid,
          createdAt: now,
          firstLoginAt: now,
          premiumForever: false,
          premiumUntil: 0,
          blocked: false,
          lastSeen: now,
          freeTextLeft: 30,
          freePhotoLeft: 10,
          isAdmin: false,
          trialEndsAt: now + trialHours*60*60*1000,
        });
      } else {
        meData = snap.val();
      }
      watchMe();
      bootstrapUI();
      startChatListeners();
      startOnlineCounter();
      startBots();
    });

    async function watchMe(){
      const uref = ref(db, `users/${me.uid}`);
      onValue(uref, (s)=>{
        meData = s.val();
        if(!meData) return;
        document.getElementById('navAvatar').src = meData.avatar || 'https://i.pravatar.cc/80?img=64';
        document.getElementById('profileAvatar').src = meData.avatar || 'https://i.pravatar.cc/80?img=64';
        document.getElementById('nickInput').value = meData.nick || '';
        document.getElementById('quotaText').textContent = meData.freeTextLeft ?? '‚Äî';
        document.getElementById('quotaPhoto').textContent = meData.freePhotoLeft ?? '‚Äî';
        document.getElementById('premiumUntil').textContent = meData.premiumForever ? '–Ω–∞–≤—Å–µ–≥–¥–∞' : (meData.premiumUntil? new Date(meData.premiumUntil).toLocaleString(): '‚Äî');
        document.getElementById('statusText').textContent = meData.blocked? '–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '–∞–∫—Ç–∏–≤–µ–Ω';
        document.getElementById('adminBtn').classList.toggle('hidden', !meData.isAdmin);
        document.getElementById('sideAdminBtn').classList.toggle('hidden', !meData.isAdmin);
      })
      // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ lastSeen –∫–∞–∂–¥—ã–µ 30—Å
      setInterval(()=> update(ref(db, `users/${me.uid}`), { lastSeen: Date.now() }), 30000);
    }

    document.getElementById('saveProfile').addEventListener('click', async()=>{
      const nick = document.getElementById('nickInput').value.trim().slice(0,32) || `user_${me.uid.slice(0,6)}`;
      await update(ref(db, `users/${me.uid}`), { nick });
      alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
    });

    document.getElementById('profileAvatar').addEventListener('click', async()=>{
      const url = prompt('–í—Å—Ç–∞–≤—å—Ç–µ URL –∞–≤–∞—Ç–∞—Ä–∞ (–º—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º Firebase Storage)');
      if(url) await update(ref(db, `users/${me.uid}`), { avatar: url });
    })
    document.getElementById('logoutBtn').addEventListener('click', ()=> signOut(auth));

    // === –î—Ä—É–∑—å—è –∏ –õ–° ===
    const dialogsEl = document.getElementById('dialogs');
    const searchUsers = document.getElementById('searchUsers');
    searchUsers.addEventListener('input', async ()=>{
      const q = searchUsers.value.trim().toLowerCase();
      const snap = await get(ref(db, 'users'));
      dialogsEl.innerHTML = '';
      if(snap.exists()){
        Object.values(snap.val()).filter(u=> (u.nick||'').toLowerCase().includes(q) && u.uid!==me.uid).slice(0,50).forEach(u=>{
          const online = Date.now() - (u.lastSeen||0) < 120000;
          const item = document.createElement('div');
          item.className='item';
          item.innerHTML = `
            <img src="${u.avatar}" class="avatar"/>
            <div class="grow">
              <div style="font-weight:700">${u.nick||u.uid.slice(0,6)}</div>
              <div style="font-size:12px;color:#9aa3ba">${online? '–æ–Ω–ª–∞–π–Ω' : '–æ—Ñ—Ñ–ª–∞–π–Ω'}</div>
            </div>
            <button class="btn" data-act="chat">–ù–∞–ø–∏—Å–∞—Ç—å</button>
            <button class="btn" data-act="add">–í –¥—Ä—É–∑—å—è</button>
            <button class="btn danger" data-act="report">–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</button>
          `;
          item.querySelector('[data-act="chat"]').onclick = ()=> openDM(u.uid);
          item.querySelector('[data-act="add"]').onclick = ()=> sendFriendRequest(u.uid);
          item.querySelector('[data-act="report"]').onclick = ()=> reportUser(u.uid);
          dialogsEl.appendChild(item);
        })
      }
    });

    async function sendFriendRequest(toUid){
      const id = push(ref(db, `friendRequests/${toUid}`)).key;
      await set(ref(db, `friendRequests/${toUid}/${id}`), { from: me.uid, at: Date.now() });
      alert('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞');
    }

    function reportUser(uid){
      const id = push(ref(db, 'reports')).key;
      set(ref(db, `reports/${id}`), { from: me.uid, against: uid, at: Date.now() });
      alert('–ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞');
    }

    // –ü—Ä–æ—Ñ–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
    document.getElementById('profileFriendsBtn').addEventListener('click', showFriends);
    async function showFriends(){
      const wrap = dialogsEl; wrap.innerHTML = '';
      // –ó–∞—è–≤–∫–∏
      const rq = await get(ref(db, `friendRequests/${me.uid}`));
      if(rq.exists()){
        const box = document.createElement('div');
        box.innerHTML = '<h4>–ó–∞—è–≤–∫–∏ –≤ –¥—Ä—É–∑—å—è</h4>';
        wrap.appendChild(box);
        for(const [rid, r] of Object.entries(rq.val())){
          const us = await get(ref(db, `users/${r.from}`));
          if(!us.exists()) continue;
          const u = us.val();
          const item = document.createElement('div');
          item.className='item';
          item.innerHTML = `
            <img src="${u.avatar}" class="avatar"/>
            <div class="grow"><div style="font-weight:700">${u.nick}</div></div>
            <button class="btn success">–ü—Ä–∏–Ω—è—Ç—å</button>
            <button class="btn danger">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>`;
          item.children[2].onclick = async()=>{
            await set(ref(db, `friends/${me.uid}/${u.uid}`), true);
            await set(ref(db, `friends/${u.uid}/${me.uid}`), true);
            await set(ref(db, `friendRequests/${me.uid}/${rid}`), null);
            showFriends();
          };
          item.children[3].onclick = async()=>{ await set(ref(db, `friendRequests/${me.uid}/${rid}`), null); showFriends(); };
          wrap.appendChild(item);
        }
      }
      // –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π
      const fr = await get(ref(db, `friends/${me.uid}`));
      const box2 = document.createElement('div');
      box2.innerHTML = '<h4>–ú–æ–∏ –¥—Ä—É–∑—å—è</h4>';
      wrap.appendChild(box2);
      if(fr.exists()){
        for(const uid of Object.keys(fr.val())){
          const us = await get(ref(db, `users/${uid}`)); if(!us.exists()) continue; const u=us.val();
          const online = Date.now() - (u.lastSeen||0) < 120000;
          const item = document.createElement('div');
          item.className='item';
          item.innerHTML = `
            <span class="status-dot" style="background:${online? '#22c55e':'#64748b'}"></span>
            <img src="${u.avatar}" class="avatar"/>
            <div class="grow"><div style="font-weight:700">${u.nick}</div></div>
            <button class="btn" data-act="chat">–ù–∞–ø–∏—Å–∞—Ç—å</button>
            <button class="btn danger" data-act="rm">–£–¥–∞–ª–∏—Ç—å</button>`;
          item.querySelector('[data-act="chat"]').onclick = ()=> openDM(u.uid);
          item.querySelector('[data-act="rm"]').onclick = async()=>{ await set(ref(db, `friends/${me.uid}/${u.uid}`), null); await set(ref(db, `friends/${u.uid}/${me.uid}`), null); showFriends(); };
          wrap.appendChild(item);
        }
      } else {
        const p = document.createElement('p'); p.textContent='–ü–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π'; wrap.appendChild(p);
      }
    }

    // === –õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (DM) ===
    async function openDM(withUid){
      profileModal.classList.remove('open');
      const otherSnap = await get(ref(db, `users/${withUid}`));
      if(!otherSnap.exists()) return alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
      const other = otherSnap.val();
      const chatId = dmId(me.uid, withUid);
      switchView('chatMain'); // –≤–∏–∑—É–∞–ª—å–Ω–æ —Ç–æ—Ç –∂–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å; –º–æ–∂–Ω–æ —Ä–∞–∑–≤–µ—Å—Ç–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
      // –û—Ç–∫—Ä–æ–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–≤–µ—Ä—Ö –≥–ª–∞–≤–Ω–æ–≥–æ —á–∞—Ç–∞
      const win = document.createElement('div');
      win.className='card';
      win.style.position='fixed'; win.style.bottom='12px'; win.style.right='12px'; win.style.width='min(460px, 95vw)'; win.style.zIndex='45';
      win.innerHTML = `
        <div class="row" style="justify-content:space-between; padding:8px 10px; border-bottom:1px solid rgba(255,255,255,.08)">
          <div class="row"><img class="avatar" src="${other.avatar}"><div style="margin-left:8px"><div style="font-weight:800">${other.nick}</div><div style="font-size:12px;color:#9aa3ba">–õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</div></div></div>
          <button class="btn" data-x>√ó</button>
        </div>
        <div class="messages" style="height:40vh"></div>
        <div class="composer">
          <textarea rows="1" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶"></textarea>
          <input placeholder="URL —Ñ–æ—Ç–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
          <button class="btn primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>`;
      document.body.appendChild(win);
      win.querySelector('[data-x]').onclick = ()=> win.remove();
      const list = win.querySelector('.messages');
      const text = win.querySelector('textarea');
      const img = win.querySelector('input');
      const send = win.querySelector('button.btn.primary');

      const msgsRef = ref(db, `dm/${chatId}`);
      onValue(query(msgsRef, orderByChild('at'), limitToLast(100)), (s)=>{
        list.innerHTML='';
        if(s.exists()){
          Object.entries(s.val()).sort((a,b)=>a[1].at-b[1].at).forEach(([id,m])=>{
            const el = renderMessage(m, me.uid);
            list.appendChild(el);
          });
          list.scrollTop = list.scrollHeight;
        }
      });
      send.onclick = ()=> sendMessageTo(`dm/${chatId}`, text.value, img.value);
    }
    function dmId(a,b){ return a<b? `${a}_${b}` : `${b}_${a}` }

    // === –†–µ–∞–∫—Ü–∏–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é ===
    const reactMenu = document.getElementById('reactMenu');
    const reactions = [
      {k:'like', e:'üëç'},
      {k:'warn', e:'‚ö†Ô∏è'},
      {k:'dislike', e:'üëé'},
      {k:'spam', e:'üö´'},
      {k:'love', e:'‚ù§Ô∏è'},
    ];

    function attachReactionMenu(el, path, msgId){
      el.addEventListener('contextmenu', (e)=>{ e.preventDefault(); showReactMenu(e.clientX, e.clientY, path, msgId) });
      let t; el.addEventListener('mousedown', (e)=>{ t=setTimeout(()=>showReactMenu(e.clientX,e.clientY,path,msgId), 420)});
      ['mouseup','mouseleave'].forEach(ev=> el.addEventListener(ev, ()=>clearTimeout(t)));
    }
    function showReactMenu(x,y, path, msgId){
      reactMenu.innerHTML='';
      reactions.forEach(r=>{
        const b=document.createElement('button'); b.textContent=r.e; b.title=r.k; b.onclick=()=>{
          const id = push(ref(db, `${path}/${msgId}/reactions/${r.k}`)).key;
          set(ref(db, `${path}/${msgId}/reactions/${r.k}/${id}`), me.uid);
          hideReactMenu();
        }; reactMenu.appendChild(b);
      })
      reactMenu.style.left=x+'px'; reactMenu.style.top=y+'px'; reactMenu.style.display='flex';
      document.addEventListener('click', hideReactMenu, {once:true});
    }
    function hideReactMenu(){ reactMenu.style.display='none' }

    // === –û–±—â–∏–π —á–∞—Ç –∏ —á–∞—Ç –∞—Ä–µ–Ω–¥—ã ===
    function startChatListeners(){
      bindChat('main', 'chat/main');
      bindChat('rent', 'chat/rent');
    }
    function bindChat(code, path){
      const list = document.getElementById(`messages-${code}`);
      const input = document.getElementById(`input-${code}`);
      const img = document.getElementById(`imageUrl-${code}`);
      const btn = document.getElementById(`send-${code}`);
      const msgsRef = ref(db, path);
      onValue(query(msgsRef, orderByChild('at'), limitToLast(200)), (s)=>{
        list.innerHTML='';
        if(s.exists()){
          const arr = Object.entries(s.val()).sort((a,b)=>a[1].at-b[1].at);
          arr.forEach(([id,m])=>{
            const el = renderMessage(m, me?.uid);
            attachReactionMenu(el.querySelector('.bubble'), path, id);
            list.appendChild(el);
          })
          list.scrollTop = list.scrollHeight; // –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞
        }
      })
      btn.addEventListener('click', ()=> sendMessageTo(path, input.value, img.value));
    }

    async function sendMessageTo(path, text, imageUrl){
      text = (text||'').trim(); imageUrl = (imageUrl||'').trim();
      if(!text && !imageUrl) return;
      if(meData?.blocked) return alert('–í—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã');
      const now = Date.now();
      const trialOk = now < (meData?.trialEndsAt||0);
      const isPrem = meData?.premiumForever || (meData?.premiumUntil||0) > now;
      const freeTextLeft = meData?.freeTextLeft||0;
      const freePhotoLeft = meData?.freePhotoLeft||0;

      const needPhotoQuota = !!imageUrl;
      const enough = isPrem || trialOk || (!needPhotoQuota && freeTextLeft>0) || (needPhotoQuota && freePhotoLeft>0);
      if(!enough){
        return alert('–õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω. –û—Ñ–æ—Ä–º–∏—Ç–µ –ø—Ä–µ–º–∏—É–º –∏–ª–∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è.');
      }
      const id = push(ref(db, path)).key;
      const msg = { id, from: me.uid, text, image: imageUrl||'', at: Date.now() };
      await set(ref(db, `${path}/${id}`), msg);
      // —Å–ø–∏—Å—ã–≤–∞–µ–º –∫–≤–æ—Ç—ã
      if(!isPrem && !trialOk){
        if(needPhotoQuota) await update(ref(db, `users/${me.uid}`), { freePhotoLeft: Math.max(0, freePhotoLeft-1) });
        else await update(ref(db, `users/${me.uid}`), { freeTextLeft: Math.max(0, freeTextLeft-1) });
      }
      // –æ—á–∏—Å—Ç–∫–∞ –≤–≤–æ–¥–∞
      const [_, code] = path.split('/');
      const input = document.getElementById(`input-${code}`);
      const img = document.getElementById(`imageUrl-${code}`);
      if(input) input.value=''; if(img) img.value='';
    }

    function renderMessage(m, myUid){
      const wrap = document.createElement('div');
      wrap.className = 'msg'+ (m.from===myUid? ' self':'');
      const avatar = document.createElement('img'); avatar.className='avatar'; avatar.src='https://i.pravatar.cc/80?u='+m.from;
      const bubble = document.createElement('div'); bubble.className='bubble';
      const name = document.createElement('div'); name.className='name'; name.textContent = m.from===myUid? '–í—ã' : (m.nick||'');
      const time = document.createElement('div'); time.className='meta'; time.textContent = new Date(m.at).toLocaleString();
      if(m.text){ const p=document.createElement('div'); p.textContent = m.text; bubble.appendChild(p); }
      if(m.image){ const im=document.createElement('img'); im.src=m.image; im.className='media'; bubble.appendChild(im); }

      // —Ä–µ–∞–∫—Ü–∏–∏
      const rbar = document.createElement('div'); rbar.className='meta';
      const reacts = m.reactions? Object.entries(m.reactions).map(([k,v])=> ({k, n: Object.keys(v).length})) : [];
      if(reacts.length){ rbar.textContent = '–†–µ–∞–∫—Ü–∏–∏: '+reacts.map(r=> `${reactions.find(x=>x.k===r.k)?.e||r.k} x${r.n}`).join('  '); bubble.appendChild(rbar) }

      wrap.appendChild(avatar); wrap.appendChild(bubble);
      bubble.title = '–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –¥–ª—è —Ä–µ–∞–∫—Ü–∏–π';
      return wrap;
    }

    // === –û–Ω–ª–∞–π–Ω—ã (—Å –º–Ω–æ–∂–∏—Ç–µ–ª–µ–º 10x) ===
    async function startOnlineCounter(){
      function tick(){
        get(ref(db, 'users')).then(s=>{
          let online=0; if(s.exists()){
            Object.values(s.val()).forEach(u=>{ if(Date.now() - (u.lastSeen||0) < 120000) online++; })
          }
          document.getElementById('onlineCount').textContent = online*10; // –º–Ω–æ–∂–∏—Ç–µ–ª—å 10x
        })
      }
      tick(); setInterval(tick, 15000);
    }

    // === –ê–¥–º–∏–Ω–∫–∞: —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –¥–µ–π—Å—Ç–≤–∏—è ===
    async function refreshAdmin(){
      if(!meData?.isAdmin) return;
      const wrap = document.getElementById('adminUsers');
      wrap.innerHTML='';
      const s = await get(ref(db, 'users'));
      if(!s.exists()) return;
      const users = Object.values(s.val()).sort((a,b)=> (b.lastSeen||0)-(a.lastSeen||0));
      users.forEach(u=>{
        const card=document.createElement('div'); card.className='card'; card.style.padding='10px';
        card.innerHTML = `
          <div class="row" style="justify-content:space-between">
            <div class="row"><img class="avatar" src="${u.avatar}"><div style="margin-left:8px"><div style="font-weight:800">${u.nick||u.uid.slice(0,6)}</div><div style="font-size:12px;color:#9aa3ba">UID: ${u.uid}</div></div></div>
            <div class="chips"><div class="chip">–¢–µ–∫—Å—Ç: ${u.freeTextLeft||0}</div><div class="chip">–§–æ—Ç–æ: ${u.freePhotoLeft||0}</div><div class="chip">–ü—Ä–µ–º–∏—É–º: ${u.premiumForever? '–Ω–∞–≤—Å–µ–≥–¥–∞' : (u.premiumUntil? new Date(u.premiumUntil).toLocaleDateString():'‚Äî')}</div><div class="chip">–ü—Ä–æ–±–Ω—ã–π –¥–æ: ${u.trialEndsAt? new Date(u.trialEndsAt).toLocaleString():'‚Äî'}</div><div class="chip">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥: ${u.lastSeen? new Date(u.lastSeen).toLocaleString():'‚Äî'}</div></div>
          </div>
          <div class="row" style="margin-top:8px;flex-wrap:wrap">
            <button class="btn" data-act="extend">+30 –¥–Ω–µ–π</button>
            <button class="btn success" data-act="forever">–ü—Ä–µ–º–∏—É–º –Ω–∞–≤—Å–µ–≥–¥–∞</button>
            <button class="btn warning" data-act="toggleBlock">${u.blocked? '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å':'–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å'}</button>
            <button class="btn" data-act="reset">–û–±–Ω—É–ª–∏—Ç—å –ª–∏–º–∏—Ç—ã</button>
            <input class="grow" data-k="text" placeholder="–ù–æ–≤—ã–π –ª–∏–º–∏—Ç —Ç–µ–∫—Å—Ç" />
            <input class="grow" data-k="photo" placeholder="–ù–æ–≤—ã–π –ª–∏–º–∏—Ç —Ñ–æ—Ç–æ" />
            <button class="btn" data-act="applyLimits">–ó–∞–¥–∞—Ç—å –ª–∏–º–∏—Ç—ã</button>
          </div>
        `;
        card.querySelector('[data-act="extend"]').onclick = async()=>{
          const till = Math.max(Date.now(), u.premiumUntil||0) + 30*24*60*60*1000;
          await update(ref(db, `users/${u.uid}`), { premiumUntil: till, premiumForever: false }); refreshAdmin();
        }
        card.querySelector('[data-act="forever"]').onclick = async()=>{
          await update(ref(db, `users/${u.uid}`), { premiumForever: true }); refreshAdmin();
        }
        card.querySelector('[data-act="toggleBlock"]').onclick = async()=>{
          await update(ref(db, `users/${u.uid}`), { blocked: !u.blocked }); refreshAdmin();
        }
        card.querySelector('[data-act="reset"]').onclick = async()=>{
          await update(ref(db, `users/${u.uid}`), { freeTextLeft: 30, freePhotoLeft: 10 }); refreshAdmin();
        }
        card.querySelector('[data-act="applyLimits"]').onclick = async()=>{
          const t = Number(card.querySelector('[data-k="text"]').value||u.freeTextLeft||0);
          const p = Number(card.querySelector('[data-k="photo"]').value||u.freePhotoLeft||0);
          await update(ref(db, `users/${u.uid}`), { freeTextLeft: t, freePhotoLeft: p }); refreshAdmin();
        }
        document.getElementById('adminUsers').appendChild(card);
      })
    }

    // –æ—Ç–∫—Ä—ã—Ç–∏–µ –∞–¥–º–∏–Ω–∫–∏
    document.getElementById('adminBtn').addEventListener('click', ()=>{ switchView('admin'); refreshAdmin(); });
    document.getElementById('sideAdminBtn').addEventListener('click', ()=>{ switchView('admin'); refreshAdmin(); });

    // === –ë–æ—Ç—ã: 3 –±–æ—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏ (2–º, 3–º, 4–º) ===
    const bots = [
      {
        name:'Bot#1', avatar:'https://i.ibb.co/LH4wBMS/IMG-d8e6076e17f19db7fe3add0754738a01-V.jpg',
        interval: 2*60*1000,
        posts:[
          {text:'O2 –°I–ú –ö–ê–†–¢–ê\n–ë–µ–∑ –ª—ñ–º—ñ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, –±–µ–∑ –ª—ñ–º—ñ—Ç –¥–∑–≤—ñ–Ω–∫–∏, –ø—Ä–∞—Ü—é—î –≤ –Ñ–≤—Ä–æ–ø—ñ. –ü–ª–∞—Ç–∞ 699 –∫—Ä–æ–Ω/–º—ñ—Å. –¶—ñ–Ω–∞ 299 Kƒç. —Ç–µ–ª 607914467. Viber/WhatsApp/Telegram.', image:'https://i.ibb.co/LH4wBMS/IMG-d8e6076e17f19db7fe3add0754738a01-V.jpg'},
          {text:'–ü—Ä–æ–¥–∞—é iPhone 11 Pro Max + 26 —á–æ—Ö–ª—ñ–≤ (—á–æ—Ö–ª–∏ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ). –°—Ç–∞–Ω –≤—ñ–¥–º—ñ–Ω–Ω–∏–π, –Ω–µ –ø–∞–¥–∞–≤, –≤—Å–µ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ. –ë–µ–∑ Apple ID. –ü–∏—Ç–∞–Ω–Ω—è –≤ –æ—Å–æ–±–∏—Å—Ç—ñ.', image:'https://i.ibb.co/dwcXPqDr/IMG-1954f6b56869b9817a131ae33f3a37b6-V.jpg'},
          {text:'–û–≥–æ–ª–æ—à–µ–Ω–Ω—è –∑ —Ñ–æ—Ç–æ-—Ç–µ–∫—Å—Ç–æ–º', image:'https://i.ibb.co/G3kDcrYZ/IMG-fa590121e46c5b030c5ddc94d4e8bea9-V.jpg'},
        ]
      },
      {
        name:'Bot#2', avatar:'https://i.ibb.co/Z11WVrVC/IMG-b83692bb79a1468af74c81620750e8c0-V.jpg',
        interval: 3*60*1000,
        posts:[
          {text:'–ó–∞–ø—Ä–æ—à—É—é –º–æ–¥–µ–ª–µ–π –Ω–∞ –ø–µ—Ä–º–∞–Ω–µ–Ω—Ç–Ω–∏–π –º–∞–∫—ñ—è–∂ –ø—ñ–¥ –Ω–∞–≥–ª—è–¥–æ–º —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ–≥–æ –º–∞–π—Å—Ç—Ä–∞. –ü—Ä–∞–≥–∞, 28.07 –æ 14:00. –õ–∏—à–µ –∑–∞ –º–∞—Ç–µ—Ä—ñ–∞–ª. –ü–æ–¥—Ä–æ–±–∏—Ü—ñ ‚Äî –≤ –æ—Å–æ–±–∏—Å—Ç—ñ.' , image:'https://i.ibb.co/QFWDvGZ8/IMG-6748e7141906901b131b8fd5130a5c01-V.jpg'},
          {text:'–®–∞–±–ª–æ–Ω –¥–ª—è 2-–≥–æ –±–æ—Ç–∞ –∑ –∫–∞—Ä—Ç–∏–Ω–∫–æ—é', image:'https://i.ibb.co/Z11WVrVC/IMG-b83692bb79a1468af74c81620750e8c0-V.jpg'},
          {text:'–î–æ–¥–∞—Ç–∫–æ–≤–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è', image:'https://i.ibb.co/j97RhTny/IMG-593d75b053ea1a28cdfb9fc52f93afad-V.jpg'},
        ]
      },
      {
        name:'Bot#3', avatar:'https://i.ibb.co/MzdTMPR/IMG-8231d8142ffcbba7c682ca598683e3f2-V.jpg',
        interval: 4*60*1000,
        posts:[
          {text:'–ù—É–∂–µ–Ω –≤–æ–¥–∏—Ç–µ–ª—å –¥–ª—è –ø–æ–º–æ—â–∏ –≤ –ø–µ—Ä–µ–µ–∑–¥–µ, —Å–æ —Å–≤–æ–∏–º –∞–≤—Ç–æ. –ü–∏—à–∏—Ç–µ: WhatsApp +48 793 463 757, Telegram: @carlx_xxx', image:''},
          {text:'–ü–µ—Ä–µ–≤–æ–∑–∫–∏/—É—Å–ª—É–≥–∏ ‚Äî –¥–µ—Ç–∞–ª–∏ –≤ –õ–°', image:'https://i.ibb.co/MzdTMPR/IMG-8231d8142ffcbba7c682ca598683e3f2-V.jpg'},
          {text:'–ï—â—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ', image:'https://i.ibb.co/rfNV6ddC/IMG-0cd648a74f86227fe46db2d01c099be0-V.jpg'},
        ]
      },
    ];

    function startBots(){
      // –ø—É–±–ª–∏–∫—É–µ–º –≤ –æ–±—â–∏–π —á–∞—Ç –ø–æ –∫—Ä—É–≥—É
      bots.forEach((bot)=>{
        let idx=0;
        setInterval(async()=>{
          const p = bot.posts[idx%bot.posts.length]; idx++;
          const id = push(ref(db, 'chat/main')).key;
          const msg = { id, from:`bot_${bot.name}`, nick: bot.name, text:p.text, image:p.image||'', at: Date.now() };
          await set(ref(db, `chat/main/${id}`), msg);
        }, bot.interval);
      })
    }

    // === –ö–∞—Ä—Ç–∞ Google ===
    let _mapInited=false; let _map; let _markers=[];
    function initMapOnce(){ if(_mapInited) return; _mapInited=true; if(window.initAppMap) window.initAppMap(); }
    window.initAppMap = function(){
      // –°—Ç–∞—Ä—Ç –≤ –ü—Ä–∞–≥–µ
      _map = new google.maps.Map(document.getElementById('map'), { center:{lat:50.0755, lng:14.4378}, zoom:12, mapId:'DEMO_MAP_ID' });
      // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ—á–µ–∫
      onValue(ref(db, 'mapPoints'), (s)=>{
        _markers.forEach(m=>m.setMap(null)); _markers=[];
        if(s.exists()){
          Object.values(s.val()).forEach(p=>{
            const m = new google.maps.Marker({ position:{lat:p.lat, lng:p.lng}, map:_map, title:p.title||'', icon: p.icon? { url:p.icon, scaledSize: new google.maps.Size(32,32)}:undefined });
            const inf = new google.maps.InfoWindow({ content:`<b>${p.title||''}</b>` });
            m.addListener('click', ()=> inf.open({map:_map, anchor:m}));
            _markers.push(m);
          })
        }
      })
    }

    document.getElementById('addMarker').addEventListener('click', async()=>{
      const t = document.getElementById('mapTitle').value.trim();
      const i = document.getElementById('mapImg').value.trim();
      const lat = parseFloat(document.getElementById('mapLat').value);
      const lng = parseFloat(document.getElementById('mapLng').value);
      if(!t || isNaN(lat) || isNaN(lng)) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã');
      const id = push(ref(db, 'mapPoints')).key;
      await set(ref(db, `mapPoints/${id}`), { title:t, icon:i||'', lat, lng });
      document.getElementById('mapTitle').value=''; document.getElementById('mapImg').value=''; document.getElementById('mapLat').value=''; document.getElementById('mapLng').value='';
    })

    // === –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ ===
    function bootstrapUI(){
      // –ø–æ–¥–ø—Ä–∞–≤–∏–º –≤—ã—Å–æ—Ç—É –ª–µ–Ω—Ç (+25%)
      document.querySelectorAll('.messages').forEach(el=>{ el.style.minHeight='calc(65vh + 25%)'; el.style.maxHeight='calc(65vh + 25%)'; });
    }

    // –±—ã—Å—Ç—Ä—ã–π —Ñ–∏–ª—å—Ç—Ä –ª—é–¥–µ–π (–¥–∏–∞–ª–æ–≥–∏)
    document.getElementById('profileMsgsBtn').addEventListener('click', ()=>{ searchUsers.value=''; searchUsers.dispatchEvent(new Event('input')); });

    // –ù–∞–≤–µ—à–∏–≤–∞–µ–º –ø—Ä–æ—Å–ª—É—à–∫—É –Ω–∞ –∫–ª–∏–∫ –ø–æ –ª–æ–≥–æ—Ç–∏–ø—É ‚Äî –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä—ã—Ç—å –æ–±—â–∏–π —á–∞—Ç
    document.querySelector('.logo').addEventListener('click', ()=> switchView('chatMain'));

  </script>

  <!-- Google Maps (—Ä–µ–∞–ª—å–Ω—ã–π –∫–ª—é—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) -->
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFrxVhpb6nHJ6rhiLl5Ho8t0jOb1iEQNc&callback=initAppMap"></script>
</body>
</html>
