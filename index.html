<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PRAHA FU≈†KY ‚Äî —á–∞—Ç, –æ—Ä–µ–Ω–¥–∞, –∫–∞—Ä—Ç–∞, –¥–æ–ø–æ–º–æ–≥–∞</title>
  <style>
    :root{
      --bg:#0e0f12;
      --glass:rgba(20,22,27,.6);
      --glass-strong:rgba(20,22,27,.8);
      --text:#e9edf1;
      --muted:#b9c2cc;
      --accent:#7ac6ff;
      --danger:#ff6b6b;
      --ok:#2ad184;
      --warn:#ffcc00;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,"Noto Sans",Arial,sans-serif;
      color:var(--text);
      background:#000 url('https://images.unsplash.com/photo-1542370285-b8eb8317691f?q=80&w=1920&fit=crop') center/cover fixed no-repeat;
    }
    /* Glass overlay */
    .overlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,.55));pointer-events:none;z-index:-1}
    /* Top bar */
    .topbar{
      position:sticky;top:0;z-index:50;backdrop-filter:saturate(140%) blur(6px);
      background:var(--glass-strong);display:flex;align-items:center;gap:10px;
      padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.08);
    }
    .logo{
      font-family:"UnifrakturMaguntia","Old English Text MT","Cinzel",serif;
      font-size:28px;letter-spacing:2px;line-height:1;color:#fff;text-shadow:2px 2px 0 #000, 0 0 12px rgba(122,198,255,.5);
      margin-right:8px;
    }
    .subtitle{font-size:12px;color:var(--muted)}
    .spacer{flex:1}
    .btn{
      background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);color:#fff;
      padding:8px 12px;border-radius:12px;cursor:pointer;transition:.2s;user-select:none;font-weight:600
    }
    .btn:hover{background:rgba(255,255,255,.12)}
    .btn.primary{background:linear-gradient(180deg,#2aa8ff,#0077ff);border-color:#0077ff;box-shadow:0 6px 16px rgba(0,119,255,.35)}
    .btn.warn{background:linear-gradient(180deg,#ffd023,#ff9f00);border-color:#ff9f00;color:#111}
    .btn.ghost{background:transparent;border-color:rgba(255,255,255,.18)}
    .icon{font-style:normal;margin-right:6px}
    /* Layout */
    .wrap{
      display:grid;grid-template-columns:320px 1fr 360px;gap:12px;
      padding:12px;max-width:1500px;margin:0 auto;
    }
    @media (max-width:1200px){.wrap{grid-template-columns:280px 1fr} .right{display:none}}
    @media (max-width:820px){
      .wrap{grid-template-columns:1fr}
      .left{order:2}.center{order:1}.right{display:none}
      .topbar{flex-wrap:wrap}
    }
    .panel{
      background:var(--glass);border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;
    }
    .panel-header{
      display:flex;align-items:center;gap:10px;padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.06);background:rgba(0,0,0,.25)
    }
    .panel-title{font-weight:800;letter-spacing:.3px}
    .panel-body{padding:10px;max-height:68vh;overflow:auto}
    /* Chat */
    .chat{
      display:flex;flex-direction:column;height:76vh
    }
    .chat-stream{flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:10px}
    .msg{
      max-width:80%;align-self:flex-start;background:rgba(24,26,32,.7);border:1px solid rgba(255,255,255,.08);
      padding:10px 12px;border-radius:14px;box-shadow:0 8px 18px rgba(0,0,0,.25);position:relative
    }
    .msg.me{align-self:flex-end;background:rgba(0,123,255,.16);border-color:rgba(122,198,255,.3)}
    .msg .meta{font-size:12px;color:var(--muted);margin-bottom:6px;display:flex;gap:6px;align-items:center}
    .msg .text{line-height:1.4}
    .msg .img{margin-top:8px;border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,.1)}
    .msg .img img{max-width:280px;display:block}
    .msg .actions{
      margin-top:6px;display:flex;gap:8px;align-items:center;font-size:13px;color:var(--muted)
    }
    .msg .badge{font-size:11px;padding:2px 6px;border-radius:999px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.06)}
    .composer{display:flex;gap:8px;padding:10px;border-top:1px solid rgba(255,255,255,.06);background:rgba(0,0,0,.25)}
    .composer input,.composer textarea{
      flex:1;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.15);border-radius:10px;color:var(--text);
      padding:10px 12px;outline:none;min-height:40px;resize:none
    }
    /* Context menu */
    .ctx{position:fixed;z-index:2000;background:#111;border:1px solid #333;border-radius:12px;padding:6px;display:none;min-width:200px}
    .ctx button{display:flex;width:100%;justify-content:flex-start;gap:10px;background:transparent;border:0;color:#ddd;padding:8px 10px;border-radius:8px;cursor:pointer}
    .ctx button:hover{background:#1b1b1b}
    /* Modals */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(6px);display:none;align-items:center;justify-content:center;z-index:3000}
    .modal .box{width:min(820px,95vw);max-height:86vh;overflow:auto;background:var(--glass-strong);border:1px solid rgba(255,255,255,.18);border-radius:18px;box-shadow:var(--shadow)}
    .modal .head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.1)}
    .modal .close{cursor:pointer;font-size:18px;opacity:.9}
    .grid{display:grid;gap:12px}
    .grid.two{grid-template-columns:1fr 1fr}
    @media (max-width:720px){.grid.two{grid-template-columns:1fr}}
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-size:12px;color:var(--muted)}
    .field input,.field textarea,.select{
      background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.18);border-radius:12px;color:var(--text);padding:10px 12px;outline:none
    }
    .hint{font-size:12px;color:var(--muted)}
    .tag{display:inline-flex;align-items:center;gap:6px;border:1px solid rgba(255,255,255,.16);border-radius:999px;padding:4px 10px;background:rgba(255,255,255,.06);font-size:12px}
    /* Tabs left */
    .nav{display:flex;gap:6px;flex-wrap:wrap}
    .nav .btn{padding:6px 10px}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18)}
    .sep{height:1px;background:rgba(255,255,255,.08);margin:8px 0}
    /* Helpers */
    .hidden{display:none!important}
    .right .panel-body{max-height:76vh}
    .notice{padding:10px 12px;background:rgba(255,255,255,.06);border:1px dashed rgba(255,255,255,.18);border-radius:12px}
    .kbd{font-family:ui-monospace,Menlo,Consolas,monospace;background:#111;border:1px solid #333;border-bottom-width:3px;border-radius:8px;padding:2px 6px;font-size:12px}
  </style>
</head>
<body>
  <div class="overlay"></div>
  <div class="topbar">
    <div class="logo">PRAHA FU≈†KY</div>
    <div class="subtitle">–Ø–∫—â–æ –≤–∏ –≤–ø–µ—Ä—à–µ ‚Äî –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å ¬´–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏¬ª ‚Äî –∑'—è–≤–∏—Ç—å—Å—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è. 6 –≥–æ–¥–∏–Ω –¥–æ—Å—Ç—É–ø—É –±–µ–∑ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è email.</div>
    <div class="spacer"></div>
    <div id="onlinePill" class="pill" title="–ê–∫—Ç–∏–≤ –æ–Ω–ª–∞–π–Ω"><span>üîµ –û–Ω–ª–∞–π–Ω:</span> <b id="onlineCount">0</b></div>
    <button class="btn ghost" id="profileBtn">üë§ –ü—Ä–æ—Ñ—ñ–ª—å</button>
    <button class="btn ghost" id="friendsBtn">üë• –î—Ä—É–∑—ñ</button>
    <button class="btn ghost" id="adminBtn">‚öôÔ∏è –ê–¥–º—ñ–Ω</button>
  </div>

  <div class="wrap">
    <!-- Left: menus -->
    <div class="left panel">
      <div class="panel-header">
        <div class="panel-title">–ú–µ–Ω—é</div>
      </div>
      <div class="panel-body">
        <div class="nav">
          <button class="btn" data-tab="chatMain">üí¨ –ß–∞—Ç</button>
          <button class="btn" data-tab="chatRent">üè† –ß–∞—Ç –û—Ä–µ–Ω–¥–∞</button>
          <button class="btn" data-tab="map">üó∫Ô∏è –ö–∞—Ä—Ç–∞</button>
          <button class="btn" data-tab="help">‚ùì –î–æ–ø–æ–º–æ–≥–∞</button>
        </div>
        <div class="sep"></div>
        <div class="notice">
          <div><b>–§–æ–Ω –ü—Ä–∞–≥–∏</b> + –ª–æ–∫–∞–ª—å–Ω—ñ –ø—ñ–¥–∫–ª–∞–¥–∫–∏ –ø—ñ–¥ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –∫—Ä–∞—â–æ—ó —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ.</div>
          <div class="hint">–ö–Ω–æ–ø–∫–∏ ¬´–ß–∞—Ç / –ö–∞—Ä—Ç–∞ / –î–æ–ø–æ–º–æ–≥–∞¬ª –∑—Ä–æ–±–ª–µ–Ω–æ –∫–Ω–æ–ø–∫–∞–º–∏.</div>
        </div>
        <div class="sep"></div>
        <div class="field">
          <label>–ü–æ—à—É–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–ø–µ—Ä–µ–π—Ç–∏ —É –ø—Ä–æ—Ñ—ñ–ª—å):</label>
          <input id="jumpUser" placeholder="@–Ω—ñ–∫ –∞–±–æ email" />
        </div>
        <div class="sep"></div>
        <div class="field">
          <label>üîë –ö–ª—é—á Google Maps</label>
          <div style="display:flex;gap:8px">
            <input id="mapsKey" placeholder="–í—Å—Ç–∞–≤—Ç–µ –∫–ª—é—á —Ç–∞ –∑–±–µ—Ä–µ–∂—ñ—Ç—å" />
            <button class="btn" id="saveMapsKey">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
          </div>
          <div class="hint">–ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ. –ü–æ—Ç–æ—á–Ω–∏–π –∫–ª—é—á –≤–∂–µ –≤—à–∏—Ç–∏–π —É —Ñ–∞–π–ª.</div>
        </div>
      </div>
    </div>

    <!-- Center: chats / map / help -->
    <div class="center panel">
      <div class="panel-header">
        <div class="panel-title"><span id="tabTitle">üí¨ –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Ç</span></div>
        <div class="spacer"></div>
        <button class="btn" id="assistantOpen">üß† –ü–æ–º—ñ—á–Ω–∏–∫ –ø–æ –ü—Ä–∞–∑—ñ</button>
      </div>
      <div class="panel-body" id="tabContent">
        <!-- Chat Main -->
        <div class="chat" id="chatMain">
          <div class="chat-stream" id="chatMainStream"></div>
          <div class="composer">
            <textarea id="chatMainInput" rows="1" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è‚Ä¶"></textarea>
            <button class="btn primary" id="chatMainSend"><span class="icon">‚û§</span>–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
          </div>
        </div>
        <!-- Chat Rent -->
        <div class="chat hidden" id="chatRent">
          <div class="chat-stream" id="chatRentStream"></div>
          <div class="composer">
            <textarea id="chatRentInput" rows="1" placeholder="–û—Ä–µ–Ω–¥–∞: –∑–∞–ø–∏—Ç —á–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è‚Ä¶"></textarea>
            <button class="btn primary" id="chatRentSend"><span class="icon">‚û§</span>–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
          </div>
        </div>
        <!-- Map -->
        <div id="mapTab" class="hidden">
          <div class="notice" style="margin-bottom:10px">
            <b>–ö–∞—Ä—Ç–∞ –ü—Ä–∞–≥–∏</b>. –ö–ª—ñ–∫–Ω—ñ—Ç—å –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ—á–∫–∏. –Ü–∫–æ–Ω–∫–∏ ‚Äî –≤–ª–∞—Å–Ω—ñ.
          </div>
          <div id="map" style="height:60vh;border-radius:14px;border:1px solid rgba(255,255,255,.2);overflow:hidden"></div>
        </div>
        <!-- Help -->
        <div id="helpTab" class="hidden">
          <div class="notice">
            <b>–î–æ–≤—ñ–¥–∫–∞:</b> —Ç—É—Ç –∑—ñ–±—Ä–∞–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø–æ —Å–∞–π—Ç—É. –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏ –≤—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è <i>–ü–æ–º—ñ—á–Ω–∏–∫ –ø–æ –ü—Ä–∞–∑—ñ</i> ‚Äî –∑–∞–¥–∞–≤–∞–π—Ç–µ –ø–∏—Ç–∞–Ω–Ω—è.
          </div>
          <ul>
            <li>–õ—ñ–º—ñ—Ç–∏: 100 —Ñ–æ—Ç–æ / 200 —Ç–µ–∫—Å—Ç—ñ–≤ ‚Äî –ø–æ—Ç—ñ–º –∑‚Äô—è–≤–ª—è—î—Ç—å—Å—è –≤—ñ–∫–Ω–æ –æ–ø–ª–∞—Ç–∏ —Ç–∞ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è.</li>
            <li>–í–∏–¥–∞–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å: –∑–∞—Ç–∏—Å–Ω—ñ—Ç—å (–¥–æ–≤–≥–∏–π —Ç–∞–ø) –ø–æ SMS, –æ–±–µ—Ä—ñ—Ç—å ¬´–í–∏–¥–∞–ª–∏—Ç–∏¬ª.</li>
            <li>–†–µ–∞–∫—Ü—ñ—ó: üëç üëé ‚ö†Ô∏è üö´ ‚úÖ ‚Äî –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —Ç–∞ –ø—ñ–¥—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è.</li>
            <li>–î—Ä—É–∑—ñ / –õ–°: –∑–≤–µ—Ä—Ö—É –∑–ª—ñ–≤–∞ <span class="kbd">–ü—Ä–æ—Ñ—ñ–ª—å</span> ‚Üí –∑–∞–ø–∏—Ç–∏, –æ–Ω–ª–∞–π–Ω, –õ–° –∑ —ñ—Å—Ç–æ—Ä—ñ—î—é. –£ –õ–° –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è <b>–Ω—ñ–∫</b>, –Ω–µ –∫–ª—é—á.</li>
            <li>–ë–æ—Ç–∏: 3 –±–æ—Ç–∏ –∑ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏ 2 / 3 / 4 —Ö–≤. –í–º–∏–∫–∞–π—Ç–µ –≤ –∞–¥–º—ñ–Ω—Ü—ñ.</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Right: bots / notices -->
    <div class="right panel">
      <div class="panel-header"><div class="panel-title">ü§ñ –ë–æ—Ç–∏</div></div>
      <div class="panel-body">
        <div class="field">
          <label>–°—Ç–∞—Ç—É—Å</label>
          <div class="tag" id="botsStatus">üü° –ó—É–ø–∏–Ω–µ–Ω—ñ</div>
        </div>
        <div class="grid two" style="margin-top:10px">
          <button class="btn primary" id="botsStart">–°—Ç–∞—Ä—Ç –±–æ—Ç—ñ–≤</button>
          <button class="btn" id="botsStop">–°—Ç–æ–ø</button>
        </div>
        <div class="sep"></div>
        <div class="field">
          <label>–ö–∞–Ω–∞–ª –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó</label>
          <select id="botsChannel" class="select">
            <option value="chatMain">–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Ç</option>
            <option value="chatRent">–ß–∞—Ç –û—Ä–µ–Ω–¥–∞</option>
          </select>
          <div class="hint">–ë–æ—Ç–∏ –ø–æ—Å—Ç—è—Ç—å –ø–æ –∫–æ–ª—É –≤ –æ–±—Ä–∞–Ω–∏–π —á–∞—Ç.</div>
        </div>
        <div class="sep"></div>
        <div class="notice">
          –Ü–Ω—Ç–µ—Ä–≤–∞–ª–∏: <b>2 —Ö–≤</b>, <b>3 —Ö–≤</b>, <b>4 —Ö–≤</b>. –ö–æ–Ω—Ç–µ–Ω—Ç ‚Äî –∑ —Ç–≤–æ–≥–æ –ª–∏—Å—Ç–∞ (—Ñ–æ—Ç–æ + —Ç–µ–∫—Å—Ç).
        </div>
      </div>
    </div>
  </div>

  <!-- Context menu -->
  <div class="ctx" id="ctxMenu">
    <button data-act="reply">‚Ü©Ô∏è –í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏</button>
    <button data-act="like">üëç –õ–∞–π–∫</button>
    <button data-act="dislike">üëé –î–∏–∑–ª–∞–π–∫</button>
    <button data-act="warn">‚ö†Ô∏è –û—Å—Ç–æ—Ä–æ–∂–Ω–æ –º–æ—à–µ–Ω–Ω–∏–∫</button>
    <button data-act="spam">üö´ –°–ø–∞–º</button>
    <button data-act="verify">‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∏–π —Ä–æ–±–æ—Ç–æ–¥–∞–≤–µ—Ü—å</button>
    <button data-act="delete" style="color:#ff8a8a">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
    <button data-act="dm">üí¨ –ù–∞–ø–∏—Å–∞—Ç–∏ –≤ –õ–°</button>
    <button data-act="profile">üë§ –í—ñ–¥–∫—Ä–∏—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</button>
  </div>

  <!-- Profile modal -->
  <div class="modal" id="profileModal">
    <div class="box">
      <div class="head">
        <div><b>–ü—Ä–æ—Ñ—ñ–ª—å</b></div>
        <div class="close" data-close="#profileModal">‚úñ</div>
      </div>
      <div class="panel-body">
        <div class="grid two">
          <div class="field">
            <label>–ù—ñ–∫–Ω–µ–π–º</label>
            <input id="profNick" placeholder="@prague_user" />
          </div>
          <div class="field">
            <label>Email</label>
            <input id="profEmail" placeholder="you@email.com" />
          </div>
          <div class="field">
            <label>–ê–≤–∞—Ç–∞—Ä (URL)</label>
            <input id="profAvatar" placeholder="https://..." />
            <div class="hint">–§–æ—Ç–æ —á–µ—Ä–µ–∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è (Firebase Storage –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è).</div>
          </div>
          <div class="field">
            <label>–ü—Ä–æ —Å–µ–±–µ</label>
            <textarea id="profAbout" rows="3" placeholder="–ö–æ—Ä–æ—Ç–∫–æ –ø—Ä–æ —Å–µ–±–µ‚Ä¶"></textarea>
          </div>
        </div>
        <div class="sep"></div>
        <div class="grid two">
          <button class="btn primary" id="saveProfile">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
          <button class="btn" id="logout">–í–∏–π—Ç–∏</button>
        </div>
        <div class="sep"></div>
        <div class="panel">
          <div class="panel-header"><div class="panel-title">üì• –û—Å–æ–±–∏—Å—Ç—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</div></div>
          <div class="panel-body">
            <div id="dmThreads" class="notice">–¢—É—Ç –∑'—è–≤–ª—è—Ç—å—Å—è –≤–∞—à—ñ –¥—ñ–∞–ª–æ–≥–∏.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Friends modal -->
  <div class="modal" id="friendsModal">
    <div class="box">
      <div class="head">
        <div><b>–î—Ä—É–∑—ñ</b></div>
        <div class="close" data-close="#friendsModal">‚úñ</div>
      </div>
      <div class="panel-body">
        <div class="grid two">
          <div class="panel">
            <div class="panel-header"><div class="panel-title">–ó–∞—è–≤–∫–∏</div></div>
            <div class="panel-body" id="friendRequests"></div>
          </div>
          <div class="panel">
            <div class="panel-header"><div class="panel-title">–î—Ä—É–∑—ñ <span id="friendsOnlineCount" class="tag">–æ–Ω–ª–∞–π–Ω: 0</span></div></div>
            <div class="panel-body" id="friendsList"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin modal -->
  <div class="modal" id="adminModal">
    <div class="box">
      <div class="head">
        <div><b>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</b></div>
        <div class="close" data-close="#adminModal">‚úñ</div>
      </div>
      <div class="panel-body">
        <div class="grid two">
          <div class="panel">
            <div class="panel-header"><div class="panel-title">–ü—ñ–¥–ø–∏—Å–∫–∏ / –ü–ª—é—à–∫–∏</div></div>
            <div class="panel-body">
              <div class="field">
                <label>Email –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</label>
                <input id="subEmail" placeholder="user@email.com" />
              </div>
              <div class="grid two">
                <button class="btn primary" id="grantSub">–í–∏–¥–∞—Ç–∏ –ø—ñ–¥–ø–∏—Å–∫—É (199 Kƒç)</button>
                <button class="btn" id="revokeSub">–ó–Ω—è—Ç–∏ –ø—ñ–¥–ø–∏—Å–∫—É</button>
              </div>
              <div class="sep"></div>
              <div class="field">
                <label>–ú–Ω–æ–∂–Ω–∏–∫ –æ–Ω–ª–∞–π–Ω-–ª—ñ—á–∏–ª—å–Ω–∏–∫–∞</label>
                <input id="onlineMultiplier" type="number" value="10" />
                <div class="hint">–í –∞–¥–º—ñ–Ω—Ü—ñ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ √ó10 –Ω–∞ —ñ–Ω—à–µ –∑–Ω–∞—á–µ–Ω–Ω—è.</div>
              </div>
            </div>
          </div>
          <div class="panel">
            <div class="panel-header"><div class="panel-title">–ë–æ—Ç–∏</div></div>
            <div class="panel-body">
              <div class="hint">–Ü–Ω—Ç–µ—Ä–≤–∞–ª–∏: 120/180/240 —Å–µ–∫. –ö–æ–Ω—Ç–µ–Ω—Ç ‚Äî –∑–Ω–∏–∑—É.</div>
              <div class="grid two" style="margin:8px 0">
                <button class="btn primary" id="adminBotsStart">–°—Ç–∞—Ä—Ç</button>
                <button class="btn" id="adminBotsStop">–°—Ç–æ–ø</button>
              </div>
              <div class="sep"></div>
              <div class="notice" style="font-size:12px">
                <b>–†–µ–∫–ª–∞–º–∞:</b> urciknikolaj642@gmail.com ‚Äî –¥–ª—è –∫—É–ø—ñ–≤–ª—ñ —Ä–µ–∫–ª–∞–º–∏.
              </div>
            </div>
          </div>
        </div>
        <div class="sep"></div>
        <div class="panel">
          <div class="panel-header"><div class="panel-title">–ö–æ–Ω—Ç–µ–Ω—Ç –±–æ—Ç—ñ–≤ (—Ä–µ–¥–∞–≥–æ–≤–∞–Ω–∏–π)</div></div>
          <div class="panel-body">
            <textarea id="botsConfig" rows="10" style="width:100%;min-height:160px"></textarea>
            <div class="grid two" style="margin-top:10px">
              <button class="btn" id="loadBotsCfg">–°–∫–∏–Ω—É—Ç–∏ (–¥–µ—Ñ.)</button>
              <button class="btn primary" id="saveBotsCfg">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Assistant modal -->
  <div class="modal" id="assistantModal">
    <div class="box">
      <div class="head">
        <div><b>üß† –ü–æ–º—ñ—á–Ω–∏–∫ –ø–æ –ü—Ä–∞–∑—ñ</b> <span id="asstQuota" class="tag">30 –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏—Ö</span></div>
        <div class="close" data-close="#assistantModal">‚úñ</div>
      </div>
      <div class="panel-body">
        <div id="assistantStream" class="chat-stream" style="height:45vh"></div>
        <div class="composer">
          <textarea id="assistantInput" rows="1" placeholder="–ü–æ—Å—Ç–∞–≤—Ç–µ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ —Ä–æ–±–æ—Ç—É, –∂–∏—Ç–ª–æ, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç‚Ä¶"></textarea>
          <button class="btn primary" id="assistantSend">‚û§ –ü–∏—Ç–∞—Ç–∏</button>
        </div>
        <div class="hint">–ü—ñ—Å–ª—è 30 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø–æ—Ç—Ä—ñ–±–Ω–∞ –ø—ñ–¥–ø–∏—Å–∫–∞ 199 Kƒç/–º—ñ—Å –Ω–∞ —Å–∞–π—Ç (—É—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó).</div>
      </div>
    </div>
  </div>

  <!-- Firebase + App -->
  <script type="module">
    /************** Firebase SDK (v10) **************/
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-analytics.js";
    import { getAuth, onAuthStateChanged, signInAnonymously, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getDatabase, ref, onValue, push, set, update, remove, serverTimestamp, child, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDw_bVibsVyZegH7OJyZ_yRjI3uLhroVBk",
      authDomain: "praga-4baee.firebaseapp.com",
      databaseURL: "https://praga-4baee-default-rtdb.firebaseio.com",
      projectId: "praga-4baee",
      storageBucket: "praga-4baee.appspot.com",
      messagingSenderId: "336023952536",
      appId: "1:336023952536:web:f7437feaa25b6eadcd04ed",
      measurementId: "G-BGDJD6R12N"
    };
    const app = initializeApp(firebaseConfig);
    try { getAnalytics(app); } catch(e){ /* ignore local */ }
    const auth = getAuth(app);
    const db   = getDatabase(app);

    /************** State **************/
    let currentTab = "chatMain";
    let me = { uid:null, email:null, nick:null, avatar:null, about:null, sub:false };
    let onlineMultiplier = 10;

    // DOM helpers
    const $ = s => document.querySelector(s);
    const $$ = s => [...document.querySelectorAll(s)];
    const ctx = $("#ctxMenu");
    let ctxTarget = null;

    // Tabs
    $$(".left .btn[data-tab]").forEach(b=>b.addEventListener("click",()=>switchTab(b.dataset.tab)));
    function switchTab(id){
      $$("#tabContent > *").forEach(n=>n.classList.add("hidden"));
      $("#"+id).classList.remove("hidden");
      currentTab = id;
      $("#tabTitle").textContent = {
        chatMain:"üí¨ –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Ç",
        chatRent:"üè† –ß–∞—Ç –û—Ä–µ–Ω–¥–∞",
        map:"üó∫Ô∏è –ö–∞—Ä—Ç–∞",
        help:"‚ùì –î–æ–≤—ñ–¥–∫–∞",
      }[id] || "üí¨ –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Ç";
      // auto-open assistant after 3s on Help
      if(id==="help"){
        setTimeout(()=> openModal("#assistantModal"), 3000);
      }
      if(id==="map"){
        setTimeout(initMap, 300);
      }
    }

    /************** Auth **************/
    onAuthStateChanged(auth, async(user)=>{
      if(!user){
        await signInAnonymously(auth);
        return;
      }
      me.uid = user.uid;
      me.email = user.email || null;
      // Load profile from DB
      const p = await get(ref(db, "profiles/"+me.uid));
      if(p.exists()){
        Object.assign(me, p.val());
      } else {
        me.nick = me.nick || ("@guest"+me.uid.slice(0,5));
        await set(ref(db, "profiles/"+me.uid), {nick:me.nick, avatar:me.avatar||"", about:me.about||"", email:me.email||"", sub:false, online:true});
      }
      $("#profNick").value = me.nick || "";
      $("#profEmail").value = me.email || "";
      $("#profAvatar").value= me.avatar || "";
      $("#profAbout").value = me.about || "";
      // Presence (very simple)
      const presenceRef = ref(db, "presence/"+me.uid);
      set(presenceRef, {online:true, ts: Date.now()});
      // Listen online count
      onValue(ref(db,"presence"), snap=>{
        const v = snap.val()||{};
        const real = Object.values(v).filter(x=>x&&x.online).length;
        $("#onlineCount").textContent = real * onlineMultiplier;
      });
      // Friends / requests
      listenFriends();
      // Chats
      listenChat("chatMain");
      listenChat("chatRent");
      // DMs threads
      listDMThreads();
    });

    $("#logout").onclick = ()=> signOut(auth);

    $("#saveProfile").onclick = async()=>{
      me.nick = $("#profNick").value.trim() || me.nick;
      me.email= $("#profEmail").value.trim() || me.email;
      me.avatar=$("#profAvatar").value.trim()|| "";
      me.about =$("#profAbout").value.trim()|| "";
      await update(ref(db,"profiles/"+me.uid), {nick:me.nick, email:me.email, avatar:me.avatar, about:me.about});
      closeModal("#profileModal");
    };

    /************** Chat **************/
    function listenChat(ch){
      const stream = $("#"+ch+"Stream");
      onValue(ref(db,"chats/"+ch), snap=>{
        stream.innerHTML="";
        const v=snap.val()||{};
        Object.entries(v).sort((a,b)=> (a[1].ts||0)-(b[1].ts||0)).forEach(([id,m])=>{
          stream.appendChild(renderMsg(id,m));
        });
        stream.scrollTop = stream.scrollHeight;
      });
    }

    function sendMsg(ch, text, img){
      const id = push(ref(db,"chats/"+ch)).key;
      const msg = {
        uid: me.uid, nick: me.nick, avatar: me.avatar||"",
        text: text || "", img: img||"", ts: Date.now(), reactions:{}
      };
      set(ref(db, "chats/"+ch+"/"+id), msg);
    }

    $("#chatMainSend").onclick = ()=>{
      const t = $("#chatMainInput").value.trim();
      if(!t) return;
      $("#chatMainInput").value="";
      sendMsg("chatMain", t);
    };
    $("#chatRentSend").onclick = ()=>{
      const t = $("#chatRentInput").value.trim();
      if(!t) return;
      $("#chatRentInput").value="";
      sendMsg("chatRent", t);
    };

    function renderMsg(id,m){
      const el = document.createElement("div");
      el.className = "msg"+(m.uid===me.uid?" me":"");
      el.dataset.id = id;
      el.innerHTML = `
        <div class="meta">
          <img src="${m.avatar||'https://i.pravatar.cc/24'}" onerror="this.src='https://i.pravatar.cc/24'" style="width:18px;height:18px;border-radius:50%;border:1px solid rgba(255,255,255,.2)">
          <b>${escapeHtml(m.nick||"@user")}</b>
          <span>¬∑</span>
          <span>${timeAgo(m.ts||Date.now())}</span>
        </div>
        <div class="text">${linkify(escapeHtml(m.text||""))}</div>
        ${m.img ? `<div class="img"><img src="${m.img}"></div>`:""}
        <div class="actions">
          ${renderReactions(m.reactions||{})}
        </div>
      `;
      // context handlers
      const showCtx = (e)=>{
        e.preventDefault();
        ctxTarget = {id, m};
        ctx.style.left = e.pageX+"px";
        ctx.style.top  = e.pageY+"px";
        ctx.style.display = "block";
      };
      el.addEventListener("contextmenu", showCtx);
      el.addEventListener("touchstart", (e)=>{
        let hold = setTimeout(()=> showCtx(e.touches[0]||e), 500);
        const cancel=()=>{ clearTimeout(hold)};
        el.addEventListener("touchend", cancel, {once:true});
        el.addEventListener("touchmove", cancel, {once:true});
      });
      return el;
    }

    function renderReactions(map){
      const counts = {like:0,dislike:0,warn:0,spam:0,verify:0};
      Object.values(map).forEach(v=>{ if(counts[v]!=null) counts[v]++ });
      const pill = (emoji,label,count)=> `<span class="badge">${emoji} ${count||""}</span>`;
      return [pill("üëç","like",counts.like), pill("üëé","dislike",counts.dislike), pill("‚ö†Ô∏è","warn",counts.warn), pill("üö´","spam",counts.spam), pill("‚úÖ","verify",counts.verify)].join(" ");
    }

    document.body.addEventListener("click", (e)=>{
      if(!e.target.closest("#ctxMenu")) ctx.style.display="none";
    });
    $("#ctxMenu").addEventListener("click", (e)=>{
      const btn = e.target.closest("button"); if(!btn||!ctxTarget) return;
      const act = btn.dataset.act;
      const {id, m} = ctxTarget;
      ctx.style.display="none";
      const ch = currentTab==="chatRent"?"chatRent":"chatMain";
      if(act==="delete"){
        if(m.uid===me.uid || isAdmin(me)){
          remove(ref(db,"chats/"+ch+"/"+id));
        } else alert("–í–∏–¥–∞–ª–∏—Ç–∏ –º–æ–∂–µ —Ç—ñ–ª—å–∫–∏ –∞–≤—Ç–æ—Ä –∞–±–æ –∞–¥–º—ñ–Ω");
      } else if(["like","dislike","warn","spam","verify"].includes(act)){
        set(ref(db,"chats/"+ch+"/"+id+"/reactions/"+me.uid), act);
      } else if(act==="reply"){
        const input = ch==="chatRent"?$("#chatRentInput"):$("#chatMainInput");
        input.value = `‚Ü™Ô∏è @${m.nick||"user"}: `+input.value;
        input.focus();
      } else if(act==="dm"){
        openDMWith(m.uid, m.nick||"@user");
      } else if(act==="profile"){
        openProfileOf(m.uid);
      }
    });

    function isAdmin(u){ return (u.email||"").endsWith("@admin.com"); }

    /************** Friends & DMs **************/
    function listenFriends(){
      onValue(ref(db,"friends/"+me.uid+"/list"), snap=>{
        const v=snap.val()||{}; const wrap=$("#friendsList"); wrap.innerHTML="";
        let online=0;
        Object.entries(v).forEach(([uid,info])=>{
          const item=document.createElement("div");
          item.className="notice";
          item.innerHTML=`<div style="display:flex;gap:10px;align-items:center">
            <img src="${(info&&info.avatar)||'https://i.pravatar.cc/32'}" style="width:28px;height:28px;border-radius:50%">
            <div style="flex:1">
              <div><b>${escapeHtml((info&&info.nick)||"@user")}</b> ${info&&info.online?'üü¢':''}</div>
              <div class="hint">${escapeHtml((info&&info.about)||"")}</div>
            </div>
            <button class="btn" data-dm="${uid}">–õ–°</button>
          </div>`;
          if(info&&info.online) online++;
          wrap.appendChild(item);
        });
        $("#friendsOnlineCount").textContent = "–æ–Ω–ª–∞–π–Ω: "+online;
        wrap.querySelectorAll("button[data-dm]").forEach(b=> b.onclick = ()=> openDMWith(b.dataset.dm));
      });
      onValue(ref(db,"friends/"+me.uid+"/requests"), snap=>{
        const v=snap.val()||{}; const wrap=$("#friendRequests"); wrap.innerHTML="";
        Object.entries(v).forEach(([uid,info])=>{
          const item=document.createElement("div");
          item.className="notice";
          item.innerHTML=`<div style="display:flex;gap:10px;align-items:center">
            <img src="${(info&&info.avatar)||'https://i.pravatar.cc/32'}" style="width:28px;height:28px;border-radius:50%">
            <div style="flex:1"><b>${escapeHtml((info&&info.nick)||"@user")}</b> —Ö–æ—á–µ –¥—Ä—É–∂–∏—Ç–∏</div>
            <button class="btn primary" data-acc="${uid}">–ü—Ä–∏–π–Ω—è—Ç–∏</button>
          </div>`;
          wrap.appendChild(item);
        });
        wrap.querySelectorAll("button[data-acc]").forEach(b=> b.onclick = ()=> acceptFriend(b.dataset.acc));
      });
    }
    async function acceptFriend(uid){
      const up = {};
      const a = await get(ref(db,"profiles/"+uid));
      const b = await get(ref(db,"profiles/"+me.uid));
      if(a.exists()) up["friends/"+me.uid+"/list/"+uid]=a.val();
      if(b.exists()) up["friends/"+uid+"/list/"+me.uid]=b.val();
      up["friends/"+me.uid+"/requests/"+uid]=null;
      await update(ref(db), up);
    }
    function openDMWith(uid, nick){
      // Create thread id by sorted pair to keep same thread
      const tid = dmThreadId(me.uid, uid);
      // Open modal with messages
      openModal("#profileModal");
      const box = $("#dmThreads");
      box.innerHTML = `<div class="chat">
        <div class="chat-stream" id="dmStream"></div>
        <div class="composer">
          <textarea id="dmInput" rows="1" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è‚Ä¶"></textarea>
          <button class="btn primary" id="dmSend">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
        </div>
      </div>`;
      const stream = $("#dmStream");
      onValue(ref(db,"dm/"+tid), snap=>{
        stream.innerHTML="";
        const v=snap.val()||{};
        Object.entries(v).sort((a,b)=> (a[1].ts||0)-(b[1].ts||0)).forEach(([id,m])=>{
          const el=renderMsg(id,m);
          // Replace key with nick
          el.querySelector(".meta b").textContent = m.nick||m.uid;
          stream.appendChild(el);
        });
        stream.scrollTop = stream.scrollHeight;
      });
      $("#dmSend").onclick = ()=>{
        const t=$("#dmInput").value.trim(); if(!t) return;
        $("#dmInput").value="";
        const id = push(ref(db,"dm/"+tid)).key;
        set(ref(db,"dm/"+tid+"/"+id), {uid:me.uid, nick:me.nick, avatar:me.avatar||"", text:t, ts:Date.now(), reactions:{}});
      };
    }
    function dmThreadId(a,b){ return [a,b].sort().join("_"); }
    function openProfileOf(uid){
      openModal("#profileModal");
      // In a real app, load user card, allow add friend, open DM, etc.
    }
    async function listDMThreads(){
      // Light placeholder: show last threads for me (by scanning dm index if present)
      // Optional index not implemented for brevity
    }

    /************** Context helpers **************/
    function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])) }
    function linkify(s){ return s.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>') }
    function timeAgo(ts){
      const d = Math.max(1, Math.floor((Date.now()-ts)/1000));
      if(d<60) return d+"—Å";
      if(d<3600) return Math.floor(d/60)+"—Ö–≤";
      if(d<86400) return Math.floor(d/3600)+"–≥";
      return Math.floor(d/86400)+"–¥";
    }

    /************** Modals **************/
    $("#profileBtn").onclick = ()=> openModal("#profileModal");
    $("#friendsBtn").onclick = ()=> openModal("#friendsModal");
    $("#adminBtn").onclick = ()=> openModal("#adminModal");
    $("#assistantOpen").onclick = ()=> openModal("#assistantModal");

    function openModal(sel){ const m=$(sel); m.style.display="flex"; }
    function closeModal(sel){ const m=$(sel); m.style.display="none"; }
    $$("[data-close]").forEach(x=> x.onclick = ()=> closeModal(x.dataset.close));

    /************** Bots **************/
    const defaultBots = {
      channels:["chatMain","chatRent"],
      items:[
        // Bot 1: O2 SIM + iPhone + image with text
        {interval:120000, posts:[
          {text:"O2 –°I–ú –ö–ê–†–¢–ê\n–ë–µ–∑ –ªi–ºi—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç\n–ë–µ–∑ –ªi–ºi—Ç –∑–≤i–Ω–∫–∏\n–ü—Äa—Ü—é–µ –≤ –ï–≤—Ä–æ–øi\n–ø–ª–∞—Ç–∞ 699 –∫—Ä–æ–Ω/–º—ñ—Å. –¶i–Ω–∞ 299 –∫—Å. —Ç–µ–ª 607914467. Viber/WhatsApp/Telegram.", img:"https://i.ibb.co/LH4wBMS/IMG-d8e6076e17f19db7fe3add0754738a01-V.jpg"},
          {text:"–ü—Ä–æ–¥–∞—é iPhone 11 Pro Max + 26 —á–æ—Ö–ª—ñ–≤ —É –ø–æ–¥–∞—Ä—É–Ω–æ–∫. –í—Å–µ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ, –Ω–µ –ø–∞–¥–∞–≤, –±–µ–∑ Apple ID. –ü–∏—à—ñ—Ç—å —É –õ–° ‚Äî –≤—ñ–¥–ø–æ–≤—ñ–º —ñ–∑ –∑–∞–¥–æ–≤–æ–ª–µ–Ω–Ω—è–º!", img:"https://i.ibb.co/dwcXPqDr/IMG-1954f6b56869b9817a131ae33f3a37b6-V.jpg"},
          {text:"–û–≥–æ–ª–æ—à–µ–Ω–Ω—è –∑ —Ñ–æ—Ç–æ (—Ç–µ–∫—Å—Ç –Ω–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—ñ).", img:"https://i.ibb.co/G3kDcrYZ/IMG-fa590121e46c5b030c5ddc94d4e8bea9-V.jpg"}
        ]},
        // Bot 2: PM models
        {interval:180000, posts:[
          {text:"–®–∞–±–ª–æ–Ω: –ø–æ—Å–ª—É–≥–∏ ‚Äî –¥–µ—Ç–∞–ª—ñ –≤ –õ–°.", img:"https://i.ibb.co/Z11WVrVC/IMG-b83692bb79a1468af74c81620750e8c0-V.jpg"},
          {text:"–ó–∞–ø—Ä–æ—à—É—é –º–æ–¥–µ–ª–µ–π –Ω–∞ –ø–µ—Ä–º–∞–Ω–µ–Ω—Ç–Ω–∏–π –º–∞–∫—ñ—è–∂ –≤—ñ–¥ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ–≥–æ –º–∞–π—Å—Ç—Ä–∞ –ø—ñ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º ‚ú®\n‚Ä¢ –ì—É–±–∏ (–¥–æ–∑–≤—ñ–ª –Ω–∞ –≤—ñ–¥–µ–æ/—Ñ–æ—Ç–æ)\nüî∏ –û–ø–ª–∞—Ç–∞ ‚Äî –ª–∏—à–µ –º–∞—Ç–µ—Ä—ñ–∞–ª\nüìç–ü—Ä–∞–≥–∞, üìÖ 28.07 14:00\n–î–ª—è –¥–µ—Ç–∞–ª–µ–π ‚Äî –≤ –æ—Å–æ–±–∏—Å—Ç—ñ ü´∂üèª\n–Ü–¥–µ–∞–ª—å–Ω–æ, —è–∫—â–æ –º—Ä—ñ—è–ª–∏ –ø—Ä–æ –ü–ú –∑–∞ –º—ñ–Ω—ñ–º—É–º.\n–§–æ—Ç–æ/–∑–∞–ø–∏—Å ‚Äî —É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è üíå", img:"https://i.ibb.co/QFWDvGZ8/IMG-6748e7141906901b131b8fd5130a5c01-V.jpg"},
          {text:"–ê–∫—Ç—É–∞–ª—å–Ω–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è (–¥–∏–≤. —Ñ–æ—Ç–æ).", img:"https://i.ibb.co/j97RhTny/IMG-593d75b053ea1a28cdfb9fc52f93afad-V.jpg"}
        ]},
        // Bot 3: driver + images
        {interval:240000, posts:[
          {text:"–ù—É–∂–µ–Ω –≤–æ–¥–∏—Ç–µ–ª—å –¥–ª—è –ø–æ–º–æ—â–∏ –≤ –ø–µ—Ä–µ–µ–∑–¥–µ, —Å–æ —Å–≤–æ–∏–º –∞–≤—Ç–æ. –ü–∏—à–∏—Ç–µ ‚Äî –æ–±—Å—É–¥–∏–º –¥–µ—Ç–∞–ª–∏. WhatsApp: +48 793 463 757 ‚Ä¢ Telegram: @carlx_xxx"},
          {text:"–û–≥–æ–ª–æ—à–µ–Ω–Ω—è –∑ —Ñ–æ—Ç–æ.", img:"https://i.ibb.co/MzdTMPR/IMG-8231d8142ffcbba7c682ca598683e3f2-V.jpg"},
          {text:"–û–≥–æ–ª–æ—à–µ–Ω–Ω—è –∑ —Ñ–æ—Ç–æ.", img:"https://i.ibb.co/rfNV6ddC/IMG-0cd648a74f86227fe46db2d01c099be0-V.jpg"}
        ]}
      ]
    };
    const botsCfgEl = $("#botsConfig");
    $("#loadBotsCfg").onclick = ()=> botsCfgEl.value = JSON.stringify(defaultBots, null, 2);
    $("#saveBotsCfg").onclick = ()=> localStorage.botsCfg = botsCfgEl.value;
    (function initBotsCfg(){
      botsCfgEl.value = localStorage.botsCfg || JSON.stringify(defaultBots, null, 2);
    })();

    let botTimers = [];
    function startBots(){
      const cfg = JSON.parse(botsCfgEl.value || "{}");
      const channel = $("#botsChannel").value;
      $("#botsStatus").textContent = "üü¢ –ü—Ä–∞—Ü—é—é—Ç—å ‚Üí "+(channel==="chatRent"?"–ß–∞—Ç –û—Ä–µ–Ω–¥–∞":"–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Ç");
      (cfg.items||[]).forEach((b,i)=>{
        let idx=0;
        const tick = ()=>{
          const post = b.posts[idx % b.posts.length];
          sendMsg(channel, "[BOT] "+(post.text||""), post.img||"");
          idx++;
        };
        tick();
        botTimers[i] = setInterval(tick, Math.max(60000, b.interval||180000));
      });
    }
    function stopBots(){
      botTimers.forEach(t=> clearInterval(t));
      botTimers=[]; $("#botsStatus").textContent="üü° –ó—É–ø–∏–Ω–µ–Ω—ñ";
    }
    $("#botsStart").onclick = startBots;
    $("#botsStop").onclick = stopBots;
    $("#adminBotsStart").onclick = startBots;
    $("#adminBotsStop").onclick = stopBots;

    /************** Assistant (offline Q/A + quota) **************/
    const assistantKB = [
      {q:/\b(—Ä–æ–±–æ—Ç–∞|–≤–∞–∫–∞–Ω—Å|—Ñ—É—à–∫–∏|fu≈°ky)\b/i, a:"–†–æ–±–æ—Ç–∞: –ø–∏—à—ñ—Ç—å –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –≤ –∑–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Ç. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ä–µ–∞–∫—Ü—ñ—é ‚úÖ –¥–ª—è –ø–æ–∑–Ω–∞—á–µ–Ω–Ω—è ¬´–ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∏–π —Ä–æ–±–æ—Ç–æ–¥–∞–≤–µ—Ü—å¬ª. –ó–∞ –ø—ñ–¥–æ–∑—Ä–∏ —Å—Ç–∞–≤—Ç–µ ‚ö†Ô∏è –∞–±–æ üö´."},
      {q:/\b(–æ—Ä–µ–Ω–¥–∞|–∫–≤–∞—Ä—Ç–∏—Ä–∞|–∂–∏—Ç–ª–æ)\b/i, a:"–û—Ä–µ–Ω–¥–∞: –æ–∫—Ä–µ–º–∞ –≤–∫–ª–∞–¥–∫–∞ ¬´–ß–∞—Ç –û—Ä–µ–Ω–¥–∞¬ª. –î–æ–¥–∞–≤–∞–π—Ç–µ —Ä–∞–π–æ–Ω, —Ü—ñ–Ω—É, —Ñ–æ—Ç–æ, –∫–æ–Ω—Ç–∞–∫—Ç–∏. –û–±–µ—Ä–µ–∂–Ω–æ –∑ –ø–µ—Ä–µ–¥–ø–ª–∞—Ç–∞–º–∏ ‚Äî –≤–∏–º–∞–≥–∞–π—Ç–µ –¥–æ–≥–æ–≤—ñ—Ä."},
      {q:/\b(–¥—Ä—É–∑(—ñ|—å—è)|friend|–∑–∞—è–≤–∫)\b/i, a:"–î—Ä—É–∑—ñ: —É –º–æ–¥–∞–ª—ñ ¬´–î—Ä—É–∑—ñ¬ª ‚Äî –∑–∞—è–≤–∫–∏ –π —Å–ø–∏—Å–æ–∫ –æ–Ω–ª–∞–π–Ω. –£ –ø—Ä–æ—Ñ—ñ–ª—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ –õ–° –∑ —ñ—Å—Ç–æ—Ä—ñ—î—é —Ç–∞ –ø—Ä–µ–≤‚Äô—é."},
      {q:/\b(–∫–∞—Ä—Ç–∞|map|–∞–¥—Ä–µ—Å–∞)\b/i, a:"–ö–∞—Ä—Ç–∞: —É –≤–∫–ª–∞–¥—Ü—ñ ¬´–ö–∞—Ä—Ç–∞¬ª. –ö–ª—é—á –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π, —ñ–∫–æ–Ω–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ, –∫–ª—ñ–∫–æ–º –¥–æ–¥–∞—î—Ç–µ —Ç–æ—á–∫—É."},
      {q:/\b(–±–æ—Ç|–∞–≤—Ç–æ–ø–æ—Å—Ç|—Ä–æ–∑–∫–ª–∞–¥|—ñ–Ω—Ç–µ—Ä–≤–∞–ª)\b/i, a:"3 –±–æ—Ç–∏ –ø–æ—Å—Ç—è—Ç—å –∑ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏ 2/3/4 —Ö–≤. –ö–µ—Ä—É–≤–∞–Ω–Ω—è –≤ –ø—Ä–∞–≤—ñ–π –ø–∞–Ω–µ–ª—ñ –∞–±–æ –≤ –∞–¥–º—ñ–Ω—Ü—ñ. –ö–æ–Ω—Ç–µ–Ω—Ç ‚Äî —Ä–µ–¥–∞–≥–æ–≤–∞–Ω–∏–π JSON."},
      {q:/\b(–ø—ñ–¥–ø–∏—Å–∫|–ø–ª—é—à–∫|199)\b/i, a:"–ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–∞–π—Ç ‚Äî 199 Kƒç/–º—ñ—Å: –∑–Ω—ñ–º–∞—î –æ–±–º–µ–∂–µ–Ω–Ω—è, –¥–∞—î –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç —Ç–∞ –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –ø–æ–º—ñ—á–Ω–∏–∫–∞."},
      {q:/\b(–ª—ñ–º—ñ—Ç|100 —Ñ–æ—Ç–æ|200 —Ç–µ–∫—Å—Ç)\b/i, a:"–õ—ñ–º—ñ—Ç: 100 —Ñ–æ—Ç–æ / 200 —Ç–µ–∫—Å—Ç—ñ–≤ ‚Äî –ø—ñ—Å–ª—è —Ü—å–æ–≥–æ –∑‚Äô—è–≤–∏—Ç—å—Å—è –æ–ø–ª–∞—Ç–∞ –π –∞–≤—Ç–æ–∞–∫—Ç–∏–≤–∞—Ü—ñ—è –ø—ñ—Å–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏."},
    ];
    let asstQuota = 30;
    function assistantReply(q){
      if(me.sub!==true && asstQuota<=0){
        return "–í–∏—á–µ—Ä–ø–∞–Ω–æ 30 –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å. –û—Ñ–æ—Ä–º—ñ—Ç—å –ø—ñ–¥–ø–∏—Å–∫—É (199 Kƒç/–º—ñ—Å) –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ –∞–±–æ —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª–∫—É.";
      }
      for(const {q:re,a} of assistantKB){
        if(re.test(q)) { if(me.sub!==true) asstQuota--; updateQuota(); return a; }
      }
      if(me.sub!==true) asstQuota--; updateQuota();
      return "–ù–µ –∑–Ω–∞–π—à–æ–≤ —É –±–∞–∑—ñ. –°–ø—Ä–æ–±—É–π—Ç–µ —ñ–Ω–∞–∫—à–µ —Å—Ñ–æ—Ä–º—É–ª—é–≤–∞—Ç–∏ –∞–±–æ –æ—Ñ–æ—Ä–º—ñ—Ç—å –ø—ñ–¥–ø–∏—Å–∫—É –¥–ª—è –ø–æ–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É.";
    }
    function updateQuota(){
      $("#asstQuota").textContent = (me.sub===true) ? "‚àû –∑ –ø—ñ–¥–ø–∏—Å–∫–æ—é" : (asstQuota+" –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏—Ö");
    }
    $("#assistantSend").onclick = ()=>{
      const t=$("#assistantInput").value.trim(); if(!t) return;
      $("#assistantInput").value="";
      appendAssistant("üë§ –í–∏", t);
      const a = assistantReply(t);
      setTimeout(()=> appendAssistant("üß† –ü–æ–º—ñ—á–Ω–∏–∫", a), 250);
    };
    function appendAssistant(who, text){
      const s = $("#assistantStream");
      const node = document.createElement("div");
      node.className="msg"; node.innerHTML=`<div class="meta"><b>${who}</b> ¬∑ —â–æ–π–Ω–æ</div><div class="text">${linkify(escapeHtml(text))}</div>`;
      s.appendChild(node); s.scrollTop = s.scrollHeight;
    }

    /************** Admin actions **************/
    $("#grantSub").onclick = async()=>{
      const email=$("#subEmail").value.trim(); if(!email) return alert("Email?");
      // naive scan: find profile by email
      const all = await get(ref(db,"profiles"));
      if(all.exists()){
        const v=all.val(); const uid = Object.keys(v).find(k=> (v[k].email||"").toLowerCase()===email.toLowerCase());
        if(uid){ await update(ref(db,"profiles/"+uid), {sub:true}); if(uid===me.uid) me.sub=true; alert("–ü—ñ–¥–ø–∏—Å–∫—É –≤–∏–¥–∞–Ω–æ"); updateQuota(); }
        else alert("–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ");
      }
    };
    $("#revokeSub").onclick = async()=>{
      const email=$("#subEmail").value.trim(); if(!email) return alert("Email?");
      const all = await get(ref(db,"profiles"));
      if(all.exists()){
        const v=all.val(); const uid = Object.keys(v).find(k=> (v[k].email||"").toLowerCase()===email.toLowerCase());
        if(uid){ await update(ref(db,"profiles/"+uid), {sub:false}); if(uid===me.uid) me.sub=false; alert("–ó–Ω—è—Ç–æ –ø—ñ–¥–ø–∏—Å–∫—É"); updateQuota(); }
        else alert("–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ");
      }
    };
    $("#onlineMultiplier").oninput = (e)=>{
      onlineMultiplier = Math.max(1, Number(e.target.value||10));
    };

    /************** Map **************/
    let gmap, markers=[];
    window.initMap = function(){
      if(gmap) return;
      const el = document.getElementById("map");
      if(!el) return;
      gmap = new google.maps.Map(el, {center:{lat:50.0755,lng:14.4378}, zoom:12, mapId:"DEMO_MAP_ID"});
      gmap.addListener("click", (e)=>{
        addMarker(e.latLng, {title:"–ù–æ–≤–∞ —Ç–æ—á–∫–∞"});
      });
    };
    function addMarker(pos, opt={}){
      const icon = {
        url:"https://cdn-icons-png.flaticon.com/512/684/684908.png",
        scaledSize:new google.maps.Size(32,32)
      };
      const m = new google.maps.Marker({position:pos, map:gmap, icon, title:opt.title||"–¢–æ—á–∫–∞"});
      markers.push(m);
    }
    // Maps key input
    $("#saveMapsKey").onclick = ()=>{
      const k=$("#mapsKey").value.trim(); if(!k) return;
      localStorage.gmk = k; alert("–ö–ª—é—á –∑–±–µ—Ä–µ–∂–µ–Ω–æ. –ü–µ—Ä–µ–∑–∞–π–¥—ñ—Ç—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É –ö–∞—Ä—Ç–∞.");
    };

    /************** Misc **************/
    $("#profileBtn").addEventListener("click", ()=> openModal("#profileModal"));
    $("#friendsBtn").addEventListener("click", ()=> openModal("#friendsModal"));
    $("#adminBtn").addEventListener("click", ()=> openModal("#adminModal"));

    // Jump to user
    $("#jumpUser").addEventListener("keydown", (e)=>{
      if(e.key==="Enter"){
        alert("–ü–µ—Ä–µ—Ö—ñ–¥ —É –ø—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: "+e.currentTarget.value+"\n(–¥–µ–º–æ)");
      }
    });

    // Auto open help assistant after 3 sec on Help tab handled in switchTab()

    // Initialize default tab
    switchTab("chatMain");
    updateQuota();
  </script>

  <!-- Google Maps (user key embedded) -->
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFrxVhpb6nHJ6rhiLl5Ho8t0jOb1iEQNc&callback=initMap"></script>
</body>
</html>
