window.PF_ADMIN=(function(){let db,auth,stg;function init(fb){db=fb.database();auth=fb.auth();stg=fb.storage();const wrap=document.getElementById('payInbox');db.ref('payments/inbox').on('value',s=>{wrap.innerHTML='';const all=s.val()||{};Object.keys(all).forEach(uid=>{const rec=all[uid]||{};Object.keys(rec).forEach(pid=>{const p=rec[pid]||{};const row=document.createElement('div');row.className='card';row.innerHTML=`<div><b>uid:</b> ${uid} · <b>pid:</b> ${pid} · <b>time:</b> ${new Date(p.ts||Date.now()).toLocaleString()}</div><div style="display:flex;gap:8px;margin-top:6px"><button data-act="approve">Підтвердити VIP</button><button data-act="reject">Видалити</button></div>`;row.querySelector('[data-act="approve"]').onclick=async()=>{await db.ref('payments/verified/'+uid+'/'+pid).set({by:auth.currentUser.email||'admin',ts:Date.now()});await db.ref('usersPublic/'+uid+'/vip').set(true);await db.ref('payments/inbox/'+uid+'/'+pid).remove();};row.querySelector('[data-act="reject"]').onclick=async()=>{await db.ref('payments/inbox/'+uid+'/'+pid).remove();};wrap.appendChild(row);});});});const botsRef=db.ref('settings/bots');const botList=document.getElementById('botList');document.getElementById('botAdd').onclick=()=>{const id=Date.now().toString();botsRef.child(id).set({text:'Новий бот-пост',city:'praha',interval:60});};botsRef.on('value',s=>{botList.innerHTML='';const data=s.val()||{};Object.keys(data).forEach(id=>{const b=data[id];const card=document.createElement('div');card.className='card';card.innerHTML=`<div style="display:flex;gap:8px;flex-wrap:wrap"><input data-k="text" value="${b.text||''}" placeholder="Текст"><input data-k="city" value="${b.city||'praha'}" placeholder="Місто"><input data-k="interval" type="number" value="${b.interval||60}" min="5" step="5" style="width:90px"><button data-act="save">Зберегти</button><button data-act="del">Видалити</button></div>`;card.querySelector('[data-act="save"]').onclick=()=>{const text=card.querySelector('[data-k="text"]').value.trim();const city=card.querySelector('[data-k="city"]').value.trim()||'praha';const interval=+card.querySelector('[data-k="interval"]').value||60;botsRef.child(id).update({text,city,interval});};card.querySelector('[data-act="del"]').onclick=()=>botsRef.child(id).remove();botList.appendChild(card);});});document.getElementById('wallSave').onclick=async()=>{const url=document.getElementById('wallUrlInput').value.trim();if(url)await db.ref('settings/theme').set({wallUrl:url});};const uBox=document.getElementById('adminUsers');db.ref('usersPublic').on('value',s=>{uBox.innerHTML='';const users=s.val()||{};Object.keys(users).forEach(uid=>{const u=users[uid];const row=document.createElement('div');row.className='card';row.innerHTML=`<div style="display:flex;gap:10px;align-items:center"><img src="${u.ava||'public/images/ava.png'}" style="width:34px;height:34px;border-radius:50%;object-fit:cover"><div style="flex:1"><b>${u.nick||'User'}</b> ${u.vip?'<span class="badge">VIP</span>':''}<div style="opacity:.7">${uid}</div></div><div style="display:flex;gap:6px"><button data-act="vip">${u.vip?'Зняти VIP':'Дати VIP'}</button><button data-act="ban">${u.banned?'Розбан':'Бан'}</button></div></div>`;row.querySelector('[data-act="vip"]').onclick=()=>db.ref('usersPublic/'+uid+'/vip').set(!u.vip);row.querySelector('[data-act="ban"]').onclick=()=>db.ref('usersPublic/'+uid+'/banned').set(!u.banned);uBox.appendChild(row);});});}return{init};})();