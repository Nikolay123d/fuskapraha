rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {

    function isSignedIn() {
      return request.auth != null;
    }

    // Admin check by email (keep in sync with RTDB rules)
    function isAdmin() {
      return isSignedIn() &&
        (request.auth.token.email == 'urciknikolaj642@gmail.com' ||
         request.auth.token.email == 'urciknikolaj62@gmail.com');
    }

    // Public read for app assets (avatars/wallpapers/sounds shared to everyone)
    match /public/{allPaths=**} {
      allow read: if true;
      allow write: if isAdmin() && request.resource.size < 25 * 1024 * 1024;
    }

    // User uploads (private by ownership; app can still share links)
    match /uploads/{uid}/{allPaths=**} {
      allow read: if true; // if you want private uploads, change to: isSignedIn() && request.auth.uid == uid
      allow write: if isSignedIn()
                   && request.auth.uid == uid
                   && request.resource.size < 15 * 1024 * 1024
                   && (request.resource.contentType.matches('image/.*') ||
                       request.resource.contentType.matches('audio/.*'));
    }

    // Deny everything else by default
    match /{allPaths=**} {
      allow read: if false;
      allow write: if false;
    }
  }
}
