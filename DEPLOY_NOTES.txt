MAKAME CZ — Deploy Notes (v61 DM server-first)

0) Что исправлено в этой версии
- DM: первое сообщение-заявка больше НЕ пропадает после ответа.
  Теперь `dmRequestSend` сохраняет полный текст (поле `text`), а `dmConfirmAtomic` при принятии
  переносит это первое сообщение в `privateMessages/{room}/req_{uid}_{ts}`.
- DM: добавлена server-authoritative функция `dmSend`.
  Фронт отправляет DM сообщения через Cloud Functions (а не прямой записью в RTDB).
- DM: картинки в DM сжимаются на клиенте, чтобы не ловить `permission_denied` на лимите ~400k.
- Email verification gate теперь управляется флагом `window.REQUIRE_EMAIL_VERIFY` (по умолчанию false).

1) Какие функции деплоить
Проще всего:
  firebase deploy --only functions

Это задеплоит ВСЕ exports из `firebase/functions/index.js`, включая:
- consumeLimit
- redeemPromo
- friendSend
- friendAccept
- friendDecline
- friendRemove
- dmRequestSend
- dmConfirmAtomic
- dmRequestDecline
- dmSend
- blockUser
- unblockUser
- reportUser
- supportTicketCreate
- autopostCampaignCreate
- autopostCampaignUpdate
- autopostCampaignToggle
- autopostCampaignRemove
- autopostTick (scheduler)
- promoChat25Tick (scheduler)
- onChatMessageCreate (RTDB trigger)

2) Команды деплоя (Firebase CLI)
Из папки `firebase/`:
- npm i
- cd functions && npm i && cd ..
- firebase deploy --only functions
- firebase deploy --only database
- firebase deploy --only storage
- firebase deploy --only hosting

Можно одним махом:
  firebase deploy --only functions,hosting,database,storage

3) Важно
- После деплоя функций/правил сделай hard-reload (Ctrl+Shift+R) и почисти кэш, если включён SW.
- Если видишь `permission_denied` в консоли — чаще всего это не код, а не задеплоены RTDB rules.
