{
  "rules": {
    "messages": {
      "$city": {
        ".read": true,
        "$msgid": {
          ".write": "auth != null && ( !data.exists() || (newData.child('by').val() == auth.uid) )",
          ".validate": "newData.child('ts').isNumber() && ( now - (root.child('throttle').child(auth.uid).child('lastTs').val() || 0) > 5000 )"
        }
      }
    },
    "throttle": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    "privateMessages": {
      "$pair": {
        ".read": "auth != null && ($pair.matches('^'+auth.uid+'_.+$') || $pair.matches('^.+_'+auth.uid+'$'))",
        "$mid": {
          ".write": "auth != null && ( !data.exists() || (newData.child('by').val() == auth.uid) )"
        }
      }
    },
    "userToasts": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && (auth.uid == $uid || root.child('roles').child(auth.uid).child('admin').val() == true)"
      }
    },
    "nickRequests": {
      "$uid": {
        ".read": "auth != null && (auth.uid == $uid || root.child('roles').child(auth.uid).child('admin').val() == true)",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    "places": { ".read": true, ".write": "auth != null" },
    "rent": { ".read": true, ".write": "auth != null" }
  },
    "friendRequests": {
      "$to": {
        ".read": "auth != null && auth.uid == $to",
        "$from": { ".write": "auth != null && auth.uid == $from" }
      }
    },
    "friends": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        "$other": { ".write": "auth != null && (auth.uid == $uid || auth.uid == $other)" }
      }
    }
  }
}
