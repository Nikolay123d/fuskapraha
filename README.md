# PRÁCE CZ CHAT — v24 (AuthFix + No-Auth-On-Load + Cities)

## Что изменено по твоим замечаниям
- **Окно авторизации закрывается** сразу после входа/регистрации/Google, плюс по **крестику** и клавише **Esc**.
- **Не показываем регистрацию при заходе** на сайт. Авторизация появляется только:
  - при попытке отправить первое сообщение/объявление;
  - либо через **30 минут** (мини-авторизация), если всё ещё гость.
- **Все города работают**, по умолчанию **Praha**. Переключатель городов в шапке — моментально пересоединяет ленты.
- Исправлены обработчики кликов: повесил привязки **после DOMContentLoaded**, чтобы ничего не «не ловилось».
- Усилен «форс-скрытие» модалки авторизации при смене состояния auth.
- Карта и «Допомога»-бот — на месте; ЛС с мини-аватарками; друзья/заявки; лимиты 200/100.

## Firebase (проверь)
1) Realtime Database → **Rules** → вставь `database.rules.json` → **Publish**.  
2) Authentication → включи **Email/Password** и **Google**.  
3) Storage → включи.  
4) Запусти как статический сайт (VS Code Live Server).

## Структура БД
- Чаты: `messages/{city}`, оренда: `rentMessages/{city}`.  
- ЛС: `privateMessages/{A_B}`; сайдбар: `inboxMeta/{uid}`.  
- Допомога: `help/{city}/cards` (ред. только админ).  
- Карта: `map/poi/{city}` (ред. только админ).  
- Пользователи: `users/{uid}` (lang/role/plan/avatar).  
- Лимиты: `limits/{uid}`.  
- Друзья/заявки/уведомления.  
- Настройки/бот: `settings/*`.

## Обои/звуки
- Обои без оверлея. Кнопки в профиле: задать глобально или per-city.  
- Звуки лучше хранить в Storage и подставить прямые mp3 в `window.SOUND_URLS` (иначе CORS/автоплей).



### Нове у v26
- Публічні профілі `usersPublic/{uid}` (ім'я/аватар) — щоб у ЛС та чаті бачилися нікнейми.
- «Оплати»: користувач надсилає чек, адмін підтверджує і видає ліміти.
- В інбоксі ЛС формується діалог між адміном та користувачем після підтвердження або нагадування.
