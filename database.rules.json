{
  "rules": {
    ".read": false,
    ".write": false,
    "messages": {
      ".read": true,
      "$city": {
        ".indexOn": [
          "ts"
        ],
        "$msg": {
          ".write": "auth != null",
          ".validate": "newData.hasChildren(['by','ts']) && newData.child('by').isString() && newData.child('ts').isNumber()"
        }
      }
    },
    "privateMembers": {
      "$thread": {
        ".read": "auth != null && data.child(auth.uid).exists()",
        ".write": "auth != null",
        "$uid": {
          ".validate": "newData.isBoolean() || newData.val() === true"
        }
      }
    },
    "privateMessages": {
      "$thread": {
        ".read": "auth != null && root.child('privateMembers/'+$thread+'/'+auth.uid).exists()",
        ".indexOn": [
          "ts"
        ],
        "$msg": {
          ".write": "auth != null && root.child('privateMembers/'+$thread+'/'+auth.uid).exists()",
          ".validate": "newData.hasChildren(['by','ts']) && newData.child('by').isString() && newData.child('ts').isNumber()"
        }
      }
    },
    "inboxMeta": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        ".write": "auth != null && auth.uid === $uid"
      }
    },
    "profiles": {
      "$uid": {
        ".read": true,
        ".write": "auth != null && auth.uid === $uid"
      }
    },
    "presence": {
      "$uid": {
        ".read": true,
        ".write": "auth != null && auth.uid === $uid",
        ".validate": "newData.hasChildren(['state','ts']) && newData.child('state').isString() && newData.child('ts').isNumber()"
      }
    },
    "emails": {
      "$key": {
        ".read": "auth != null",
        ".write": "auth != null"
      }
    }
  }
}