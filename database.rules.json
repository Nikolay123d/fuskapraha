{
  "rules": {
    ".read": false,
    ".write": false,
    "admins": {
      ".read": "auth!=null && root.child('admins/'+auth.uid).val()===true",
      "$uid": {
        ".write": "auth!=null && root.child('admins/'+auth.uid).val()===true",
        ".validate": "newData.isBoolean()"
      }
    },
    "usersPublic": {
      ".read": true,
      "$uid": {
        ".write": "auth!=null && auth.uid===$uid",
        "nick": {
          ".validate": "newData.isString() && newData.val().length>=2 && newData.val().length<=24"
        },
        "avatar": {
          ".validate": "newData.val()==null || newData.isString()"
        },
        "photoURL": {
          ".validate": "newData.val()==null || newData.isString()"
        },
        "city": {
          ".validate": "newData.val()==null || newData.isString()"
        },
        "role": {
          ".validate": "newData.val()==null || newData.isString()"
        },
        "type": {
          ".validate": "newData.val()==null || newData.isString()"
        },
        "headline": {
          ".validate": "newData.val()==null || newData.isString()"
        },
        "about": {
          ".validate": "newData.val()==null || newData.isString()"
        },
        "plan": {
          ".validate": "newData.val()==null || newData.isString()"
        },
        "ts": {
          ".validate": "newData.val()==null || newData.isNumber()"
        },
        "lastActive": {
          ".validate": "newData.val()==null || newData.isNumber()"
        }
      }
    },
    "emails": {
      "$key": {
        ".read": "auth!=null",
        ".write": "auth!=null && ( !data.exists() || data.val()===auth.uid )",
        ".validate": "newData.isString() && newData.val()===auth.uid"
      }
    },
    "messages": {
      ".read": true,
      "$city": {
        ".indexOn": [
          "ts"
        ],
        "$msgId": {
          ".write": "auth!=null",
          ".validate": "newData.hasChildren(['by','ts'])",
          "by": {
            ".validate": "newData.isString() && (newData.val()===auth.uid || (root.child('admins/'+auth.uid).val()===true && newData.val().matches(/^bot_/)))"
          },
          "ts": {
            ".validate": "newData.isNumber()"
          },
          "text": {
            ".validate": "newData.val()==null || (newData.isString() && newData.val().length<=2000)"
          },
          "img": {
            ".validate": "newData.val()==null || newData.isString()"
          },
          "nick": {
            ".validate": "newData.val()==null || newData.isString()"
          },
          "city": {
            ".validate": "newData.val()==null || newData.isString()"
          }
        }
      }
    },
    "friendRequests": {
      ".read": "auth!=null",
      "$toUid": {
        ".read": "auth!=null && auth.uid===$toUid",
        "$fromUid": {
          ".write": "auth!=null && (auth.uid===$fromUid || auth.uid===$toUid)",
          ".validate": "newData.hasChildren(['ts','status'])"
        }
      }
    },
    "friends": {
      ".read": "auth!=null",
      "$uid": {
        ".read": "auth!=null && auth.uid===$uid",
        "$fid": {
          ".write": "auth!=null && auth.uid===$uid",
          ".validate": "newData.hasChildren(['ts'])"
        }
      }
    },
    "inboxMeta": {
      ".read": "auth!=null",
      "$uid": {
        ".read": "auth!=null && auth.uid===$uid",
        "$room": {
          ".write": "auth!=null",
          ".validate": "newData.hasChildren(['from','ts'])"
        }
      }
    },
    "privateMembers": {
      "$room": {
        ".read": "auth!=null && root.child('privateMembers/'+$room+'/'+auth.uid).val()===true",
        "$uid": {
          ".write": "auth!=null && auth.uid===$uid",
          ".validate": "newData.isBoolean()"
        }
      }
    },
    "privateMessages": {
      "$room": {
        ".read": "auth!=null && root.child('privateMembers/'+$room+'/'+auth.uid).val()===true",
        ".indexOn": [
          "ts"
        ],
        "$msgId": {
          ".write": "auth!=null && (newData.child('by').val()===auth.uid || (root.child('admins/'+auth.uid).val()===true && newData.child('by').val().matches(/^bot_/)))",
          ".validate": "newData.hasChildren(['by','ts'])",
          "by": {
            ".validate": "newData.isString()"
          },
          "ts": {
            ".validate": "newData.isNumber()"
          },
          "text": {
            ".validate": "newData.val()==null || (newData.isString() && newData.val().length<=4000)"
          },
          "img": {
            ".validate": "newData.val()==null || newData.isString()"
          },
          "bot": {
            ".validate": "newData.val()==null || newData.isBoolean()"
          }
        }
      }
    },
    "payments": {
      "requests": {
        "$uid": {
          ".read": "auth!=null && (auth.uid===$uid || root.child('admins/'+auth.uid).val()===true)",
          "$id": {
            ".write": "auth!=null && auth.uid===$uid",
            ".validate": "newData.hasChildren(['uid','plan','ts','status'])"
          }
        }
      }
    },
    "notifications": {
      "$uid": {
        ".read": "auth!=null && auth.uid===$uid",
        "$id": {
          ".write": "auth!=null && (auth.uid===$uid || root.child('admins/'+auth.uid).val()===true)"
        }
      }
    },
    "presence": {
      "$uid": {
        ".read": true,
        ".write": "auth!=null && auth.uid===$uid"
      }
    }
  }
}